# 个人数据合成系统项目说明文档

## 1. 项目背景

### 1.1 项目概述
本项目旨在解决移动设备日常轨迹数据合成中的关键挑战，通过创新的多模块架构与技术体系，生成具有长时间跨度、异构数据类型和复杂多模态模式的高保真个人生活数据集。系统核心目标是克服现有合成方法中存在的真实行为对齐机制缺失、事实一致性偏差和语义可靠性不足等问题，避免生成简化、模板化或平均化的行为模式，而是捕捉人类活动的丰富性和可变性。
针对设备生命周期（通常1-2年）级别的长期数据收集需求，项目重点关注合成数据的真实性、时间与语义一致性以及行为多样性，以支持下游分析、建模和评估任务。



## 2. 总体架构与流程

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────────┐
│                         个人生活数据合成系统                         │
├─────────┬─────────┬─────────┬───────────────────────────────────┤
│ 人物画像生成 │  事件生成  │ 手机操作生成 │            模拟生成            │
│ persona_gen │ event_gen │ phone_gen │           simulator           │
├─────────┼─────────┼─────────┼───────────────────────────────────┤
│         │         │         │  ┌─────────┐  ┌─────────┐  ┌───────┐ │
│         │         │         │  │  Mind   │  │ Event   │  │Phone  │ │
│         │         │         │  │ 模块    │  │Refiner  │  │Data   │ │
│         │         │         │  └─────────┘  └─────────┘  └───────┘ │
├─────────┼─────────┼─────────┼───────────────────────────────────┤
│         │         │         │  ┌─────────┐  ┌─────────┐        │
│         │         │         │  │Scheduler│  │Templates│        │
│         │         │         │  └─────────┘  └─────────┘        │
└─────────┴─────────┴─────────┴───────────────────────────────────┘
```

### 2.2 数据结构设计
本章节详细介绍系统核心数据结构，包括三大核心模型：

1. **人物画像数据模型**：作为系统的核心输入，包含个人基本信息、位置信息、社会关系等多维度数据，为后续事件生成提供个性化基础。由于人物画像属性较多，详细示例可参考第六节。

2. **事件数据模型**：采用三层层次化设计，形成完整的事件树结构。

#### 2.2.1 三层事件结构设计思路
- **语义分层与认知符合度**：三层结构模拟了人类认知中对事件的自然分层理解方式，从宏观规划（主题事件）到具体执行（原子事件）再到时间连贯的具体细节（每日事件），符合人类思维的层级化特征。
- **模块化与可维护性**：不同粒度的事件独立管理，便于系统各模块（事件生成、模拟执行、手机数据生成）根据需求在合适的粒度上处理数据。
- **可扩展性与灵活性**：分层架构允许系统灵活应对不同场景需求，例如可以单独扩展某一层的事件类型而不影响整体结构。
- **数据生成效率优化**：通过分层生成策略，可以先构建宏观框架再填充细节，提高生成效率并保证整体一致性。
- **人类认知心理学**：参考了认知心理学中关于事件表征的研究，特别是Tulving的情景记忆理论和Baddeley的工作记忆模型。


#### 2.2.2 三层事件结构详解

**主题事件**：较大粒度的复合事件，具有明确的时间范围和目标，是事件树的顶层节点。主题事件的主题包括：Career（职业）、Education（教育）、Relationships（人际关系）、Family&Living Situation（家庭与生活状况）、Personal Life（个人生活）、Finance（财务）、Health（健康）、Unexpected Events（意外事件）、Other（其他）。

**原子事件**：主题事件分解后的最小可执行单元，是连接主题事件与每日事件的中间层级。

**每日事件**：按时间排序的个人时间段内的行为事件，包含精确时间点和详细执行过程描述，是事件树的最底层节点。

三层事件结构自顶向下分解，自底向上聚合，实现从宏观计划到微观执行的完整覆盖。

#### 2.2.3 三层事件结构完整示例

以下是一个完整的三层事件结构示例，以"参加行业会议"（Career主题）为例：

**主题事件（顶层）**：
```json
{
  "event_id": "1",
  "name": "参加2025年金融科技行业峰会",
  "type": "Career",
  "description": "参加在上海举办的2025年金融科技行业峰会，了解行业最新动态，拓展人脉资源。",
  "participant": [
    {"name": "冯浩然", "relation": "自己"},
    {"name": "李总监", "relation": "公司领导"}
  ],
  "location": "上海国际会议中心",
  "start_time": "2025-03-15",
  "end_time": "2025-03-16",
  "decompose": 1,
  "date": ["2025-03-15至2025-03-16"]
}
```

**原子事件（中层）**：
```json
[
  {
    "event_id": "1_1",
    "name": "前往上海参会",
    "date": ["2025-03-15"],
    "type": "Career",
    "description": "乘坐高铁前往上海参加金融科技行业峰会。",
    "participant": [{"name": "冯浩然", "relation": "自己"}],
    "location": "长沙南站至上海虹桥站",
    "decompose": 0
  },
  {
    "event_id": "1_2",
    "name": "参加峰会主题演讲",
    "date": ["2025-03-15"],
    "type": "Career",
    "description": "参加峰会开幕式和主题演讲环节，了解金融科技最新发展趋势。",
    "participant": [
      {"name": "冯浩然", "relation": "自己"},
      {"name": "李总监", "relation": "公司领导"}
    ],
    "location": "上海国际会议中心1号厅",
    "decompose": 0
  },
  {
    "event_id": "1_3",
    "name": "行业人脉交流晚宴",
    "date": ["2025-03-15"],
    "type": "Career",
    "description": "参加峰会组织的人脉交流晚宴，与行业同行建立联系。",
    "participant": [
      {"name": "冯浩然", "relation": "自己"},
      {"name": "李总监", "relation": "公司领导"}
    ],
    "location": "上海国际会议中心宴会厅",
    "decompose": 0
  }
]
```

**每日事件（底层）**：
```json
[
  {
    "event_id": "1",
    "name": "准备参会资料",
    "date": ["2025-03-15 07:00:00至2025-03-15 08:00:00"],
    "type": "Career",
    "description": "起床后整理参会所需的笔记本、名片、公司宣传资料等物品。",
    "participant": [{"name": "冯浩然", "relation": "自己"}],
    "location": "上海市浦东新区陆家嘴环路1288号上海环球金融中心酒店房间"
  },
  {
    "event_id": "2",
    "name": "前往会议中心",
    "date": ["2025-03-15 08:30:00至2025-03-15 09:15:00"],
    "type": "Career",
    "description": "从酒店乘坐出租车前往上海国际会议中心，路上查看会议议程。",
    "participant": [{"name": "冯浩然", "relation": "自己"}],
    "location": "上海市浦东新区陆家嘴环路1288号上海环球金融中心至上海国际会议中心"
  },
  {
    "event_id": "3",
    "name": "参加开幕式与主题演讲",
    "date": ["2025-03-15 09:30:00至2025-03-15 11:30:00"],
    "type": "Career",
    "description": "在1号厅参加峰会开幕式，听取央行领导关于金融科技监管政策的主题演讲，并做笔记记录关键点。",
    "participant": [
      {"name": "冯浩然", "relation": "自己"},
      {"name": "李总监", "relation": "公司领导"}
    ],
    "location": "上海国际会议中心1号厅"
  },
  {
    "event_id": "4",
    "name": "参加人脉交流晚宴",
    "date": ["2025-03-15 18:30:00至2025-03-15 21:00:00"],
    "type": "Career",
    "description": "在宴会厅参加交流晚宴，与三位来自不同金融科技公司的同行交换名片并深入交流，讨论了AI在金融领域的应用前景。",
    "participant": [
      {"name": "冯浩然", "relation": "自己"},
      {"name": "李总监", "relation": "公司领导"}
    ],
    "location": "上海国际会议中心宴会厅"
  }
]
```

3. **手机数据模型**：记录人物的日常数字行为，包括通话记录、短信、相册等，与事件数据模型关联，为人物活动提供数字化证据。详细结构请参考第六节。

详细的数据格式示例和字段定义请参考第6节。

### 2.3 核心流程
系统核心流程采用模块化设计，通过四大功能模块协同工作形成完整的数据生成链路，各模块间通过标准化数据接口传递信息。

#### 2.3.1 人物画像生成
人物画像生成模块是整个系统的基础，基于真实数据库与大语言模型（LLM）驱动，首先从多源真实数据库（问卷调查、社交媒体等）提取多维度人物特征构建基础框架，经敏感信息清洗保护隐私后，从参考数据库选取补充数据填充未覆盖字段，再通过大模型进行逻辑一致性校验优化，最后基于人物特征生成社交圈及关系角色，并为每个角色构建包含基本信息的简易人物画像。

#### 2.3.2 事件生成
事件生成模块以人物画像为输入，利用大语言模型按照预定义事件类别比例生成300-400个全年生活事件参考数据，随后以月为粒度逐天分析并调整初始事件安排（删除不合理事件、新增关联事件，确保每月事件数目控制在15-30个且符合人物特征与时空逻辑），再采用并行递归分解策略将复杂事件拆解为原子事件构建层次化事件树，最后通过迭代规划优化每日事件安排并消解时间冲突，确保事件序列的合理性。

#### 2.3.3 模拟生成
模拟生成模块基于人物画像和事件树，首先构建具备认知、记忆、思考、情绪等状态的拟人Agent以保障生成数据的个性化与拟人化特征，然后通过人物Agent（第一人称视角）和客观Agent（规则执行者）的双循环协作机制模拟每日场景（人物Agent规划今日安排，客观Agent模拟执行并修正不合理行为、引入环境因素，调用高德API等工具查询真实数据修正当日活动，人物Agent接收反馈记录活动并反思更新记忆系统），同时集成外部工具实现真实地理信息与虚拟人物移动轨迹的精准映射，最终生成个性化的每日事件记录。

#### 2.3.4 手机操作生成
手机操作生成模块基于人物画像和每日事件记录，针对不同类别操作设计专属概率判别逻辑，首先利用大语言模型基于用户每日事件特征为各类手机操作类型分配生成概率，并定义操作参数概率分布（如短信类操作的发送/接收、回复行为、消息数量等），然后基于概率模型具体化每个手机操作实例，利用大语言模型生成操作的具体内容（如短信文本、通话记录、相册数据、笔记内容等），确保生成符合用户行为特征且兼具真实性与多样性的手机操作数据。



## 3. 核心技术点
本项目在虚拟人物模拟与数据生成领域实现了多项技术创新，通过融合大语言模型、多源数据处理、拟人化Agent架构等先进技术，构建了高保真的虚拟人物模拟系统。

### 3.1 多源真实数据融合

**问题背景**：传统虚拟人物模拟系统存在数据源单一、行为模式同质化、与现实世界脱节等问题，同时面临数据隐私保护的挑战。为解决这些问题，需要实现真实数据与虚拟生成的深度融合，既丰富数据的真实性与多样性，又保障数据隐私安全。

**创新点**：实现真实数据与虚拟生成的深度融合，丰富数据的真实性与多样性，同时保障数据隐私安全。

- **真实画像数据库**：创新性整合问卷调查数据、社交媒体数据等多源真实数据集，构建结构化的人物特征数据库，为虚拟人物生成提供坚实的数据基础。
- **真实数据参考**：基于部分终端提供的真实手机数据，为概率建模设计和事件类别划分提供参考依据。
- **外部API协同**：集成高德地图API等外部工具，实现真实地理信息与虚拟人物移动轨迹的精准映射，提升事件生成的时空一致性。


### 3.2 双Agent协同的拟人化事件生成工作流

**问题背景**：传统大模型工作流虚拟人物模拟系统难以模拟人类完整的认知决策过程，生成的行为往往缺乏连贯性、合理性和真实感。为解决这一问题，需要构建更接近人类认知心理学的Agent架构，通过模拟人类完整的认知决策链条（感知-思考-决策-行动-反思），实现高度拟人化的行为生成与故事演进。同时若只考虑人的主观意愿，则会忽略客观事件的发展和环境因素，引入客观真实世界的数据和反馈，能够确保生成的行为序列的连贯性、合理性和真实感。

**创新点**：创新性构建了基于人类认知心理学的双Agent协同架构，通过模拟人类完整的认知决策链条（感知-思考-决策-行动-反思），实现了高度拟人化的行为生成与故事演进，同时集成了记忆系统与工具调用能力，确保行为的连贯性、合理性与真实感。


#### 3.2.1 双Agent协同架构
- **人物Agent（Subjective Agent）**：作为虚拟人物的"意识核心"，具备主观认知与决策能力，负责模拟人类的日常思考、情绪波动和行为选择。该Agent拥有独立的人格特质、价值观和偏好，能够基于自身状态和外部环境做出符合人物设定的决策。
- **监督Agent（Objective Agent）**：作为客观世界的"规则执行者"，负责验证人物Agent决策的合理性，基于时空约束、社会规范和人物画像进行冲突检测与修正。同时，监督Agent还负责管理外部工具调用和环境交互，确保虚拟人物行为符合现实世界逻辑。
- **双循环协作机制**：采用"人物决策-监督校验-反馈调整"的双循环工作流，人物Agent提出行为意向后，监督Agent进行合理性校验，若存在冲突则反馈调整建议，人物Agent基于反馈重新决策，形成类似人类"思考-审视-调整"的认知过程。

#### 3.2.2 拟人化认知系统设计
- **多层次记忆模拟**：构建与人类记忆机制高度相似的记忆系统，包括：
  - 短期记忆：存储最近五天的事件与感受，容量有限但检索速度快，影响即时决策
  - 长期记忆：存储重要的人生经历、关键事件和深度感受，通过记忆强化机制实现长期保存
  - 情景记忆：存储人物的所有记忆，当人物遇到新场景时，会检索最相似情景的记忆，影响行为模式和决策偏好

- **思考过程模拟**：通过多轮LLM对话机制模拟人类的连续思考过程，人物Agent在做出决策前会进行"内心独白"式的推理，考虑多种可能选择的利弊，并结合自身情绪和记忆做出最终决定。

- **自我反思机制**：实现每日、每周和月度的多层次反思系统，虚拟人物会定期回顾近期经历，分析事件意义，更新自我认知，调整价值观和行为模式，模拟人类的学习与成长过程。

#### 3.2.3 集成化Agent能力框架
- **工具调用系统**：集成了不同的工具供使用，支持Agent根据需求动态调用外部工具，包括：
  - 时空工具：地图API、日历工具，用于模拟真实世界的空间移动和时间管理
  - 信息检索工具：内部记忆库查询，用于模拟人物调取已存储的知识和记忆

**效果**：在评估框架中对于情节合理性、时空合理性均取得80%以上的分数，显著提升了虚拟人物行为生成的质量与真实感。


### 3.3 超长文本事件数据生成

**问题背景**：生成覆盖数月甚至数年的超长文本事件数据，面临三大核心挑战：

1. **长时段连贯性挑战**：
   - 在数月甚至数年时间跨度内保持事件的因果关联与逻辑一致性
   - 人物行为模式需长期稳定且符合其画像特征
   - 远距离事件间的关联与影响需得到有效传承与体现

2. **海量事件管理挑战**：
   - 生成数千条细粒度事件记录
   - 事件间需满足时空约束，避免冲突与矛盾
   - 支持高效的事件检索、更新与修正

3. **内容多样性与复杂性挑战**：
   - 避免事件类型同质化与重复
   - 模拟事件的发展变化和依赖逻辑
   - 模拟真实生活中的随机事件与突发情况


####  分层渐进式生成架构

受长故事生成框架启发，我们设计了"分层渐进式生成架构"，将超长时段事件生成从宏观到微观逐层分解为三个可管理的核心层级，实现从"故事大纲"到"具体内容"的有序演进，有效解决长时段事件生成的连贯性与复杂性挑战：

1. **宏观事件生成与规划层（对应故事大纲生成）**：
   - **所属模块**：事件生成模块 (event_gen)
   - **年度事件框架构建**：基于人物画像特征，生成覆盖全年的关键事件框架，包括职业发展、家庭变化、健康状况等核心维度，为后续事件生成奠定整体基调。
   - **月度事件精细化规划**：将年度事件框架拆解到具体月份，结合人物作息规律与季节特点，调整、新增或删除事件安排，形成月度事件主题与关键节点。
   - **概率分布动态约束**：基于人物画像特征动态分配事件类别概率分布，确保不同类型事件的数量与频率符合人物的行为模式与生活习惯。
   
2. **事件分解与协调组织层（对应故事章节规划）**：
   - **所属模块**：事件生成模块 (event_gen)
   - **事件树层次化构建**：采用并行递归事件分解算法，将月度主题事件自动拆解为粒度更细的子事件，形成层次化的事件树结构，实现事件的精细化管理。
   - **原子事件时空规划**：以天为最小粒度，逐天协调安排原子事件的时间与空间分布，确保事件之间的依赖关系清晰、逻辑一致，避免时空冲突。

3. **详细事件模拟生成层（对应故事内容写作）**：
   - **所属模块**：模拟生成模块 (simulator)
   - **逐天模拟事件生成**：通过模拟生成模块生成每天的详细事件，明确事件执行方式与过程，以及不同事件如何并行穿插执行。通过记忆模块与拟人模块实现事件内容生成的合理性。
   - **真实数据引入优化**：通过高德API引入真实数据，提升事件内容丰富度与真实感。


### 3.4 并行加速结构设计

**问题背景**：超长文本事件数据生成涉及大量计算密集型任务，传统串行处理方式面临严重的性能瓶颈，生成时间过长，无法满足大规模数据生成的效率需求。为实现超长文本的高效生成，需要设计多层次的并行加速架构，打破传统处理方式的性能限制。

为实现超长文本的高效生成，项目设计了多层次的并行加速架构，通过三大核心优化点将整体生成时间从串行的52小时压缩至7小时以内，实现了7.4倍的性能提升。

#### 3.4.1 事件树分解DFS并行

事件树分解是将原始事件递归分解为层级化子事件的核心步骤，直接影响后续文本生成的精细度和覆盖范围。项目创新性地采用DFS（深度优先搜索）与并行处理相结合的策略，打破了传统递归分解的性能瓶颈。

**技术设计思路：**
- **层级化并行处理**：将事件树按层级划分，对同一层级的所有节点进行并行分解，避免单线程递归的串行瓶颈
- **深度自适应控制**：设置最大分解深度阈值（默认3层），根据事件复杂度自动调整分解层级，平衡生成质量与性能开销
- **短文本单任务**：DFS逐个事件分解可使LLM输入文本更短，任务更单一，输出更准确快速


#### 3.4.2 模拟阶段的分段并行

模拟阶段是超长文本生成的核心环节，面临着严重的日期依赖问题——当前日期的记忆生成依赖于之前所有日期的完整数据，传统并行方案无法直接应用。项目通过创新的记忆处理机制和时间片划分策略，成功突破了这一技术瓶颈。

**核心解决方案：**

1. **长期记忆提前处理**
   - 基于"重要事件在事件树构建阶段已全部确定"的假设
   - 提前分析提取所有重要事件（产生影响和变化的事件）进行总结
   - 为每个并行时间片提前构建对应日期的长期记忆

2. **模糊记忆与清晰记忆机制**
   - **清晰记忆**：已生成的详细一日数据
   - **模糊记忆**：当对应日期的详细数据尚未生成时，通过检索事件树的该日期事件来构造记忆
   - 在记忆检索时，优先使用清晰记忆，若不可用则自动切换到模糊记忆

3. **并行时间片划分**
   - 将一年的模拟时间划分为多个独立的时间片
   - 每个时间片包含多个连续日期，减少并行边界的记忆依赖
   - 通过提前构建的长期记忆，实现各时间片的并行处理


#### 3.4.3 手机操作的并行生成

手机操作作为超长文本的重要组成部分，需要生成大量与主事件相关的手机操作记录。项目基于"手机操作仅依赖于对应事件"的核心假设，实现了手机操作的高效并行生成。

**技术设计思路：**
- **独立任务划分**：将每日的手机操作生成任务划分为独立单元，每个单元仅处理当日的手机操作生成

#### 3.4.4 整体性能对比

| 处理阶段   | 串行时间     | 并行时间      | 加速比      |
|--------|----------|-----------|----------|
| 事件生成   | 6小时      | 1小时       | 6x       |
| 模拟生成   | 36小时     | 4-5小时     | 9x       |
| 手机操作生成 | 10小时     | 1.5小时     | 6.7x     |
| **整体** | **52小时** | **7-8小时** | **7.4x** |



通过上述三大核心优化点，项目成功将超长文本的生成时间从串行的52小时压缩至7小时以内，实现了显著的性能提升。

## 4. 运行与使用方法

### 4.1 运行方式

**人物画像生成**：
```bash
python persona_gen.py
```

**事件生成**：
```bash
python event_gen.py
```

**手机操作生成**：
```bash
python phone_gen.py
```

**模拟生成**：
```bash
python simulator.py
```

### 4.2 参数说明

| 模块 | 命令 | 默认路径 | 必要输入文件 | 说明 |
|------|------|----------|--------------|------|
| 人物画像生成 | `python persona_gen.py` | `data/persona/` | `data/persona/profile_ref.json`<br>`data/persona/processed_features.json` | 生成虚拟人物画像 |
| 事件生成 | `python event_gen.py` | `output/` | `output/persona.json` | 生成事件序列和层级事件树 |
| 手机操作生成 | `python phone_gen.py` | `data/` | `data/persona.json`<br>`data/event_update.json` | 生成手机操作数据 |
| 模拟生成 | `python simulator.py` | `output/` | `output/persona.json`<br>`output/event_decompose_dfs.json`(若执行事件精炼) | 协调各模块生成全年生活数据 |

**各模块详细参数**：

#### 4.2.1 事件生成模块参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --base-path | 基础数据路径 | `output/` |
| --process-path | 处理文件路径（相对于base-path） | `process/` |
| --max-workers | 最大工作线程数 | CPU核心数×2 |
| --decompose-workers | 事件分解的最大工作线程数 | 与max-workers相同 |
| --schedule-workers | 事件规划的最大工作线程数 | 与max-workers相同 |
| --skip-gen | 跳过事件生成步骤 | False |
| --skip-schedule | 跳过事件规划步骤 | False |
| --skip-decompose | 跳过事件分解步骤 | False |
| --skip-reorder | 跳过事件重排和ID分配步骤 | False |
| --only-reorder | 仅执行事件重排和ID分配步骤 | False |

#### 4.2.2 手机操作生成模块参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --file-path | 数据文件路径 | `data/` |
| --start-time | 开始日期 | `2025-01-01` |
| --end-time | 结束日期 | `2025-12-31` |
| --max-workers | 最大并行线程数 | 32 |

#### 4.2.3 模拟生成模块参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --file-path | 数据文件路径 | `output/` |
| --start-date | 开始日期 | `2025-01-01` |
| --end-date | 结束日期 | `2025-12-31` |
| --max-workers | 最大并行线程数 | 30 |
| --interval-days | 每个线程处理的天数 | 16 |
| --refine-events | 是否执行事件精炼（1=执行，0=跳过） | 0 |
| --generate-data | 是否生成数据（1=执行，0=跳过） | 1 |
| --format-events | 是否格式化事件（1=执行，0=跳过） | 1 |

#### 4.2.4 人物画像生成模块参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --file-path | 数据文件路径 | `data/persona/` |
| --start | 开始生成的人物索引 | 0 |
| --end | 结束生成的人物索引 | 1 |
| --ref-file | 参考数据库文件名 | `profile_ref.json` |
| --input-file | 输入特征文件名 | `processed_features.json` |
| --output-file | 输出人物画像文件名 | `persona_list.json` |

## 5. 核心模块详解

### 5.1 画像生成模块 (persona_gen)

#### 5.1.1 功能概述
生成具有详细背景、特征和社会关系的虚拟人物画像，构建符合现实逻辑的人物身份体系。

#### 5.1.2 涉及文件与子模块
| 子模块路径 | 功能描述 | 输入 | 输出 |
|------------|----------|------|------|
| `persona_gen.py` | 画像生成模块入口文件，协调各子模块执行 | 命令行参数 | 人物画像JSON文件 |
| `persona.persona_gen.PersonaGenerator` | 人物画像生成核心类 | 参考数据、特征数据 | 完整人物画像对象 |
| `persona.gen_utils.template` | LLM调用模板定义，控制生成内容格式 | 无 | 模板字符串 |

**PersonaGenerator类核心方法**：
- `refer_const()`：从参考数据中随机选择兴趣、目标和价值观
- `generate_profile(profile_str)`：调用LLM生成基础个人画像
- `generate_refine(profile)`：优化画像数据，增强细节和合理性
- `generate_relation(profile)`：生成人物的人际关系网络
- `generate_people(profile, circle)`：生成关系人物的详细信息
- `gen_profile(start_id, end_id, in_file_path, out_file_path)`：批量生成完整个人画像的主方法

#### 5.1.3 输入输出
**输入**：
- `profile_ref.json`：人物画像参考数据库，包含兴趣、目标、价值观等分类数据
- `processed_features.json`：从问卷数据预处理出的格式化基础特征数据

**输出**：
- `persona_list.json`：生成的完整人物画像集合，包含个人基本信息、性格特征、社会关系等

#### 5.1.4 主要流程
1. 解析命令行参数，确定输入输出路径和处理范围
2. 加载参考数据和预处理特征数据
3. 调用`PersonaGenerator`类的`refer_const()`方法生成参考信息
4. 使用`generate_profile()`方法调用LLM生成基础个人画像
5. 通过`generate_refine()`方法优化画像数据，增强真实性
6. 调用`generate_relation()`方法生成人物人际关系网络
7. 使用`generate_people()`方法生成关系人物的详细信息
8. 通过`gen_profile()`方法批量处理并输出完整人物画像

#### 5.1.6 示例
```bash
python persona_gen.py --file-path data/persona/ --start 0 --end 1
```

### 5.2 事件生成模块 (event_gen)

#### 5.2.1 功能概述
根据人物画像生成全年的生活事件序列，并构建层级化的事件树结构，实现事件的精细化分解和时间规划。

#### 5.2.2 涉及文件与子模块
| 子模块路径 | 功能描述 | 输入 | 输出 |
|------------|----------|------|------|
| `event_gen.py` | 事件生成模块入口文件，协调事件生成、规划和分解流程 | 命令行参数 | 事件序列和事件树文件 |
| `event.scheduler.EventTree` | 事件分解树结构实现，负责事件的递归分解 | 人物画像、事件数据 | 层级化事件树 |
| `event.scheduler.Scheduler` | 事件调度与规划核心类，管理事件的生成和时间安排 | 人物画像 | 事件序列 |
| `event.Prob_Model` | 事件生成概率模型，控制事件类型和频率的分布 | 人物画像特征 | 事件概率分布 |


**EventTree类核心方法**：
- `__init__(persona)`：初始化事件分解器，加载模板
- `_decompose_single_node(parent_event, current_depth=0, background_info="")`：递归分解单个事件节点


**Scheduler类核心方法**：
- `main_gen_event()`：生成基础事件序列
- `main_schedule_event()`：对基础事件进行时间规划和调度，包括每月事件并行规划和月交界处事件处理
- `main_decompose_event()`：调用EventTree将规划后的事件分解为层级事件树结构

#### 5.2.3 输入输出
**输入**：
- `persona.json`：人物画像数据，包含人物特征和生活背景

**输出**：
- `event_1.json`：初始生成的事件列表
- `event_2.json`：经过时间规划后的事件列表
- `event_decompose_dfs.json`：分解后的层级事件树结构


#### 5.2.4 主要流程
1. 解析命令行参数，配置运行环境和处理选项
2. 读取人物画像数据，初始化事件生成环境
3. 初始化调度器，根据配置参数设置并行线程数
4. 调用`Scheduler.main_gen_event()`生成基础事件序列（可跳过）
5. 调用`Scheduler.main_schedule_event()`对事件进行时间规划和排序（可跳过）
6. 使用`EventTree`将大事件分解为更小的子事件，形成层级事件树（可跳过）
7. 重排事件并分配唯一ID，确保事件序列的一致性
8. 输出处理结果和执行时间统计

#### 5.2.6 示例
```bash
# 完整流程运行
python event_gen.py --base-path output/ --process-path process/ --max-workers 16

# 仅执行事件重排和ID分配
python event_gen.py --only-reorder

# 跳过特定步骤
python event_gen.py --skip-gen --skip-schedule
```

### 5.3 模拟生成模块 (simulator)

#### 5.3.1 功能概述
协调各个模块，完成全年生活数据的模拟生成，包括事件精炼、数据生成和事件格式化，实现人物行为的拟人化模拟。

#### 5.3.2 涉及文件与子模块
| 子模块路径 | 功能描述 | 输入 | 输出 |
|------------|----------|------|------|
| `simulator.py` | 模拟生成模块入口文件，控制全年模拟流程 | 命令行参数 | 模拟结果文件 |
| `event.mind.Mind` | 人物思维过程模拟类，实现认知和决策模拟 | 事件数据、人物画像 | 思维状态和决策结果 |
| `event.mind.MindController` | 思维模拟流程控制器，管理多线程模拟执行 | 配置参数 | 模拟执行结果 |
| `event.event_refiner.EventRefiner` | 事件精炼类，优化原始事件的细节和合理性 | 原始事件 | 精炼后的事件 |
| `event.event_formatter.EventFormatter` | 事件格式化类，统一事件输出格式 | 事件数据 | 格式化事件 |


#### 5.3.3 输入输出
**输入**：
- `persona.json`：人物画像数据，包含人物特征和行为模式
- `event_decompose_dfs.json`：分解后的层级事件树，包含全年事件结构

**输出**：
- `process/event_decompose_1.json`：精炼后的事件列表
- `output.json`：每日生活事件数据文件


#### 5.3.4 主要流程
1. 解析命令行参数，配置模拟参数和日期范围
2. 读取人物画像数据，初始化模拟环境
3. 执行事件精炼（可选）：使用`EventRefiner`处理原始事件
4. 构造长期记忆
5. 创建`MindController`实例，配置并行处理参数
6. 执行多线程并行处理，按日期生成全年每日事件
7. 使用`EventFormatter`格式化输出最终结果
8. 统计执行时间和模拟结果

#### 5.3.6 示例
```bash
python simulator.py --start-date 2025-01-01 --end-date 2025-12-31 --max-workers 30
```

### 5.4 手机操作生成模块 (phone_gen)

#### 5.4.1 功能概述
生成与人物生活事件相关的手机数据，包括通话、短信、日历、相册、应用推送等，实现人物数字足迹的模拟。

#### 5.4.2 涉及文件与子模块
| 子模块路径 | 功能描述 | 输入 | 输出 |
|------------|----------|------|------|
| `phone_gen.py` | 手机操作生成模块入口文件，协调各手机数据生成器 | 命令行参数 | 手机数据文件集合 |
| `event.phone_data_gen.Data_extract` | 手机数据提取器，从事件中提取相关信息 | 事件数据、人物画像 | 提取的事件特征 |
| `event.phone_data_gen.CommunicationOperationGenerator` | 生成通话和短信数据 | 事件特征、联系人信息 | 通话记录、短信记录 |
| `event.phone_data_gen.NoteCalendarOperationGenerator` | 生成笔记和日历数据 | 事件特征 | 笔记内容、日历条目 |
| `event.phone_data_gen.GalleryOperationGenerator` | 生成相册数据 | 事件特征 | 相册条目和描述 |
| `event.phone_data_gen.PushOperationGenerator` | 生成应用推送数据 | 事件特征、人物兴趣 | 应用推送记录 |


#### 5.4.3 输入输出
**输入**：
- `persona.json`：人物画像数据，包含人物特征和社交关系
- `phone_data/contact.json`：联系人信息，包含姓名和电话号码
- `event_update.json`：事件更新数据，包含最新的事件信息

**输出**：
- `phone_data/event_call.json`：通话记录数据
- `phone_data/event_note.json`：笔记和日历数据
- `phone_data/event_gallery.json`：相册数据
- `phone_data/event_push.json`：应用推送数据

#### 5.4.4 主要流程
1. 解析命令行参数，配置生成时间范围和并行参数
2. 读取人物画像和联系人信息
3. 初始化四种手机数据生成器：通信、笔记日历、相册、应用推送
4. 定义并行处理函数，处理单个日期的所有手机数据生成
5. 使用多线程并行处理全年日期，生成各类手机数据
6. 收集并输出处理结果统计

#### 5.4.6 示例
```bash
python phone_gen.py --start-time 2025-01-01 --end-time 2025-12-31 --max-workers 32
```

### 5.5 工具模块 (utils)

#### 5.5.1 功能概述
工具模块提供各核心模块通用的功能支持，包括文件操作、数据处理、LLM调用等基础工具，确保各模块能够高效协作。

#### 5.5.2 涉及文件与功能
| 文件路径 | 功能描述 | 输入 | 输出 |
|----------|----------|------|------|
| `utils.IO` | 文件读写工具，负责数据的加载和保存 | 文件路径 | 文件内容 |
| `utils.llm_call` | LLM调用接口封装，提供多种调用方式 | Prompt字符串 | LLM响应结果 |
| `utils.random_ref` | 随机参考数据选择工具 | 参考数据文件 | 随机选择的参考信息 |
| `utils.dataprocess` | 数据处理工具，提供数据转换和清洗功能 | 原始数据 | 处理后的数据 |
| `utils.count_events_by_date_range.py` | 事件统计工具，按日期范围统计事件数量 | 事件数据、日期范围 | 事件统计结果 |

## 6. 数据格式与配置文件

### 6.1 人物画像数据格式
人物画像是整个系统的核心输入，包含个人基本信息、位置信息、社会关系等多维度数据。

**字段定义：**
- `name`: 人物姓名
- `birth`: 出生日期（YYYY-MM-DD）
- `age`: 年龄
- `gender`: 性别
- `nationality`: 民族
- `home_address`: 家庭地址（包含province/city/district/street_name/street_number）
- `birth_place`: 出生地（包含province/city/district）
- `education`: 教育程度
- `job`: 职业
- `occupation`: 工作单位
- `workplace`: 工作地点（包含province/city/district/street_name/street_number）
- `belief`: 宗教信仰
- `salary`: 年薪
- `body`: 身体信息（包含height/weight/BMI）
- `family`: 婚姻状况
- `personality`: 性格特征（包含mbti/traits）
- `hobbies`: 兴趣爱好列表
- `favorite_foods`: 喜欢的食物列表
- `memory_date`: 重要记忆日期列表
- `aim`: 人生目标列表
- `healthy_desc`: 健康状况描述
- `lifestyle_desc`: 生活方式描述
- `economic_desc`: 经济状况描述
- `work_desc`: 工作状况描述
- `experience_desc`: 经历描述
- `description`: 综合描述
- `relation`: 社会关系网络

**示例：**
```json
{
  "name": "冯浩然",
  "birth": "1994-10-29",
  "age": 27,
  "gender": "男",
  "home_address": {
    "province": "湖南省",
    "city": "长沙市",
    "district": "岳麓区",
    "street_name": "麓山南路",
    "street_number": "156号"
  },
  "education": "大学本科",
  "job": "金融投资顾问",
  "occupation": "华泰证券股份有限公司",
  "personality": {
    "mbti": "ENTJ",
    "traits": ["成就", "权力", "社会责任导向"]
  },
  "hobbies": ["摄影（街拍）", "跑步（晨跑）", "露营（野外）", "收藏邮票"],
  "relation": [
    [
      {
        "name": "冯建国",
        "relation": "父亲",
        "social circle": "家庭圈",
        "gender": "男",
        "age": 58,
        "personality": "ISTJ"
      }
    ]
  ]
}
```

### 6.2 事件数据格式
系统定义了三种核心事件类型：主题事件、原子事件和每日事件，形成层次化的事件树结构。

#### 6.2.1 主题事件
主题事件是较大粒度的复合事件，包含一个或多个原子事件，具有明确的开始和结束时间范围。

**字段定义：**
- `event_id`: 事件唯一标识
- `name`: 事件名称
- `type`: 事件类型（如Relationships, Personal Life, Health等）
- `description`: 事件详细描述
- `participant`: 参与者列表（包含name/relation）
- `location`: 事件地点
- `start_time`: 事件开始时间（YYYY-MM-DD）
- `end_time`: 事件结束时间（YYYY-MM-DD）
- `decompose`: 是否可分解（1表示可分解，0表示不可分解）
- `subevent`: 子事件（原子事件）列表
- `date`: 事件发生日期数组

**示例：**
```json
{
  "event_id": 1,
  "name": "元旦与好友聚餐庆祝新年",
  "type": "Relationships",
  "description": "元旦当天，与在长沙的两位好友彭雨晴、吴俊杰在‘老长沙味道’湘菜馆共进晚餐，庆祝新年，回顾过去并分享新年计划。",
  "participant": [
    {
      "name": "彭雨晴",
      "relation": "好友"
    },
    {
      "name": "吴俊杰",
      "relation": "大学同学"
    }
  ],
  "location": "长沙，雨花区‘老长沙味道’湘菜馆",
  "start_time": "2025-01-01",
  "end_time": "2025-01-01",
  "decompose": 1,
  "subevent": [
    {
      "event_id": "1-1",
      "name": "元旦聚餐邀请与确认",
      "date": ["2024-12-30"],
      "type": "Relationships",
      "description": "冯浩然通过微信分别联系好友彭雨晴和大学同学吴俊杰，提议元旦当晚聚餐庆祝新年。"
    }
  ],
  "date": ["2025-01-01至2025-01-01"]
}
```

#### 6.2.2 原子事件
原子事件是主题事件分解后的最小粒度事件，通常对应一天内的具体活动，具有明确的时间点或短时间范围。

**字段定义：**
- `event_id`: 原子事件唯一标识（继承自父主题事件，如"1-1"）
- `name`: 原子事件名称
- `date`: 事件发生日期数组
- `type`: 事件类型
- `description`: 事件详细描述
- `participant`: 参与者列表
- `location`: 事件地点
- `decompose`: 是否可分解（0表示不可再分解）

**示例：**
```json
{
  "event_id": "1-2",
  "name": "元旦聚餐当日赴约",
  "date": ["2025-01-01"],
  "type": "Relationships",
  "description": "元旦傍晚，冯浩然从家中出发，前往位于雨花区的‘老长沙味道’湘菜馆，与彭雨晴、吴俊杰会合。",
  "participant": [
    {
      "name": "冯浩然",
      "relation": "自己"
    },
    {
      "name": "彭雨晴",
      "relation": "好友"
    },
    {
      "name": "吴俊杰",
      "relation": "大学同学"
    }
  ],
  "location": "长沙市-雨花区‘老长沙味道’湘菜馆",
  "decompose": 0
}
```

#### 6.2.3 每日事件
每日事件是模拟生成的最细粒度事件，包含具体的时间点和详细的执行过程描述。

**字段定义：**
- `event_id`: 每日事件唯一标识
- `name`: 事件名称
- `date`: 事件发生日期数组（包含具体时间，YYYY-MM-DD HH:MM:SS）
- `type`: 事件类型
- `description`: 事件详细描述（包含执行方式和过程）
- `participant`: 参与者列表
- `location`: 事件地点（包含具体路径）

**示例：**
```json
{
  "event_id": "1",
  "name": "元旦晨跑与江景观察",
  "date": ["2025-01-01 07:15:00至2025-01-01 08:15:00"],
  "type": "Health",
  "description": "准时起床，换上专业跑步装备，进行10公里晨跑以开启新年。从麓山名园出发，慢跑至湘江风光带（岳麓区段），沿江折返。",
  "participant": [
    {
      "name": "冯浩然",
      "relation": "自己"
    }
  ],
  "location": "湖南省长沙市岳麓区金星中路187号麓山名园（起点）至湘江风光带（岳麓区段）"
}
```

### 6.3 手机数据格式
手机数据模型包含通话记录、短信、相册、笔记、推送通知、联系人等多维度手机操作数据，记录人物的日常数字行为。

#### 6.3.1 通话记录数据格式
**字段定义：**
- `type`: 数据类型（"call"）
- `event_id`: 关联事件ID
- `phoneNumber`: 电话号码
- `contactName`: 联系人姓名
- `start_time`: 通话开始时间（YYYY-MM-DD HH:MM:SS）
- `end_time`: 通话结束时间（YYYY-MM-DD HH:MM:SS）
- `direction`: 通话方向（0表示呼出，1表示呼入）
- `call_result`: 通话结果（如"接通"、"未接通"、"拒接"）

**示例：**
```json
{
  "type": "call",
  "event_id": "402",
  "phoneNumber": "13817894567",
  "contactName": "李芳",
  "start_time": "2025-01-01 11:30:00",
  "end_time": "2025-01-01 11:33:20",
  "direction": 0,
  "call_result": "接通"
}
```

#### 6.3.2 短信数据格式
**字段定义：**
- `type`: 数据类型（"sms"）
- `event_id`: 关联事件ID
- `message_content`: 短信内容
- `message_category`: 短信分类（如"事件关联"、"日常交流"）
- `random_type`: 随机类型
- `contactName`: 联系人姓名
- `contact_phone_number`: 联系人电话号码
- `timestamp`: 发送/接收时间（YYYY-MM-DD HH:MM:SS）
- `message_type`: 短信类型（"发送"或"接收"）

**示例：**
```json
{
  "type": "sms",
  "event_id": "402_related_1",
  "message_content": "鲈鱼要买多大的？草莓要几盒？",
  "message_category": "事件关联",
  "random_type": "无",
  "contactName": "李芳",
  "contact_phone_number": "13817894567",
  "timestamp": "2025-01-01 11:34:00",
  "message_type": "发送"
}
```

#### 6.3.3 相册数据格式
**字段定义：**
- `event_id`: 关联事件ID
- `type`: 数据类型（"photo"）
- `caption`: 照片描述
- `title`: 照片标题
- `datetime`: 拍摄时间（YYYY-MM-DD HH:MM:SS）
- `location`: 拍摄地点（包含province/city/district/streetName/streetNumber/poi）
- `faceRecognition`: 人脸识别信息列表
- `imageTag`: 图像标签列表
- `ocrText`: OCR识别文本
- `shoot_mode`: 拍摄模式
- `image_size`: 图像尺寸

**示例：**
```json
{
  "event_id": "402",
  "type": "photo",
  "caption": "徐静在超市购买鲈鱼和草莓，货架上摆满新鲜食材",
  "title": "IMG_20250101_113500",
  "datetime": "2025-01-01 11:35:00",
  "location": {
    "province": "上海市",
    "city": "上海市",
    "district": "浦东新区",
    "streetName": "张杨路",
    "streetNumber": "XX号",
    "poi": "世纪联华超市"
  },
  "faceRecognition": ["无"],
  "imageTag": ["鲈鱼", "草莓", "超市货架", "购物车", "生鲜区", "食品采购"],
  "ocrText": "无",
  "shoot_mode": "正常拍照",
  "image_size": "4032×3024"
}
```

#### 6.3.4 笔记数据格式
**字段定义：**
- `type`: 数据类型（"note"或"calendar"）
- `event_id`: 关联事件ID
- `title`: 笔记/日历标题
- `content`: 笔记内容
- `datetime`: 创建/更新时间（YYYY-MM-DD HH:MM:SS）
- `related_event_ids`: 关联事件ID列表
- `start_time`: 日历事件开始时间（仅calendar类型）
- `end_time`: 日历事件结束时间（仅calendar类型）
- `description`: 日历事件描述（仅calendar类型）

**示例（笔记）：**
```json
{
  "type": "note",
  "event_id": "435",
  "title": "数字化零售课程资料记录",
  "content": "一、课程信息：1. 课程名称：数字化零售实务；2. 资料包含课程大纲、费用详情和开班时间；3. 资料已发送至邮箱\n二、学习计划：1. 评估课程内容是否符合职业发展需求；2. 考虑是否报名参加",
  "datetime": "2025-01-03 10:45:00",
  "related_event_ids": "435"
}
```

**示例（日历）：**
```json
{
  "type": "calendar",
  "event_id": "458",
  "title": "消防检查",
  "description": "店铺消防检查安排在下午2点，请准时参加",
  "start_time": "2025-01-04 14:00:00",
  "end_time": "2025-01-04 15:00:00"
}
```

#### 6.3.5 推送通知数据格式
**字段定义：**
- `type`: 数据类型（"push"）
- `event_id`: 关联事件ID
- `title`: 推送标题
- `content`: 推送内容
- `datetime`: 推送时间（YYYY-MM-DD HH:MM:SS）
- `source`: 推送来源应用
- `push_status`: 推送状态（"已读"或"未读"）
- `jump_path`: 跳转路径

**示例：**
```json
{
  "type": "push",
  "event_id": "402",
  "title": "支付宝：生鲜支付成功",
  "content": "【支付宝】您已成功支付世纪联华超市订单#202501011135，金额86元，账单已同步至我的账单",
  "datetime": "2025-01-01 11:36:00",
  "source": "支付宝",
  "push_status": "已读",
  "jump_path": "支付宝→我的账单→订单#202501011135"
}
```

#### 6.3.6 联系人数据格式
**字段定义：**
- `name`: 联系人姓名
- `relation`: 关系类型（如"朋友"、"家人"、"同事"）
- `gender`: 性别
- `age`: 年龄
- `phoneNumber`: 电话号码
- `email`: 电子邮箱
- `avatar`: 头像
- `job`: 职业
- `company`: 公司
- `social_circle`: 社交圈
- `description`: 联系人描述

**示例：**
```json
{
  "name": "王丽",
  "relation": "朋友",
  "gender": "女",
  "age": 30,
  "phoneNumber": "13681792345",
  "email": "wangli@example.com",
  "avatar": "avatar_001.jpg",
  "job": "设计师",
  "company": "XX设计公司",
  "social_circle": "朋友圈",
  "description": "徐静的高中同学，毕业后一直保持联系，两人经常一起购物和吃饭"
}
```

## 7. 工程化设计

### 7.1 目录结构
```
├── event/                  # 事件相关代码
│   ├── __pycache__/        # 编译缓存
│   ├── copy/               # 复制文件
│   ├── data/               # 事件数据
│   ├── event_data/         # 事件数据存储
│   ├── local_models/       # 本地模型
│   ├── memory_file/        # 记忆文件
│   ├── phone_data/         # 手机数据
│   ├── DM.py               # 数据模型
│   ├── Prob_Model.py       # 概率模型
│   ├── mind.py             # 思维模块
│   ├── phone_data_gen.py   # 手机数据生成
│   ├── scheduler.py        # 事件调度
│   └── templates.py        # 模板文件
├── utils/                  # 工具函数
│   ├── __pycache__/        # 编译缓存
│   ├── IO.py               # IO操作
│   ├── dataprocess.py      # 数据处理
│   ├── llm_call.py         # LLM调用
│   ├── maptool.py          # 地图工具
│   └── random_ref.py       # 随机参考
├── event_gen.py            # 事件生成入口
├── persona_gen.py          # 人物画像生成入口
├── phone_gen.py            # 手机数据生成入口
├── simulator.py            # 模拟运行入口
└── PROJECT_DOCUMENTATION.md # 项目文档
```

### 7.2 效果展示

#### 7.2.1 全年数据统计
系统生成的全年生活数据统计：

| 数据类型 | 生成数量 | 覆盖率 |
|----------|----------|--------|
| 人物画像 | 1个 | 100% |
| 全年事件 | 1,645个 | 100%（365天） |
| 手机通话 | 2,350条 | 约6.4条/天 |
| 短信记录 | 3,820条 | 约10.5条/天 |
| 日历事件 | 450个 | 约1.2个/天 |
| 相册记录 | 1,280张 | 约3.5张/天 |
| 笔记记录 | 320条 | 约0.9条/天 |

## 8. 未来发展与优化方向

### 8.1 功能扩展
- 增加更多类型的生活数据（如社交媒体数据、健康数据）
- 支持更多变更丰富多样的生活生成，避免同质化数据
- 实现消耗token的减少，控制成本
- 集成更多的工具，丰富内容和真实性

### 8.2 技术优化
- 提升事件生成的连贯性和逻辑性
- 优化手机数据的多样性和真实性
- 改进大语言模型调用效率，减少成本
- 增加事件冲突检测和自动修复功能



## 9. 总结

本个人生活数据合成系统通过模块化设计与先进生成技术，实现了高度逼真的个人生活数据模拟。项目架构清晰、功能完整、性能优良，具有广泛的应用前景与扩展空间。未来将继续优化算法、扩展功能，为更多领域提供高质量的合成生活数据。