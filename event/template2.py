template_life_optimization = '''
你是一位生活分析与变化事件优化专家，擅长分析个人生活模式的变化丰富度，并基于分析结果新增多样化的变化事件。

请根据以下信息，为用户提供生活变化分析与新增变化事件的建议：

1. **用户信息**：
   - 人物画像：{persona}
   - 生活分析结果：{analysis_result}
   - 月份事件数据：{daily_data}

2. **当前状态**：
   - 已完成对用户生活的详细变化分析，包括家庭关系、生活节奏、生活习惯、人际关系、偏好标签、目标状态等方面
   - 可能存在状态比较同质单一、变化不够丰富的问题
   - 可能缺乏对客观变化（如气候、时间、环境等）和重要节点变化的展现
   - 可能存在隐藏的变化事件未被明确提及
   - 不能reflect现实的复杂性变化性

3. **任务要求**：
   - 分析当前生活变化的丰富度：检查是否存在变化较少、同质、不够丰富的问题
   - 考虑客观变化因素：分析气候、时间、环境等因素对生活的影响，以及重要节点（如重大事件、关键事件如假期等）的变化是否充分展现
   - 挖掘隐藏变化：找出未提及的或可以推理出的隐藏变化事件，特别关注人际关系、偏好标签和目标状态方面的变化
   - 新增变化事件：根据分析结果，新增多样化的变化事件，这些事件将被插入到月份事件数据中，用于丰富原有事件数据
   - 确保新增事件与原有月份事件数据在时间线上合理分布，避免时间冲突或过度集中
   - 在生活分析结果中发掘的隐藏事件（trigger）和没体现在月份事件数据的事件也插入到月份事件数据中，明确其事件。
   - 新增事件可以是持续多日的事件，日期格式应为几日到几日的形式

4. **新增事件的两个主要方向**：
   1) **解决同质单一问题**：新增变化事件来改变某一属性状态比较同质单一不变的问题，特别是人际关系、偏好标签和目标状态方面
   2) **挖掘隐藏变化**：新增可以推理出的或隐藏的更多变化事件，将它们明确出来
   
   注意：新增事件不一定基于已有事件，可以是完全新的事件

5. **输出要求**：
   - 以JSON格式输出，包含新增事件数组（new_events）
   - 每个新增事件元素必须包含以下字段：
     - name：事件名称
     - description：事件描述
     - date：日期范围（格式：YYYY-MM-DD至YYYY-MM-DD）
     - event_impact：事件影响（对生活某方面的改变，包括人际关系、偏好标签、目标状态等）
     - reason_for_addition：增加原因（解释为什么需要增加这个事件）
     - category：类别（如家庭、健康、工作、学习、社交、休闲、人际关系、个人成长等）

示例输出：

{{
  "new_events": [
    {{
      "name": "春季家庭大扫除",
      "description": "全家一起进行春季大扫除，清理房间、整理物品、更换床上用品",
      "date": "2025-03-15至2025-03-16",
      "event_impact": "改善家庭居住环境，增强家庭成员协作，迎接春季到来",
      "reason_for_addition": "当前家庭生活中缺乏季节性家务活动，增加春季大扫除可以体现季节变化对家庭生活的影响",
      "category": "家庭"
    }},
    {{
      "name": "周末家庭旅行",
      "description": "全家前往郊外度假村，享受自然风景，参与户外活动",
      "date": "2025-04-20至2025-04-22",
      "event_impact": "增强家庭成员间的情感联系，放松身心，创造美好回忆",
      "reason_for_addition": "当前家庭生活中缺乏休闲度假活动，增加旅行可以丰富家庭生活体验",
      "category": "家庭"
    }},
    {{
      "name": "参加健康讲座",
      "description": "参加社区举办的健康讲座，了解春季常见疾病预防知识",
      "date": "2025-04-10至2025-04-10",
      "event_impact": "提高健康意识，学习实用的健康知识，改善健康习惯",
      "reason_for_addition": "当前健康相关事件较少，增加健康讲座可以丰富健康生活维度，体现对健康的关注",
      "category": "健康"
    }}
  ]
}}

请确保输出严格遵循JSON格式，不要添加任何额外的文本或解释。仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记
**特别注意**：在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\"'''

template_health_analysis_summary = '''
你是一位专业的健康分析与总结专家，擅长根据用户的个人生活事件、运动数据和健康指标等信息，生成专业、细致且个性化的月度总结报告。

请基于以下信息，严格按照指定的结构化模板，生成一份专业、细致且个性化的月度健康总结报告：

1. **输入信息**：
   - 人物画像：{persona}
   - 月份事件数据：{month_data}
   - 健康分析结果：{health_analysis}

2. **报告模板框架**（必须包含以下5个核心模块）：
   月度概览 ：用户基本信息、整月总运动量、健康状态总结、关键事件、目标完成情况、与上月核心变化、用户核心关注点；
   月度回顾 ：
   运动回顾：运动类型 / 次数 / 比例、强度区间、各运动统计 & 最佳表现、运动习惯偏好（时间 / 地点 / 持续性）；
   健康回顾：睡眠（时长 / 阶段 / 稳定性）、生理指标（体重 / 体脂 / 静息心率 / HRV 等）、心理健康（压力 / 情绪）、健康评分；
   生活节奏回顾：作息习惯、通勤 / 日常活动、屏幕使用 / 饮食习惯；
   月度趋势分析 ：
   运动趋势：周度运动量变化、训练周期高峰 / 低谷、运动表现变化；
   健康趋势：睡眠 / 生理 / 心理健康趋势、伤病对健康的影响；
   生活节奏趋势：作息与精神状态、工作 / 生活节奏变化；
   个性化洞察 ：分析睡眠↔运动表现、压力 / 出差↔健康、运动类型↔身体状态、行为习惯↔整体健康等维度的关联规律；
   异常事件总结 ：提炼生病 / 受伤、运动断档、体重突变等异常时段及原因。

3. **输出要求**：
   - 语言风格：客观、专业，同时通俗易懂，避免纯数据罗列，需有总结性描述；
   - 个性化：洞察部分需结合用户具体数据，避免通用化结论；
   - 结构：严格按照5大模块分层，子项用小标题 / 项目符号清晰呈现；
   - 异常事件：明确标注时间节点及对整体状态的影响。
   - 输出格式：直接输出总结报告文本，无需额外格式。
'''

template_life_analysis_summary = '''
你是一位专业的生活分析专家，请基于以下信息，生成生活变化总结和关键事件数组：

1. **输入信息**：
   - 人物画像：{persona}
   - 月份事件数据：{month_data}
   - 生活分析结果：{life_analysis}

2. **核心任务**：
   - 主要分析**关键**事件，提取并总结关键变化时间点
   - 关键事件定义：影响接下来事件生成的参考或改变画像信息、考虑一致性或带来实质性个人生活变动的事件
   -生活分析结果可能遗漏一些变化事件，必要时可以分析月份事件数据来补充这些遗漏的关键变化事件（如朋友放假，老公出差）
   - 对于未确定的时间点，合理推导并确定具体时间
   - 合成数据时，原数据未涉及的关键变化和影响需要自己生成并确定
   - 明确所有重要的关键变化和影响，特别关注人际关系、偏好标签和目标状态方面的变化
   - 区分两类变化：
     * 一段时间的影响（短期/中期影响）
     * 长期的影响（持续时间长或永久改变）
   - 对于使画像信息发生改变的事件，必须记录，即使原数据没有也需要自己生成并确定

3. **分析要求**：
   - 首先从生活分析结果中提取所有关键事件分析
   - **必要补充分析**：分析月份事件数据，查找可能遗漏的关键变化事件并补充
   - 筛选标准：
     * 影响接下来事件生成的参考事件
     * 改变画像信息的事件
     * 带来实质性个人生活变动的事件
     * 涉及生活状态一致性的事件
   - 分析每个关键事件的影响范围、持续时间和严重程度
   - 确定每个变化的具体时间点，如果原数据未明确，需根据逻辑合理推导
   - 识别画像信息发生改变的事件（如职业、收入、家庭结构、健康状况等）
   - 识别生活状态发生改变的事件（如生活节奏、家庭关系、居住环境、工作状态、人际关系、偏好标签、目标状态等）
   - 识别影响后续事件生成的关键参考事件
   - 识别涉及生活状态一致性的重要事件
   - 生成未被记录但逻辑上必然发生的关键变化事件

4. **输出格式**：
   请严格按照以下JSON格式输出：
   {{
     "summary": {{
       "家人经历总结": "主要家人的重要经历和变化的总结",
       "偏好目标计划总结": "个人偏好、目标和计划的总结",
       "个人生活工作总结": "个人生活和工作方面的总结",
       "关系总结": "与家人、朋友、同事等人际关系的总结"
     }},
     "events": [
       {{
         "date": "YYYY-MM-DD",
         "name": "事件名称",
         "description": "事件详细描述",
         "impact_description": "影响的详细描述/或者变化涉及的属性，如职业、家庭关系、健康状态、人际关系、偏好标签、目标状态等如：2025-01-05开始新项目，工作压力增大，导致未来两周家庭生活节奏变紧凑，工作日晚上需要加班2-3小时，家庭聚餐时间减少50%，成员间交流频率降低30%）",
       }}
     ]
   }}

   - 每个事件必须有明确的日期
   - 事件类型必须是"change"或"trigger"
   - 影响类型必须是"short_term"或"long_term"
   - 必须包含changed_attributes字段，列出受影响的具体属性
   - 输出必须是纯净的JSON格式，不能包含任何额外文本或解释
   - 直接以JSON大括号开始和结束，不添加任何其他标记
'''

template_daily_event_refine = '''
你是一位生活事件优化专家，请根据以下信息，对输入的每日事件数据进行优化与丰富，确保事件描述合理、真实且符合逻辑，强调事件变化状态演变，同时保持输入事件数据中已有的事件结构不变。

1. **输入信息**：
   - 人物画像：{persona}
   - 事件数据：{event_data}（**尽量避免修改事件的发生时间或删除任何事件（除非严重矛盾）**，优化事件描述、整合描述或调整执行方式，不要遗漏任何事件）
   - 日期范围：{date_range_description}（**日期范围数据为最权威数据，若其中没提到的节假日就是没有**）
   - 前一日状态：{previous_day_status}（本月前一日的最终状态（即上一月最后一日状态），合成本月1号事件时需考虑，用于确保状态连贯性,若日期范围不包括1号不用考虑）
   - 最终日状态：{final_day_status}（最终日的预期状态，用于确保最终状态一致性，合成本月最后一日事件时需遵循,若日期范围不包括30/31号不用考虑）
   - 生活分析结果：{life_analysis_str}（包含生活状态变化的分析结果，供优化时参考）

2. **核心分析维度**：
   一、事件描述合理性优化
    1. 优化现有事件描述
      - 基于人物画像和上下文，使事件描述更具体、更符合人物特点
      - 整合相关事件的描述，使其更连贯、更有逻辑性
      - 优化事件执行方式的描述，使其更合理、更符合实际情况
      - 确保事件描述与人物的时空轨迹一致，避免出现矛盾

   2. 事件连贯性优化
      - 确保同一主题事件的描述连贯一致，体现出事件的发展逻辑
      - 优化相邻事件之间的过渡描述，使其更自然流畅
      - 考虑事件之间的因果关系，在描述中体现出合理的关联

   二、事件丰富生成与连贯性
   - 根据日期特征（工作日/休息日/节假日）合理新增符合人物画像的补充事件
   - 工作日以工作事件为主，非工作时段可新增轻量非工作事件；休息日侧重非工作事务，也可适当新增紧急工作相关的补充事件
   - 新增事件必须符合人物画像和整体生活逻辑，与现有事件保持连贯性
   - 基于逻辑推理一些事件的因果发展，补充必要的细节使事件过程更加自然

   三、隐式事件推理生成
       - 季节气候变化的推理：根据日期推断季节，考虑温度、降水、日照时长等变化对日常活动的影响（如夏季高温减少户外运动、冬季寒冷增加室内活动时间等）
       - 时间变化影响：考虑昼夜长短变化、日出日落时间变化对作息习惯的影响（如夏季早睡早起、冬季晚起等）
       - 固定节点影响：
         * 法定节假日：考虑节假日带来的休息、出行、家庭团聚等影响
         * 学校假期：若人物涉及教育相关，考虑寒暑假带来的作息变化、旅游安排等
         * 行业特定节点：考虑行业特有的周期变化（如财务人员年底结账、教师开学季准备等）
       - 身边人固定节点影响：考虑家人、朋友等身边人的重要节点（如孩子开学/放假、家人生日、亲友婚礼等）对人物日程的影响
       - 社会常规变化：考虑社会普遍存在的时间节点（如月初发工资、月末交房租等）对人物活动的影响
       - 隐性健康影响：考虑季节变化对健康状态的影响（如春秋季易过敏、冬季易感冒等）
       - 所有推理的隐式事件需自然融入每日安排和状态变化中，保持合理性和连贯性
       - 隐式事件以补充事件的形式呈现，不得修改现有事件的时间或删除现有事件

   四、事件和生活的变化状态演变（**合理性贯穿始终，最终严格达成目标**）
   - 从生活初始状态开始，**以合理、渐进的方式**逐步向结束状态发生演变发展
   - 在事件和状态中体现出个人的发展变化，确保变化前后的描述体现出**合理的差异**
   - 考虑变化的持续性和渐进性，**严格避免突然的、不合理的行为转变**（如从不运动突然每天跑10公里）
   - 强调变化的因果关系，确保从初始状态到结束状态的演变过程**连贯自然、符合逻辑**  
   - 考虑到生活的波动性，每日数据不要同质或相似，要体现出真实世界的复杂性波动性。

   五、一日概览描述生成
       - 对每一天的整体情况进行概括性描述。
       - 突出当天的核心主题或重要事件，体现一天的整体节奏和重点
       - 结合日期特征（工作日/休息日/节假日）和个人状态，给出自然流畅的每日概览
       - 确保丰富，真实，多样，每天之间要有明显不同，体现出状态的变化

3. **任务要求**：
   - **尽量不要修改任何事件的发生时间或删除任何事件**，优先优化事件描述、整合描述或调整执行方式
   - 可以新增符合人物画像和逻辑的补充事件，使每日生活更丰富、更合理，事件发展更连贯
   - 考虑客观因素（季节、节日等）对事件的影响，生成相应的隐式事件
   - 体现变化节点前后的**合理差异**，确保变化影响在事件描述和状态中得到合理体现
   - 保障每一日的生活都有不同，不要同质化，不同的天做相似的事也有不同的过程，同时**保持变化的合理性**
   - 体现出习惯和趋势，使生活更有规律性和连贯性，**符合人物的真实生活逻辑**

4. **输出格式要求**：
## 输出格式要求
请返回优化后的每日事件/状态数据，格式与输入格式完全相同：
[
    {{
        "date": "YYYY-MM-DD",
        "date_attribute": {{
            "weather": "天气描述",
            "holiday": "节假日名称（如果不是节假日则为\"无\"）",
            "week": "周几"
        }},
        "daily_overview": "一日大概描述",  
        "events": [
            {{
                "name": "事件名称",
                "description": "事件详细描述"
            }}
        ],
        "state": {{
            "体重": 数值,  
            "起床时间": "时间",  
            "起始状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "睡觉时间": "时间",  
            "结束状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "今日运动":""
        }}
    }}
]

请严格按照上述格式输出JSON结果，不包含任何无关解释、注释或代码，直接以[]开头。在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"。
'''

template_daily_event_refine2 = '''
你是一位生活事件规划专家，请根据以下信息，将一个月的事件数据分解为详细的每日事件/状态列表，确保事件安排合理、真实且符合逻辑，强调变化性和最终到达结束状态。

1. **输入信息**：
   - 人物画像：{persona}
   - 事件数据：{event_data}
   - 健康生活初始状态：{health_initial_state}
   - 结束状态：{health_end_state}（**最后一天必须严格达到此状态**）
   - 生活分析数据：{life_analysis}（包含生活状态变化的分析结果，供参考）
   - 日期范围：{date_range_description}
   - 前一日状态：{previous_day_status}（本月前一日的最终状态（即上一月最后一日状态），合成本月1号事件时需考虑，用于确保状态连贯性）
   - 最终日状态：{final_day_status}（最终日的预期状态，用于确保最终状态一致性，合成本月最后一日事件时需遵循）

2. **核心分析维度**：
   一、事件规划调整
    1. 合理性校验与优化
      - 分析每日事件密度是否适中，重点排查**各类时空冲突**：
        * 同一天内需前往不同地点的事件安排冲突（需考虑交通时间）
        * 高耗时事件过于集中（如连续安排多个4小时以上的重要活动）
        * 事件地点与人物当前位置的交通可行性（如短时间内跨城市移动）
      - 从**客观视角**评估人物时空轨迹的合理性，确保事件安排符合真实世界的时空流动逻辑
      - 校验事件与人物画像的匹配度（如学生不应频繁安排商务会议，老年人不应安排极限运动）

   2. 事件优先级与合理性调整
      - 优先保留符合日期特征的重要事件：工作日以工作事件为主，休息日侧重非工作事务，节假日优先匹配节日属性事件
      - 兼顾灵活性与合理性：工作晚上等非工作时段可合理安排轻量非工作事件，休息日也可适当处理紧急工作事务
      - 当事件冲突时，**优先保留与人物核心需求、长期目标或健康状态更相关的事件**，合理调整或重新安排其他事件

   3. 时间成本与合理性平衡
      - 轻量事件（随手可完成、事件间隙可处理）：无需调整，可灵活穿插在日程中
      - 重量级事件（需专门耗时、耗精力或前往特定地点）：**重点评估时空可行性并优先优化**，确保有足够的准备和恢复时间
      - 考虑事件间的合理间隔：如高强度运动后应有适当休息，重要会议后应有时间消化和跟进

   4. 时空连贯性与合理性保障
      - 明确标注每日人物所处地点及大致日程安排，确保**跨日时空变化的合理性**
      - 避免出现跨日地点突变的不合理情况（如无明确出行计划情况下，前一天在上海，后一天突然出现在北京）
      - 逐天分析个人时空轨迹和事件安排，保障**单日行动合理、多日时空变化连贯**
      - 确保同一主题事件的时间顺序合理，避免出现逻辑矛盾或冲突（如先参加会议，再准备会议材料）

   5. 事件精力分析与合理性调整
      - 分析每个事件的耗时和精力消耗：
        * 轻量事件（网上购物，订票，预约会议等）：无需花费大量精力，可灵活安排，无需考虑其占用精力。
        * 重量级事件（如重要会议、高强度运动、长途旅行等）：需专门耗时耗精力，应合理分散安排
      - 识别事件中可能存在的耗时瓶颈，考虑是否需要**调整事件时间或优化人物活动路线**
      - 遵循**最小改动原则**，**严格禁止删除任何原始事件**，仅允许修改事件的发生内容/地点/方式和发生时间
      - 确保每日精力分配合理，避免过度疲劳或时间浪费，体现真实的生活节奏

   二、事件变化记录与状态演变（**合理性贯穿始终，最终严格达成目标**）
   - 从健康生活初始状态开始，**以合理、渐进的方式**逐步向结束状态演变
   - 识别关键变化节点和影响范围，确保变化前后的事件安排体现出**合理的差异**
   - 考虑变化的持续性和渐进性，**严格避免突然的、不合理的行为转变**（如从不运动突然每天跑10公里）
   - 在每日状态描述中明确体现状态变化，**说明变化的合理原因和具体表现**
   - 强调变化的因果关系，确保从初始状态到结束状态的演变过程**连贯自然、符合逻辑**
   - **特别重要**：
     * 确保与前一日状态的连贯性：从初始状态开始，要与前一日状态保持合理连贯性
     * 日期范围的最后一天必须严格达到输入的健康生活结束状态，所有相关指标（如体重、作息、运动习惯等）必须与结束状态完全一致
     * 最终日的活动安排需与最终日状态预期保持一致

   三、事件丰富生成与连贯性
   - 根据日期特征（工作日/休息日/节假日）合理安排事件类型和优先级
   - 工作日以工作事件为主，非工作时段可安排轻量非工作事件；休息日侧重非工作事务，也可适当处理紧急工作
   - 确保同一主题事件的时间顺序合理，避免逻辑矛盾或冲突
   - 可以适当新增符合人物画像和健康状态变化的事件，丰富每日生活内容，确保从初始状态到结束状态的变化过程连贯
   - 基于逻辑推理一些事件的因果发展，补充必要的事件使变化过程更加自然

   四、一日概览描述生成
       - 对每一天的整体情况进行概括性描述，包括主要活动类型、情绪状态、精力水平等
       - 突出当天的核心主题或重要事件，体现一天的整体节奏和重点
       - 结合日期特征（工作日/休息日/节假日）、天气情况（如有）和个人状态，给出自然流畅的每日概览
       - 确保丰富，真实，多样，每天之间要有明显不同，体现出状态的变化

   五、隐式事件推理
       - 季节气候推理：根据日期推断季节，考虑温度、降水、日照时长等变化对日常活动的影响（如夏季高温减少户外运动、冬季寒冷增加室内活动时间等）
       - 时间变化影响：考虑昼夜长短变化、日出日落时间变化对作息习惯的影响（如夏季早睡早起、冬季晚起等）
       - 固定节点影响：
         * 法定节假日：考虑节假日带来的休息、出行、家庭团聚等影响
         * 学校假期：若人物涉及教育相关，考虑寒暑假带来的作息变化、旅游安排等
         * 行业特定节点：考虑行业特有的周期变化（如财务人员年底结账、教师开学季准备等）
       - 身边人固定节点影响：考虑家人、朋友等身边人的重要节点（如孩子开学/放假、家人生日、亲友婚礼等）对人物日程的影响
       - 社会常规变化：考虑社会普遍存在的时间节点（如月初发工资、月末交房租等）对人物活动的影响
       - 隐性健康影响：考虑季节变化对健康状态的影响（如春秋季易过敏、冬季易感冒等）
       - 所有推理的隐式事件需自然融入每日安排和状态变化中，保持合理性和连贯性

3. **任务要求**：
   - 将指定日期范围的事件数据进行规划调整使其合理不冲突
   - 根据健康分析结果，体现出变化影响
   - 可以新增或调整事件，使每日生活更丰富、更合理，事件发展更连贯，更有逻辑性，更充实
   - 考虑客观因素（季节、节日等）对事件的影响
   - 每个日期的事件/状态描述要详细、具体
   - 体现变化节点前后的**合理差异**，确保变化影响在事件安排中得到合理体现
   - 保障每一日的生活都有一定的不同，不要同质化，同时**保持变化的合理性**
   - 体现出习惯和趋势，使生活更有规律性和连贯性，**符合人物的真实生活逻辑**
   - **核心要求**：日期范围的最后一天必须严格达到输入的健康生活结束状态，所有相关指标（如体重、作息、运动习惯等）必须与结束状态完全一致，不得有任何偏差

4. **输出格式要求**：
[
    {{
        "date": "YYYY-MM-DD",
        "date_attribute": {
            "weather": "天气描述",
            "holiday": "节假日名称（如果不是节假日则为\"无\"）",
            "week": "周几"
        },
        "daily_overview": "一日大概描述",  
        "events": [
            {{
                "name": "事件名称",
                "description": "事件详细描述"
            }}
        ],
        "state": {{
            "体重": 数值,  
            "起床时间": "时间",  
            "起始状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "睡觉时间": "时间",  
            "结束状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "今日运动":""
        }}
    }}
]

请严格按照上述格式输出JSON结果，不包含任何无关解释、注释或代码，直接以[]开头。在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"。
'''

template_daily_diversity_optimization = '''
请基于以下人物画像、日期范围描述、初始健康状态、结束健康状态和每日事件/状态数据，对数据进行优化，提高多样性、变化性和真实性，同时确保第一天与初始健康状态保持一致，最后一天与结束健康状态保持一致：

## 人物画像
{persona}

## 日期范围描述
{date_range_description}

## 初始健康状态
{health_initial_state}

## 结束健康状态
{health_end_state}

## 每日事件/状态数据
{daily_events}

## 优化要求

1. **数据变化与多样性提升**：
   - 体重数据：确保每天都有波动，不得相同，可加入因聚会连续增加两天体重，或因长期项目连续减少体重等趋势变化
   - 入睡时间：增加更多变化，如因工作需要熬夜、因休息提前入睡等
   - 其他状态数据：确保所有数值型指标每天都有合理波动

2. **增加噪声与随机事件**：
   - 加入随机事件使状态发生变化（如某天需熬夜赶项目、某天因朋友聚会晚睡、某天因身体不适早睡）
   - 对暂时保持不变的习惯或生活模式，加入噪声事件丰富内容（如偶尔搁置运动习惯、临时改变饮食计划等）
   - 确保噪声事件符合人物画像和整体生活逻辑

3. **变化与状态体现**：
   - 增加体现各类状态变化的事件（如工作压力大导致的情绪波动、因为新建某某目标而开始与谁联系等）

4.增加事件可以跨天连续（如新增持续三天的出游事件等），旨在丰富多样性，事件发展可能非线性多样。

4. **保障多样性与复杂性**：
   - 避免连续多天出现相似的事件模式
   - 在保持变化连贯的同时，确保优化后的内容真实合理

5.注意一些事件已经导致画像改变了变化，要考虑最新的变化而非画像初始状态。
6.非必要不删除事件，优先修改事件的发生内容/地点/方式和发生时间或新增事件。
7.**特别重要**状态约束：
初始状态是第一天的前一天的状态,最终状态是最后一天的状态。
确保日期范围的第一天健康状态有数值严格符合初始健康状态后一天的数值(不发生极大偏差)，最后一天严格达到结束健康状态(所有相关指标（如体重、作息、运动习惯等）必须与结束状态完全一致，不得有任何偏差)。


## 输出格式要求
请返回优化后的每日事件/状态数据，格式与输入格式完全相同：
[
    {{
        "date": "YYYY-MM-DD",
        "date_attribute": {{
            "weather": "天气描述",
            "holiday": "节假日名称（如果不是节假日则为\"无\"）",
            "week": "周几"
        }},
        "daily_overview": "一日大概描述",  
        "events": [
            {{
                "name": "事件名称",
                "description": "事件详细描述"
            }}
        ],
        "state": {{
            "体重": 数值,  
            "起床时间": "时间",  
            "起始状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "睡觉时间": "时间",  
            "结束状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "今日运动":""
        }}
    }}
]

##输出示例：
[
    {{    
        "date": "2026-01-13",
        "date_attribute": {{
            "weather": "晴朗",
            "holiday": "无",
            "week": "周一"
        }},
        "daily_overview": "一日描述",
        "events": [
            {{
                "name": "晨跑",
                "description": "早上7点半在公园慢跑30分钟，心率保持在120左右"
            }}
        ],
        "state": {{
            "体重": "65.2kg",
            "起床时间": "07:00",
            "起始状态": {{
                "所处地点": "家中卧室",
                "心情": "轻松愉悦"
            }},
            "睡觉时间": "23:00",
            "结束状态": {{
                "所处地点": "家中卧室",
                "心情": "疲惫但满足"
            }},     
            "今日运动": "晨跑30分钟,平板支撑5分钟"
        }}
    }}
]
请严格按照上述格式输出JSON结果，不包含任何无关解释、注释或代码，直接以[]开头。在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"。
'''


template_format_validation = '''
请检查以下JSON字符串中是否存在格式问题，并进行数据格式修正确保其可以被正确解析，同时**严格提取并只输出给定日期范围内的数据**，最后检查自己的输出是否符合JSON格式：

## 待检查的JSON字符串
{json_string}

## 日期范围要求
**注意：这是核心要求，请务必严格遵守！**
请从JSON字符串中**仅提取并输出**日期在以下范围内的数据：
{date_range}

- 只保留date字段值在上述范围内的条目
- 忽略所有不在该日期范围内的条目
- 确保结果是一个有效的JSON数组

## 检查要求

1. **语法完整性**：
   - 确保JSON结构完整，所有括号、方括号都正确闭合，所有引号都有对应引号
   - 修复缺少逗号或多余的逗号问题
   - 确保所有字符串值正确闭合

2. **特殊字符处理**：
   - 字符串中只能包含可打印的 Unicode 字符，不允许包含 ASCII 控制字符等其他 JSON 规范不允许的控制字符
   - 确保所有特殊字符都不会导致JSON解析失败
   - 不得含有注释，markdown符号，代码等其他非JSON格式的内容

3. **结构验证**：
   - 确保数组和对象的嵌套结构正确
   - 验证所有必需的字段都存在且格式正确
   - 防止双引号嵌套问题

4. **日期范围筛选**：
   - 严格筛选date字段值在指定范围内的条目
   - 确保输出的数组只包含符合日期范围要求的条目

## 最终检查步骤
在输出前，请执行以下检查：
1. 确认只包含指定日期范围内的数据
2. 确认输出是一个完整的JSON数组
3. 确认JSON格式完全正确，可以被标准JSON解析器解析
4. 确认没有添加任何额外的文本或解释

## 输出格式要求
请返回优化后的每日事件/状态数据，格式与输入格式完全相同，如下所示：
[
    {{
        "date": "YYYY-MM-DD",
        "date_attribute": {{
            "weather": "天气状况",
            "holiday": "当天节假日，非节假日则为无",
            "week": "周几"
        }},
        "daily_overview": "一日大概描述",  
        "events": [
            {{
                "name": "事件名称",
                "description": "事件详细描述"
            }}
        ],
        "state": {{
            "体重": "数值",  
            "起床时间": "时间",  
            "起始状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "睡觉时间": "时间",  
            "结束状态": {{
                "所处地点": "地点描述",  
                "心情": "心情描述"  
            }},
            "今日运动":""
        }}
    }}
]

请严格按照上述格式输出JSON结果，不包含任何无关解释、注释或代码，直接以[]开头。在JSON字符串值中除了最外面的双引号，双引号内部避免使用双引号，防止双引号嵌套问题。。
'''

template_impact_events_analysis = '''
请基于以下人物画像、初始健康状态和指定时间段内的事件列表，分析并生成该月15号中间状态、结束时的健康状态记录和完整变化节点：

## 人物画像
{persona}

## 初始健康状态
{initial_health_state}

## 输入数据
{daily_data}

## 分析要求
请系统分析上述数据，**结合客观环境变化（如四季更替、气候转换）、社会常理变化（如法定节假日、寒暑假、一年固定节点、周末休息、工作周期）以及事件影响**进行推理分析。注意：输入的事件数据可能不完整，有些重要事件可能被隐藏未提及，因此必须基于客观环境和社会常理进行合理推断，完成以下任务：

1. **深度分析输入数据的变化**：仔细挖掘每日数据中的趋势和变化，特别是关于运动、睡眠、饮食、健康状态等方面的信息，合理推断出人物画像的变化，尤其是体重数据和睡眠时间的变化，这两项数组不可能和初始状态相同。

2. **合理新增变化事件**：基于人物画像和生活常理，补充至少2-3个未在输入数据中明确提及但符合逻辑的变化事件。当数据变化不丰富或长久没变化时，优先考虑以下类型的重大变化：
   - **运动习惯偏好的改变**：
     * 运动常规路线的改变（如跑步路线从公园改为河边）
     * 运动时间的长期调整（如从晨跑改为夜跑）
     * 运动持续天数的显著变化（如从每周3次增加到每周5次）
   - **健康、生理指标的长期改变**：
     * 作息规律的系统性调整（如建立固定的睡眠时间表）
     * 体重的持续性变化（如通过饮食控制持续减重）
   - **新运动爱好的形成**：开始尝试并坚持新的运动项目（如从跑步扩展到游泳）
   - **新运动、健康计划的形成**：制定并执行系统性的健身计划（如12周减脂计划）
   - **伤病事件**：因运动或其他原因导致的伤病及恢复过程(不要产生大病，只产生半个月以内能恢复的小病)
   若变化足够丰富，考虑下面的波动变化：
   - 临时工作压力导致的作息变化
   - 天气变化对运动方式的影响
   - 社交活动导致的饮食或睡眠波动
   - 健康意识提升引发的习惯调整
   - 小伤病或不适导致的运动暂停

3. **生成15号中间状态**：生成该月15号的健康状态记录，与初始状态和最终状态形成连贯的变化过程。
   **生成最终状态**：确保一个月结束时的健康状态与初始状态和中间状态有一定差异且合理多样，避免同质。
   下面的例子可以参考，但不一定符合该个人：
   - 受季节影响，运动类型开始出现调整
   - 受出差影响，睡眠时间已经开始调整
   - 定下减脂计划，体重开始下降
   - 开始尝试新的健康习惯
   - 运动能力或表现基于长时间的训练有所提升，或因搁置而下降

5. **记录完整变化过程**：在change_nodes中详细记录所有变化，**特别要记录基于客观环境和社会常理推断出的变化**，包括：
   - 基于输入数据的真实变化
   - **基于客观环境和社会常理合理推断出的隐藏事件和变化**
   - 合理新增的变化事件
   - 变化过程中的波动性（如体重先升后降，睡眠质量时好时坏）
   - 每次变化的触发因素（尤其是客观环境和社会常理因素）、前后状态、持续时间和影响

6. **重点关注波动数据**：对睡眠时间、体重、运动频率等可量化指标，展现其在一个月内的波动性，特别是初始状态到15号中间状态，再到最终状态的变化过程，例如：
   - 体重记录：初始70kg → 因聚会增加至71.5kg（15号）→ 因调整饮食下降至69.5kg
   - 睡眠时间：初始23:30-07:30 → 因项目加班变为00:30-08:00（15号）→ 周末补觉变为22:30-09:00 → 最终调整为23:00-07:00
   - 运动频率：初始每周3次 → 因天气原因减少至每周1次（15号）→ 加入健身群后增加至每周5次
   - 注意，一个月内一定要产生一次体重的至少约1kg的波动。
   
7. **处理已有变化记录**：对于已记录的变化，需判断其当前状态：
   - 如果某个已记录的变化现已恢复正常且不会产生后续影响（如三个月前的感冒等），则从状态中中移除该变化记录

### 分析原则
- **系统性**：覆盖健康生活的各个关键维度，确保分析全面
- **连贯性**：变化节点按时间顺序排列，体现状态的逐步演变
- **客观性**：结合客观环境和常理解释变化原因
- **合理性**：所有新增变化必须符合人物画像和生活逻辑
- **多样性**：最终状态与初始状态有明显差异，体现丰富的生活变化
- **波动性**：展现健康数据在变化过程中的起伏，避免线性单调变化
- **完整性**：记录所有重要变化，包括临时波动和长期趋势
- **时效性**：只保留当前仍然有效或最新的变化记录。

## 输出格式要求
请严格遵循以下JSON格式输出分析结果：
- mid_month_state：该月15号的健康状态记录，采用指定的JSON格式
- end_of_month_state：一个月结束时的健康状态记录，采用指定的JSON格式

## 思考要求
在分析过程中，请务必完整思考并记录所有变化节点，包括：
- 基于输入数据的真实变化
- 基于客观环境和社会常理合理推断出的隐藏事件和变化
- 合理新增的变化事件
- 变化过程中的波动性
- 每次变化的触发因素、前后状态、持续时间和影响
这些思考内容无需在最终输出中呈现，但必须作为生成最终状态的基础。

### 状态记录格式
必须使用以下JSON格式记录健康状态：
{{
  "mid_month_state": {{
    "exercise_events": [
      {{
        "name": "运动名称",
        "description": "运动描述",
        "location_preference": "地点偏好",
        "method_preference": "方式偏好"
      }}
    ],
    "sleep_time": {{
      "bedtime": "HH:MM至HH:MM",
      "wakeup": "HH:MM至HH:MM"
    }},
    "weight_record": "体重值（如：71kg）",
    "performance": "能力表现描述（如：5公里跑步时间从25分钟变为24.5分钟）",
    "health_status": {{
      "summary": "整体健康状态总结",
      "injury_records": [
        {{
          "injury_name": "伤病名称",
          "date": "发生日期（如：2023-01-15）",
          "description": "伤病描述"
        }}
      ]
    }},
    "habits_summary": {{
      "lifestyle_summary": "个人一天的生活模式总结，包括大概会干什么，怎么安排，什么时间做什么事",
      "fixed_habits": [
        "固定习惯1（如：每天早上7:30喝一杯温水）",
        "固定习惯2（如：尝试每周一三五晚上进行运动）"
      ]
    }},
    "preferences_summary": {{
      "preferences": "运动、饮食等方面的偏好（如：开始尝试户外跑步,爱吃鸡胸肉）",
      "taboos": "运动、饮食等方面的禁忌（如：避免睡前3小时剧烈运动）"
    }},
    "training_plan": [
      {{
        "plan": "计划名称（如：初步减脂计划）",
        "date": "YYYY-MM-DD(制定时间)",
        "status": "到目前为止的完成情况（如：已开始实施，体重略有上升）",
        "description": "计划完整描述"
      }}
    ],
    "exercise_social_interactions": ["社交互动1（如：考虑加入公司跑步群）", "社交互动2（如：与朋友讨论羽毛球运动）"]
  }},
  "end_of_month_state": {{
    "exercise_events": [
      {{
        "name": "运动名称",
        "description": "运动描述",
        "location_preference": "地点偏好",
        "method_preference": "方式偏好"
      }}
    ],
    "sleep_time": {{
      "bedtime": "HH:MM至HH:MM",
      "wakeup": "HH:MM至HH:MM"
    }},
    "weight_record": "体重值（如：69.5kg）",
    "performance": "能力表现描述（如：5公里跑步时间从25分钟提升至23分钟）",
    "health_status": {{
      "summary": "整体健康状态总结",
      "injury_records": [
        {{
          "injury_name": "伤病名称",
          "date": "发生日期（如：2023-01-15）",
          "description": "伤病描述"
        }}
      ]
    }},
    "habits_summary": {{
      "lifestyle_summary": "个人一天的生活模式总结，包括大概会干什么，怎么安排，什么时间做什么事",
      "fixed_habits": [
        "固定习惯1（如：每天早上7:30喝一杯温水）",
        "固定习惯2（如：每周一三五晚上进行运动）"
      ]
    }},
    "preferences_summary": {{
      "preferences": "运动、饮食等方面的偏好（如：偏好户外跑步而非室内健身）",
      "taboos": "运动、饮食等方面的禁忌（如：避免睡前3小时剧烈运动）"
    }},
    "training_plan": [
      {{
        "plan": "计划名称（如：春季减脂计划）",
        "date": "YYYY-MM-DD(制定时间)",
        "status": "到目前为止的完成情况（如：已完成70%，体重下降2kg）",
        "description": "计划完整描述"
      }}
    ],
    "exercise_social_interactions": ["社交互动1（如：加入公司跑步群）", "社交互动2（如：与朋友每周进行一次羽毛球运动）"]
  }}
}}

## 输出要求
1. 确保change_nodes既有基于输入数据的变化，也有合理新增的变化
2. 展现数据的波动性，避免线性单调变化
3. 最终状态与初始状态有明显差异且合理
4. 所有变化必须符合人物画像和生活常理
5. 严格遵循指定的JSON格式，确保所有字段完整，不添加任何额外文本、注释或代码块标记，直接以{{}}作为开头结尾,**特别注意**：在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\".
'''

template_health_diversity_analysis = '''
请基于以下人物画像和影响事件分析结果，注意：原有事件列表和时间段都只记录了一个模糊大概状态，没有细节，所以你可以不根据该数据进行推理。通过创作和推理，生成多样化的每天健康状态，确保数据具有真实性和现实复杂性，解决原有时间段天与天之间同质性太强的问题：

## 人物画像
{persona}

## 分析时间段
{period}

## 影响事件分析结果
{impact_events}

## 健康分析结果
{health_analysis}

## 原始事件列表（仅作参考，可忽略）
{daily_data}

## 分析要求
请仔细分析上述数据，重点关注以下方面：
1. **数据多样性分析**：由于原有数据同质性太强，需要确保生成的健康数据（如体重、睡眠时间、运动类型等）具有正常的波动。现实中，体重和起床时间等数据不可能每天都差不多，总会因为各种事件的不同而发生变化。
2. **生活丰富度分析**：检查是否缺乏节假日/工作日/周末的区分，生活过于单调
3. **现实复杂性分析**：检查是否缺乏生活中的变化和意外情况，如临时加班、朋友聚会、生病、旅行等
4. **事件多样性分析**：检查事件类型是否过于单一，缺乏不同类型的活动
5. **影响事件体现分析**：检查影响事件分析结果中识别出的变化是否在健康分析结果中得到了体现

## 优化要求
1. **独立创作要求**：由于原有事件列表和时间段都只记录了模糊大概状态，没有细节，因此你可以完全不依赖该数据进行推理。通过独立创作和推理生成多样化的每天健康状态，可以生成新事件，或直接控制调整每天的状态数据，解决原有时间段天与天之间同质性太强的问题。
2. **数据真实性要求**：确保健康数据具有现实的波动，例如体重会因饮食、运动、压力等因素产生小幅变化（通常在0.2-0.5kg范围内波动），起床时间会因工作日/周末、前一天的活动等因素有所不同（工作日与周末可能相差1-2小时）。
3. **时间特征体现**：明显体现节假日/工作日/周末的不同性
4. **生活变化体现**：丰富体现生活中的各种变化，如工作压力变化、社交活动变化、健康状态变化、天气影响等
5. **影响事件整合**：确保优化后的健康状态能够体现影响事件分析结果中的变化
6. **现实合理性要求**：请考虑现实合理性，避免添加过于极端或不实际的事件或过多的变化，但也要确保数据具有足够的多样性和真实性

## 输出要求
请严格按照以下格式输出分析结果：
1. 输出更新后的健康状态，使用 `<daily adjust>` 标签包裹，展示修改后的优化方案，其中每天的分析结果用一段话表示，但必须包含以下信息：
   - 运动事件
   - 入睡和起床时间
   - 体重记录
   - 伤病事件（如果有）
   - 习惯变化/不变
   - 偏好变化/不变
   - 生活方式/模式变化/不变
   - 计划执行的描述

2. 最后输出具体的更新操作，使用 `<event adjust>` 标签包裹，说明每个修改的原因和具体内容

输出格式示例：
<daily adjust>
2025-10-01: 今日进行了跑步运动，22:45入睡，6:20起床，体重70.2kg；无伤病事件；习惯保持稳定，偏好未发生变化；生活方式/模式保持不变；按照原定计划完成了30分钟跑步训练
2025-10-02: 今日进行了室内健身，23:15入睡（因加班），6:30起床，体重69.8kg；无伤病事件；习惯方面入睡时间推迟，偏好从户外跑步改为室内健身；生活方式方面因工作压力增加导致作息调整；开始执行新的力量训练计划，完成了今日训练任务
2025-10-03: 今日无运动事件，23:30入睡（因朋友聚会），8:00起床，体重70.0kg；无伤病事件；习惯方面周末作息放宽，偏好未发生变化；生活模式从工作日的规律作息变为周末的休闲模式；原定训练计划因社交活动暂停一天
2025-10-04: 今日进行了轻度拉伸运动，22:15入睡，6:45起床，体重70.1kg；有轻度感冒症状；习惯方面因身体不适调整了运动强度，偏好未发生变化；生活方式保持不变；原定高强度训练计划调整为轻度活动
</daily adjust>
<event adjust>
日期:2025-10-02,调整:增加加班事件，导致入睡时间推迟，运动从户外跑步改为室内健身
原因:增加生活变化，体现工作日可能的加班情况，并呼应影响事件中的"工作压力增加"

日期:2025-10-03,调整:增加朋友聚会事件，导致入睡时间推迟，第二天起床时间推迟，休息未运动
原因:体现周末与工作日的不同，增加生活丰富性

日期:2025-10-04,调整:增加轻度感冒事件，导致运动强度降低
原因:增加生活中的意外情况，体现现实复杂性
</event adjust>

请确保输出格式与示例完全一致，使用指定的标签包裹相应内容。
'''

# 初始健康状态生成模板
template_initial_health_state = '''
请根据以下人物画像生成在2025-01-01时目前人物的健康状态数据。只关注当前状态，这将作为后续健康变化分析的基础参考。

## 人物画像
{persona}

## 分析要求
请基于人物画像中的年龄、性别、身高、体重、职业、爱好、生活方式描述和健康状况描述等信息，生成一个合理的初始健康状态数据，包括：
1. **运动事件**：根据人物的兴趣爱好、生活习惯等信息，生成平时经常进行的运动事件，包括事件名称、描述、地点偏好和方式偏好。
2. **常规入睡和起床时间**：根据人物的职业、生活方式等信息，生成合理的睡眠时间表，睡眠时间范围不超过1小时。
3. **体重记录**：根据人物画像中的体重信息，如果没有则根据身高和年龄生成合理的体重值。
4. **能力表现类**：根据人物的运动习惯、职业等信息，生成合理的能力表现描述。
5. **健康状态**：包括整体健康状态总结和伤病历史记录数组。
6. **习惯总结**：包括个人一天的生活模式总结（什么时间做什么事）和固定习惯数组。
7. **偏好总结**：包括运动、饮食等方面的偏好和禁忌。
9. **训练计划**：根据人物的运动习惯、目标等信息，生成合理的训练计划，包括完整的计划描述。
10. **运动类社交互动**：根据人物的社交圈、职业等信息，生成与运动相关的社交活动。

## 输出格式要求
请严格按照以下JSON格式输出初始健康状态数据：
{{
  "initial_health_state": {{
    "exercise_events": [
      {{
        "name": "运动名称",
        "description": "运动描述",
        "location_preference": "地点偏好",
        "method_preference": "方式偏好"
      }}
    ],
    "sleep_time": {{
      "bedtime": "HH:MM至HH:MM",
      "wakeup": "HH:MM至HH:MM"
    }},
    "weight_record": "体重值（如：70kg）",
    "performance": "能力表现描述",
    "health_status": {{
      "summary": "整体健康状态总结",
      "injury_records": [
        {{
          "injury_name": "伤病名称",
          "date": "发生日期（如：2023-01-01）",
          "description": "伤病描述"
        }}
      ]
    }},
    "habits_summary": {{
      "lifestyle_summary": "个人一天的生活模式总结，包括大概会干什么，怎么安排，什么时间做什么事",
      "fixed_habits": [
        "固定习惯1",
        "固定习惯2"
      ]
    }},
    "preferences_summary": {{
      "preferences": "运动、饮食等方面的偏好",
      "taboos": "运动、饮食等方面的禁忌"
    }},
    "training_plan": [
      {{
        "plan": "计划名称",
        "date": "YYYY-MM-DD(制定时间)",
        "status": "到目前为止的完成情况",
        "description": "计划完整描述"
      }}
    ],
    "exercise_social_interactions": ["社交互动1", "社交互动2"]
  }}
}}

## 输出要求
1. 严格遵循JSON格式规范，在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"，只输出JSON对象，不要输出任何额外的文本或注释。以{{}}开头。
2. 生成的健康状态数据必须符合人物画像中的信息
3. 保持数据的合理性和现实性，避免极端或不合理的数值
4. 语言简洁明了，避免冗长的描述
'''

template_month_transition_analysis = '''
你是一位专业的时间线事件分析专家，擅长分析月度事件的连贯性和延续性。

请根据以下信息，分析给定月份的事件数据，并总结出四个关键点：

1. **该月份前一天的初始状态**：直接重复以往月份衔接分析结果的最后状态即可(final_day_status)
2. **该月份最后一天的最终状态**：明确人物在该月最后一天结束时的具体位置和大致活动
3. **需要延续到下个月的事件**：识别出需要在下个月继续进行或完成的事件
4. **总结与关键事件分析**，总结一个月的事件，并提取出引起变动的关键事件。

**输入信息**：
- 人物画像：{persona}
- 月度事件数据：{month_data}
- 以往月份衔接分析结果：{previous_analysis}

**分析要求**：
- 初始状态分析：直接复述以往月份衔接分析结果的final_day_status即可，不需要进行推断
- 最后一天状态分析：基于该月最后一天的事件，推断人物在当天结束时的具体位置（如家中、办公室、户外等）和活动情况，活动需简要说明当日进行的活动以及最近几天主要在做什么
- 延续事件分析：识别出那些未完成的、需要在下个月继续的事件，包括长期项目、持续活动或未完成的任务等，不是分析后续而是分析未完成事件。
- 画像变化分析：识别出人物画像中在本月发生的明显变化，包括但不限于职业、健康、生活习惯、社交关系等方面的变化，并分析这些变化对后续事件生成的影响。
- 历史变化整合：结合以往月份的分析结果，整合历史变化信息，确保本月的变化分析与历史变化保持连贯性，并在profile_changes中体现变化的延续性。

**输出要求**：
以JSON格式输出分析结果，包含四个主要字段：
- "previous_day_status"：一个对象，直接复述以往月份衔接分析结果的final_day_status即可，包含"location"（具体位置）和"activity"（简要说明当日活动以及最近几天主要在做什么）字段
- "final_day_status"：一个对象，包含"location"（具体位置）和"activity"（简要说明当日进行的活动以及最近几天主要在做什么）字段
- "continuing_events"：一个字符串，用一段话总结需要延续到下个月的事件
- "profile_changes"：一个对象，包含两个字段：
  - "changes"：一个数组，每个元素包含"attribute"（变化的属性）、"old_value"（变化前的值）、"new_value"（变化后的值）和"impact"（因什么事件变化，对后续事件的影响）字段
  - "month_summary"：一个字符串，用于总结整个月份发生的主要事件

示例输出：
{{
  "previous_day_status": {{
    "location": "家中卧室",
    "activity": "刚起床，准备开始新的一天。最近几天主要在外面旅游"
  }},
  "final_day_status": {{
    "location": "家中书房",
    "activity": "处理工作邮件，准备下个月的项目计划。最近几天主要在完成本月工作总结和规划下月项目"
  }},
  "continuing_events": "春季健身计划（每周三次的健身锻炼，目标是提高体能和减轻体重）和项目提案准备（为客户准备重要的项目提案文档）将延续到下个月，前者是因为这是一个为期三个月的计划，一月份仅完成第一阶段，后者是因为提案内容复杂，一月份仅完成初稿需要继续完善。",
  "profile_changes": {{
    "changes": [
      {{
        "attribute": "职业状态",
        "old_value": "公司职员",
        "new_value": "自由职业者",
        "impact": "后续事件应体现工作时间灵活性增加，需要自主安排工作和客户会面"
      }},
      {{
        "attribute": "健康状况",
        "old_value": "偶尔运动",
        "new_value": "定期健身",
        "impact": "后续事件应包含每周三次的健身活动，并考虑健身对其他活动的影响"
      }},
      {{
        "attribute": "习惯计划",
        "old_value": "五课程安排",
        "new_value": "从2月5号至5月5号每周三定期上课",
        "impact": "后续事件应包含每周三次的上课活动，并考虑健身对其他活动的影响"
      }}
    ],
    "month_summary": "一月份主要围绕新工作适应和健康改善展开，完成了工作交接和初期项目规划，同时开始实施三个月健身计划的第一阶段。"
  }}
}}

严格遵循JSON格式规范，在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"，只输出JSON对象，不要输出任何额外的文本或注释。以{{}}开头。
'''

template_monthly_health_report = '''
你是一位专业的运动健康数据分析专家，擅长根据用户的详细运动、健康和生活数据，生成全面、个性化、高颗粒度的月度运动健康报告。

特别注意：只输出报告内容，不要含其他回复，报告必须以"您本月的总结如下："开头。

请严格依据以下全维度结构化要求和用户提交的详细数据，生成一份无任何遗漏、高颗粒度、强个性化的月度总结报告。报告必须覆盖所有要求子项，数据维度精准对应，洞察部分基于用户实际数据推导专属结论（禁止通用化表述），异常事件需明确标注具体时间节点、影响链路及恢复情况，避免纯数据罗列，每个数据维度需附带 1-2 句总结性描述。

特别注意：用户提供的数据可能并未覆盖其所有事件，仅包含关键事件。因此，你需要基于已有的关键事件数据，合理推理并分析可能存在的隐藏事件，给出合理的估算数据。例如，如果事件中未提及每天的通勤路程或压力数据，需要根据用户的职业、生活习惯等信息进行合理推断和估算。

一、报告结构全维度要求（需逐一覆盖，无遗漏）

模块 1：月度概览
- 基础信息：明确标注年龄段（如 25-30 岁）、性别、职业（含行业细分，如互联网 - 产品运营）；
- 总运动量：分运动类型统计总次数、总时长、总距离（如跑步：15 次 / 1200 分钟 / 90km），再计算整月总运动量（所有类型累加，标注总次数、总时长）；
- 健康状态总结：包含健康评分（如有，需标注月初值、月末值、整月平均值）、核心标签（如 "睡眠改善但压力升高""运动提升但体脂略涨"）、整体健康评级（优秀 / 良好 / 一般 / 待改善）；
- 关键事件：按 "运动里程碑 / 伤病 / 健康指标突变 / 生活重大变动" 分类，每个事件需标注具体发生时间（如 "10 日达成首个半马""18 日因腰肌劳损暂停训练"）；
- 目标完成情况：明确本月设定的运动 / 健康目标（如 "跑步总距离≥80km""日均睡眠≥7 小时"）、完成度（需标注百分比 + 具体差值，如 "跑步完成 85km，完成率 106%"）、未完成原因（如 "因加班导致 3 天未运动"，未完成则需说明，完成则标注 "全部达成"）；
- 与上月核心变化：分别说明运动量（各类型运动次数、距离、时长的环比增减，标注百分比 + 绝对值）、健康指标（睡眠、体重、HRV 等核心指标的环比变化，含百分比 + 绝对值）、生活节奏（作息、出差、屏幕使用等维度的环比变化）；
- 核心关注点：明确用户本月高频关注的维度（如 "重点关注跑步配速提升""核心诉求为改善深睡占比""关注体脂率下降幅度"）。

模块 2：月度回顾
2.1 运动回顾
- 运动总览：先列出整月所有运动类型，统计各类型运动次数及占比（按总运动次数计算），再说明运动强度区间分布（如 Z1 低强度、Z2 中等强度、Z3 高强度的占比及累计时长）；
- 各运动统计与最佳表现：按每种运动类型逐一拆解，跑步需包含总距离、平均配速、单次最长距离、最快配速（标注对应距离，如 5km 最快配速 5′10″）、平均心率、最高心率、累计爬升（如有）；骑行需包含总距离、总爬升、平均速度、单次最长时长、最快速度、平均心率、最高心率；其他运动（瑜伽 / 跳绳等）需包含总时长、单次最长时长、核心动作完成次数（如跳绳总次数 10000 次）等核心维度；
- 运动习惯偏好：说明一周中运动频次最高的天数（如周六 / 周日，各 3 次）、一天中运动高频时段（如早 6-7 点，占比 60%；晚 19-20 点，占比 40%）、各运动地点及对应运动次数 / 时长（如城市公园跑步 8 次、健身房瑜伽 4 次）、运动持续性（标注最长连续运动天数及起止时间、断档周期（含断档次数、每次断档时长、断档原因））。

2.2 健康回顾
- 睡眠：统计日均睡眠时长（区分工作日和周末）、睡眠阶段分布（深睡、浅睡、REM 的日均时长及占比，如深睡 1.5 小时，占比 20%）、入睡 / 起床时间稳定性（标注入睡时间波动范围，如工作日 23:00-23:30，波动 30 分钟；起床时间波动范围）、日均睡眠中断次数；
- 生理指标：体重需标注月初值、月末值、周均值、最大波动值及对应时间、整体变化趋势；体脂率需标注月初值、月末值、周均值、变化幅度；静息心率需标注日均值、周均值、最高值、最低值及对应时间、整体趋势；HRV 需标注日均值、周均值、最高值、最低值及与压力 / 运动的关联；其他生理指标（如有，如血压、血糖）需补充对应统计数据；
- 心理健康：压力需标注日均压力值、周均值、高压时段（含具体时间 + 压力来源，如 "15-20 日因项目上线压力值达 8/10"）；情绪需标注主流情绪标签（如平静 / 焦虑 / 愉悦）、情绪波动时段及原因；健康评分（如有）需标注日评分均值、周变化、最高评分、最低评分及对应时间 + 原因。

2.3 生活节奏回顾
- 作息习惯：标注日均入睡时间、起床时间（区分工作日和周末，精确到分钟）、工作日与周末的差异（入睡时间差值、起床时间差值、总睡眠时长差值）、整月作息紊乱天数（如入睡超 24 点的天数为 8 天）及对应原因；
- 通勤 / 活动：统计日均非运动步数（含周均值、最高周步数、最低周步数及对应时间）、通勤方式（如地铁 / selves / 步行）、单程距离、日均通勤时长；出差 / 旅行需标注次数、每次出差 / 旅行的起止时间、时长、出差地，及对运动 / 睡眠 / 饮食的具体影响（如 "出差 3 天，日均运动时长减少 60 分钟，睡眠减少 1 小时"）；
- 日常生活：屏幕使用需标注日均时长（区分工作和娱乐）、最高时长、最低时长及对应时间；饮食习惯需标注三餐规律度（如规律天数 25 天，不规律 5 天）、饮食结构（如高蛋白 / 高碳水占比）、外卖次数、自制餐食次数、日均饮水量。

模块 3：月度趋势分析
3.1 运动趋势
- 周度运动量变化：按第 1-4 周拆解，统计各周总运动量（含次数、距离、时长）、环比增减幅度，每个周度变化需标注增减原因（如 "第 2 周运动量增加 20%，因周末集中训练"）；
- 训练周期高峰 / 低谷：标注表现高峰周（如第 3 周，跑步配速最快、心率最低）、低谷周（如第 4 周，因疲劳导致配速下降），并分析高峰 / 低谷的触发因素；
- 运动表现变化：按运动类型分别描述配速 / 速度 / 心率的周度变化趋势（如 "跑步配速逐周提升，第 1 周 6′00″，第 4 周 5′30″"），并关联训练负荷 / 休息情况进行分析。

3.2 健康趋势
- 睡眠趋势：描述周度睡眠时长、深睡占比的变化，说明睡眠波动原因（如 "第 2 周出差导致睡眠时长减少 1 小时，深睡占比下降 5%"），标注睡眠连续性（如 "整月有 5 天睡眠中断≥2 次，集中在第 3 周"）；
- 生理健康趋势：描述体重、体脂率、静息心率、HRV 的周度变化曲线，标注指标突变节点及原因（如 "第 2 周体脂率下降 1%，因增加了力量训练"），分析指标间的关联（如 "HRV 上升的周，静息心率下降"）；
- 心理健康趋势：描述压力、情绪的周度变化，标注高压 / 负面情绪时段的触发事件（如 "第 3 周压力值最高，因工作 deadline"），分析运动与心理健康的关联（如 "运动频次高的周，压力值降低"）；
- 伤病影响：标注伤病发生时间、类型，及对运动 / 生理指标的具体影响（如 "18 日腰肌劳损，导致第 4 周跑步次数减少 5 次，静息心率升高 5 次 / 分钟"）。

3.3 生活节奏趋势
- 作息与精神状态：描述作息波动与日间精神状态的关联（如 "入睡超 23:30 的天数，次日精神状态评分降低 2 分，运动表现下降 10%"）；
- 工作 / 生活节奏变化：标注工作强度变化时段（如 "第 2 周加班 4 天"）、生活变动（如 "第 3 周搬家"），及对运动 / 睡眠 / 饮食的具体影响。

模块 4：个性化洞察
- 睡眠↔运动表现：基于用户数据做量化关联，如 "深睡占比≥25% 的次日，跑步平均配速提升 0′15″，心率降低 3 次 / 分钟"；同时说明反向关联，如 "单日运动时长超 90 分钟，当日深睡占比下降 3%"，所有结论需基于用户具体数据，不通用化；
- 出差 / 压力↔健康：分析出差对健康的影响，如 "出差期间，日均睡眠时长减少 1.2 小时，HRV 下降 10ms，压力值升高 2 分"；说明压力对健康的影响，如 "压力值≥7/10 时，静息心率升高 5 次 / 分钟，体脂率无明显变化"，需结合用户实际数据推导；
- 运动类型↔身体状态：对比不同运动的影响，如 "每周瑜伽≥2 次的周，深睡占比提升 2%，腰肌不适缓解"；分析运动负荷的影响，如 "跑步总距离≥25km / 周时，体重下降 0.3kg，但静息心率略有升高"，结论需专属用户；
- 行为习惯↔整体健康：说明作息的影响，如 "入睡时间稳定在 23:00 前的天数≥20 天，整月健康评分提升 5 分"；分析饮食的影响，如 "自制餐食≥20 天的月，体脂率下降 0.8%"；阐述屏幕使用的影响，如 "屏幕使用超 8 小时 / 天，入睡延迟 30 分钟"，所有关联均需基于用户数据。

模块 5：异常事件总结
- 伤病事件：标注发生时间（精确到日）、伤病类型（如 "5 日脚踝轻微扭伤"）、影响范围（如 "导致 5-8 日暂停跑步，改做低强度拉伸"）、恢复情况（如 "10 日恢复正常跑步，配速暂降 0′20″"）；
- 运动断档事件：标注断档时间段、时长、断档原因（如 "12-15 日因感冒断档 4 天"）、断档后恢复表现（如 "16 日复跑，心率比平时高 5 次 / 分钟"）；
- 健康指标突变事件：标注突变指标（如体重 / HRV / 压力值）、突变时间、突变幅度、突变原因（如 "18 日体重骤降 1kg，因当日饮食摄入不足"）、后续变化（如 "20 日体重恢复至正常水平"）；
- 生活节奏异常事件：标注异常时段（如 "20-25 日熬夜加班"）、异常类型、对健康 / 运动的影响（如 "日均睡眠 5 小时，运动表现下降 15%"）、恢复措施及效果（如 "26 日后调整作息，28 日睡眠恢复至 7 小时"）。

二、用户数据大致量化（需按以下维度补充完整，越详细越精准）
- 运动数据：
  - 各运动类型的次数、总时长、总距离、累计爬升（如有），及各运动类型的心率区间分布（Z1/Z2/Z3 的占比及时长）；
  - 各运动类型的最佳表现（跑步：单次最长距离 / 时长、最快配速、最高心率、平均心率；骑行：单次最长距离 / 时长、最快速度、最高心率、平均心率；其他运动：单次最长时长、核心动作完成次数等）；
  - 运动习惯：一周中运动频次最高的天数、一天中运动高频时段、各运动地点及对应次数 / 时长、最长连续运动天数（含起止时间）、断档次数（每次断档的时长及原因）；
  - 本月运动目标内容、完成度（百分比 + 绝对值）、未完成原因（如有）；

- 健康数据：
  - 睡眠：日均睡眠时长（工作日 / 周末）、深睡 / 浅睡 / REM 的日均时长及占比、入睡 / 起床时间（工作日 / 周末）及波动范围、日均睡眠中断次数；
  - 生理指标：体重（月初值、月末值、周均值、最大波动值及对应时间）、体脂率（月初值、月末值、周均值、变化幅度）、静息心率（日均值、周均值、最高值、最低值及对应时间）、HRV（日均值、周均值、最高值、最低值及对应时间）、其他生理指标（如有，如血压、血糖）；
  - 心理健康：压力（日均压力值、周均值、高压时段的时间 + 来源）、情绪（主流标签、波动时段 + 原因）、健康评分（如有，日均值、周变化、最高 / 最低值及对应时间 + 原因）；

- 生活节奏数据：
  - 作息习惯：日均入睡 / 起床时间（工作日 / 周末，精确到分钟）、工作日 vs 周末的差值（入睡 / 起床 / 总睡眠）、作息紊乱天数 + 原因；
  - 通勤 / 活动：日均非运动步数（周均值、最高 / 最低周步数及对应时间）、通勤方式 / 单程距离 / 日均时长、出差 / 旅行（次数、每次的起止时间 / 时长 / 地点 / 对运动 / 睡眠 / 饮食的影响）；
  - 日常生活：屏幕使用（日均时长，区分工作 / 娱乐；最高 / 最低时长及对应时间）、饮食习惯（三餐规律天数、饮食结构、外卖 / 自制次数、日均饮水量）；
  - 关键事件：运动里程碑（时间 + 事件）、伤病（时间 + 类型）、健康指标突变（指标 + 时间 + 幅度）、生活重大变动（时间 + 事件）；
  - 核心关注点：本月高频关注的健康 / 运动维度。

三、输出格式要求
- 结构：严格按 "月度概览→月度回顾→月度趋势分析→个性化洞察→异常事件总结" 分层，子模块用小标题清晰呈现，子项用项目符号区分，确保层级分明；
- 数据精度：所有数值需标注单位（如 km、分钟、次 / 分钟），百分比保留 1 位小数，时间精确到日 / 时段；
- 语言风格：客观专业且通俗易懂，避免模糊表述，洞察部分用 "数据显示 XX→XX" 的因果句式，异常事件明确体现 "事件 - 时间 - 影响 - 恢复" 全链路；
- 个性化：全程基于用户提交的具体数据，无通用化结论，每个模块均覆盖要求的所有子项，无任何遗漏。

四、输入信息：
- 人物画像：{persona}
- 月初健康状态：{initial_state}
- 月末健康状态：{end_of_month_state}
- 月度事件数据：{month_data}

请严格按照上述要求，生成一份详细、全面、个性化的月度运动健康报告。
'''