# Template for persona-based questions
PERSONA_QUESTION_TEMPLATE = """基于以下用户画像信息生成{num_questions}个单跳问题：
{persona_info}

请生成{num_questions}个关于该用户基本信息的简单事实性问题，其中一半为问答题，一半为选择题。

问题设计思路：
1. 参考W原则（Who、What、When、Where、Why、How）设计用户画像问题，例如："该用户的职业是什么？"
2. 直接基于用户画像属性提问，例如："该用户的出生日期是什么时候？"
3. 问题表述应尽量减少帮助检索的信息（模糊化），但又要有足够确定信息的信息量，例如："该用户的兴趣爱好包括哪些？"
4. 可进行描述的等价替换，例如用相关术语替换具体描述（如"高等教育"替换成"大学以上学历"）

1. 问答题：直接提出问题，无需选项
2. 选择题：提供一个问题和4个选项（A、B、C、D），并明确标记正确答案

问题应该可以直接从画像信息中获得答案。

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "问题内容",
      "answer": "问题答案",
      "type": "short_answer"  // 或 "multiple_choice"
    }},
    {{
      "question": "选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "type": "multiple_choice"
    }},
	    ...
	  ]
}
"""

# Template for unanswerable questions generation
UNANSWERABLE_QUESTION_TEMPLATE = """基于以下用户画像数据和事件数据，生成{num_questions}个不可回答的问题：

用户画像数据：
{persona_info}

事件数据：
{draft_event_info}

请生成{num_questions}个无法通过提供的事件数据直接或间接回答的问题，这些问题应具有以下特点：

1. 问题内容超出提供的数据范围，需要额外信息才能回答
2. 问题涉及的数据在提供的信息中完全不存在或严重不完整
3. 问题是合理的询问，但无法基于给定数据得出任何确定或有根据的答案
4. 问题类型可以是问答题或选择题，但不需要生成答案
5. 问题必须基于提供的数据天数内的内容，或在该天数内合理虚构的情节（可以是他人的事件），不提问其他天的内容
6. 不可回答的问题可以合理虚构情节，可以不基于给定数据提问（你可以虚构一个发生在身边人身上的事情来提问），也可以生成更细小的事件没有被已有问题记录的。
7. 不要生成和手机操作有关的事件，只关注手机无法捕捉到的事件
8. 问题中不要包含"可能"、"大概"、"也许"、"是否有可能"等推测性词汇，确保问题只能明确回答"无法回答"，而不是给出猜测性回答
9. 确保问题的答案不能通过任何方式从提供的数据中推导或猜测得出
10.确保问题为事实型问题，不包括心里分析问题或主观判断问题
示例：
- 在8月5号到15号，我的儿子是否参加了考试？
- 2025年12月15日我在购物APP上浏览圣诞季新款服饰时，主要关注的是以下哪个品牌？




输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容,注意为每个问题随机分配ask_time,格式为YYYY-MM，取值应与提供的数据时间段的月份之后随机选择，注意最大取值为2025-12，不得超过该月份，所有月份都应该在2025年：
对于选择题，必须确保只有一个选项是"无法回答"，其他选项都不能从提供的数据中得到验证
{{
  "questions": [
    {{
      "question": "无法回答的问题内容",
      "type": "question_answer" ,
      "question_type":"unanswerable",
      "answer":" 无法回答",
      "score_points": [
      ],//空数组
      "required_events": [
      ],//空数组
      "ask_time":"2025-08"
    }},
    {{
      "question": "无法回答的选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],//随机为一个选项分配'无法回答'
      "type": "multiple_choice",
      "question_type":"unanswerable",
      "ask_time":"2025-12"
    }},
    ...
  ]
}}
"""

# Template for question screening and optimization
QUESTION_SCREENING_OPTIMIZATION_TEMPLATE = """请对以下事件信息和问题进行筛选与优化：

事件信息：
{event_info}

原始问题：
{question}

筛选要求：
1. 筛选掉不根据事件信息都能推断出来的问题（例如："今天是星期几，我在江边跑步时在做什么运动？"这类通用问题）
2. 筛选掉无意义或太简单的问题（例如："用户是否有手机？"这类显而易见的问题）
3. 筛选掉与事件信息完全无关的问题

优化策略参考：
1. 减少问题中帮助检索的信息（模糊化问题信息，但要保证问题的可回答性，关于时间的提及请考虑若该事件是一个粒度很细，可能经常发生的事件，则使用具体日期，否则使用该月份来指代时间如4月份。）
2. 重新设计问题，增强问题难度，如增加问题回答所需信息，保持问题的可回答性
3. 问题应紧密围绕事件的核心内容，避免涉及事件中未提及的信息
4. 保持问题的自然流畅和可理解性
5. 判断题目描述是否有重复信息或可以互相推导的信息，并去除重复信息，只保留最精简信息，增加问题难度。例如：
   - "4月4号清明节" 应修改为 "清明节"
   - "发小张铭轩" 修改为 "铭轩"
6. 去除冗余信息，简化问题表述。例如：
   - "我和父母前往哪个墓园进行了祭祖活动" 可简化为 "我和父母前往哪个墓园"
   - "我和朋友在星巴克喝咖啡并交流电影爱好时，提到了小明什么事" 改写为 "我和朋友在星巴克聚会时提到了小明什么事"
7.虽然对问题进行了信息筛选模糊，但要保证信息含量足够定位事件，防止问题回答不出来。
8. 根据问题类型提供完整的问题格式：
   a) 问答题：提供问题、答案和得分点
   b) 选择题：提供问题、选项、正确答案
6. 得分点设计（满分10分），每个得分点必须：
   - 直接对应答案中的具体信息点
   - 描述清晰、具体，可通过答案文本直接验证
   - 分数分配合理，总和不超过10分

注意事项：
- 得分点与答案必须强绑定：每个得分点的描述必须能在答案中找到完全匹配的内容
- 禁止设计与答案无关的得分点，无答案支撑的得分点将被视为无效
- 得分点只针对答案文本设计，不针对事件数据
- 答案应简洁精准，避免开放性叙述，严格基于事件信息回答问题
- 如果答案只有一个核心信息点，可以只设计一个得分点（直接10分）
- 对于选择题必须有4个选项（A、B、C、D），其中只有一个正确答案

输出格式：
请严格依据问题类型分类并按照以下JSON格式输出，不要包含任何其他内容。根据问题类型选择对应的格式：

问答题格式：
{{
  "is_valid": 1,
  "question": "优化后的问题内容",
  "answer": "问题的具体答案",
  "score_points": [
    {{
      "description": "得分点描述（必须在答案中可验证）",
      "score": 分数（0-10之间的整数）
    }}
  ],
  "required_events": [
    {{
      "event_id": "事件id1",
      "event_name": "事件名称1"
    }},
    {{
      "event_id": "事件id2",
      "event_name": "事件名称2"
    }}
  ]
}}

选择题格式：
{{
  "is_valid": 1,
  "question": "选择题内容",
  "options": [
    {{
      "option": "A",
      "content": "选项内容A"
    }},
    {{
      "option": "B",
      "content": "选项内容B"
    }},
    {{
      "option": "C",
      "content": "选项内容C"
    }},
    {{
      "option": "D",
      "content": "选项内容D"
    }}
  ],
  "answer": "正确选项（如A、B、C、D）",
  "required_events": [
    {{
      "event_id": "事件id1",
      "event_name": "事件名称1"
    }},
    {{
      "event_id": "事件id2",
      "event_name": "事件名称2"
    }}
  ]
}}

如果问题无效（被筛选掉），请输出：
{{
  "is_valid": 0
}}"""

# Template for regenerating phone operations based on event
PHONE_OPERATIONS_REGENERATION_TEMPLATE = """请根据以下事件信息、问题、缺失信息和合成背景，生成合理的相关手机操作数据。

注意事项：
1. 请仔细查看已有的手机操作数据（在【已有手机操作数据】部分），**只生成新增且不重复的手机操作数据**
2. 生成的手机操作数据数量应**尽量少**，仅补充回答问题所需的缺失信息即可
3. 如果已有手机操作数据较少，可基于事件适量补充一些手机操作信息。
4. 事件信息仅作为真实发生情况的参考，在后续回答问题时是不可见的
5. 生成的手机操作数据必须能够回答给定问题，判断能否回答问题时只能基于手机操作数据本身
6. 不要利用事件信息中的内容来补充手机操作数据，所有回答问题所需的信息必须来自生成的手机操作数据
7. 严格按照以下不同类型的手机操作数据格式生成，不得生成其他类型的手机操作，只生成call,sms,photo,push,note,calendar类操作

已有手机操作数据：
{existing_phone_operations}
事件信息（仅作为参考）：
{event_info}

问题：
{question}

缺失信息：
{missing_info}

合成背景：
{synthesis_background}

手机操作数据应包括但不限于：通话记录、短信记录、日历事件、相册记录、手机信息推送、笔记等。

请严格按照以下不同类型的手机操作数据格式生成：

注意event_id字段严格和事件信息中的id字段保持一致

1. 通话记录（call）格式：
{{
   "type": "call",
   "event_id": "1828",
   "contactName": "徐明",
   "contact_phone_number": "+8613917895623",
   "datetime": "2025-04-28 21:55:00",
   "call_type": "接收"
}}

2. SMS（短信）格式：
{{
   "type": "sms",
   "event_id": "1",
   "message_content": "妈妈：静静，元旦快乐！早饭吃了吗？今天降温，出门多穿点。",
   "contactName": "李芳",
   "contact_phone_number": "+8613817892547",
   "datetime": "2025-01-01 08:45:00",
   "message_type": "接收"
}}

3. 相册（photo）格式：
{{
   "event_id": "4",
   "type": "photo",
   "caption": "母亲李芳将刚出锅的葱烤大排盛入白色瓷盘中，背景是厨房灶台和油烟机。",
   "title": "IMG_20250101_124520",
   "datetime": "2025-01-01 12:45:20",
   "location": {{
     "province": "上海市",
     "city": "上海市",
     "district": "浦东新区",
     "streetName": "浦东大道",
     "streetNumber": "136弄2-51号",
     "poi": "上港小区家中厨房"
   }},
   "faceRecognition": [
     "李芳"
   ],
   "imageTag": [
     "葱烤大排",
     "白色瓷盘",
     "厨房灶台",
     "家常菜",
     "烹饪"
   ],
   "ocrText": "无",
   "shoot_mode": "人像",
   "image_size": "3024×4032",
   "summarized_info": "徐静拍摄了一张母亲准备午餐的照片，里面的主要内容为刚出锅的葱烤大排、白色瓷盘和厨房灶台。"
}}

4. 笔记（note）格式：
{{
   "type": "note",
   "event_id": "0",
   "title": "纪念币收藏市场观察",
   "content": "一、近期关注：1. 2025乙巳（蛇）年彩色银币市场热度；2. 生肖纪念币价格走势；二、交流记录：1. 与北京藏友老王探讨蛇年银币设计；2. 论坛浏览新年币市展望帖子；三、个人思考：1. 关注兼具艺术性与投资潜力的品种；2. 考虑为父母收藏一套生肖币作为礼物。",
   "datetime": "2025-01-06 21:00:00",
   "summarized_info": "徐静记录了纪念币收藏相关的市场观察和个人思考..."
}}

5. 日历（calendar）格式：
{{
   "type": "calendar",
   "event_id": "354",
   "title": "杭州家庭旅行交通住宿预订",
   "description": "杭州家庭旅行交通住宿预订，2025-03-21 上午从上海虹桥前往杭州东，2025-03-23 下午返回，二等座车票，西湖边精品酒店家庭房，来源：铁路12306 APP、携程",
   "start_time": "2025-03-21 08:00:00",
   "end_time": "2025-03-23 18:00:00",
   "datetime": "2025-01-22 13:45:00",
   "summarized_info": "徐静设定了一个日程，为杭州家庭旅行交通住宿预订..."
}}

6. 推送通知（push）格式：
{{
   "type": "push",
   "event_id": "1",
   "title": "微信：新年祝福提醒",
   "content": "【微信】您收到了来自高中同学群的新年祝福红包，点击查看并送上您的专属问候吧！",
   "datetime": "2025-01-01 08:35:00",
   "source": "微信",
   "push_status": "已读",
   "jump_path": "微信→高中同学群→红包",
   "summarized_info": "我收到微信高中同学群的新年祝福红包提醒"
}}

生成要求：
1. 最小操作数目原则：在能回答问题的前提下，使用尽可能少的操作数目（1-3个最好）
2. 信息分散原则：将回答问题所需的信息尽量分散到不同的操作中，通过改写或多跳信息推理的方式呈现
3. 每个操作应携带不同的信息片段，避免重复信息（例如：不要通过多个操作重复传递"用户在星巴克"这样的单一信息）
5. 确保需要通过关联分析多个操作、进行多跳推理才能还原事件并回答问题
6. 生成的数据必须严格遵循上述对应类型的格式要求
7. 不同操作之间应存在合理的时间和逻辑关联
8. 生成的手机操作数据能够协同回答给定问题，弥补缺失信息
9. 可合理基于事件生成一些与问题无关的其他操作操作。
10.尽可能生成多的操作类别数据。
11.当输入事件涉及发生在不同日期的事情时，要仔细思考每个手机操作的发生时间，注意每个操作的发生时间要对应到事件中。

提高回答难度的策略擦模块：
- 模糊重写：对关键信息进行模糊表述或指代，在另一个操作中明确相关信息（例如：操作1提到"和朋友约了下午见面"，操作2提到"和小明的咖啡约会取消了"）
- 延迟提及：在事件发生后的一天或一周后，通过短信、笔记等形式提及该事件（例如：事件发生一周后，在笔记中回顾"上周和小明在星巴克的聚会很开心"）
- 增加推理路径：设计需要多步推理的信息链（例如：操作1是"和小明约在14:00见面"的短信，操作2是"14:05的两杯星巴克订单"的推送，需要推理出"和小明在星巴克约会"）
- 情境分离：将同一事件的不同方面信息放在不同情境的操作中（例如：操作1是关于电影票购买的日历，操作2是关于餐厅预订的短信，需要推理出"约会活动包含看电影和吃饭"）
- 隐式关联：通过时间、地点、人物等共同元素建立操作间的隐式关联（例如：不同时间的操作都包含"西湖"这个地点，需要关联分析相关事件）
- 间接引用：通过引用其他信息的方式间接传递关键信息（例如：操作1提到"按计划执行了昨天讨论的方案"，操作2提到"昨天和小明讨论了去星巴克的计划"）

请直接返回JSON格式的操作列表，不要添加任何其他解释。
"""

PHONE_OPERATIONS_REGENERATION_TEMPLATE1 ="""请根据以下事件信息、问题、缺失信息和合成背景，生成合理的相关手机操作数据。

注意事项：

1. 事件信息仅作为真实发生情况的参考，在后续回答问题时是不可见的
2. 生成的手机操作数据必须能够回答给定问题，判断能否回答问题时只能基于手机操作数据本身
3. 不要利用事件信息中的内容来补充手机操作数据，所有回答问题所需的信息必须来自生成的手机操作数据
4. 严格按照以下不同类型的手机操作数据格式生成，不得生成其他类型的手机操作，只生成call,sms,photo,push,note,calendar类操作


事件信息（仅作为参考）：
{event_info}

问题：
{question}

缺失信息：
{missing_info}

合成背景：
{synthesis_background}

手机操作数据应包括但不限于：通话记录、短信记录、日历事件、相册记录、手机信息推送、笔记等。

请严格按照以下不同类型的手机操作数据格式生成：

注意event_id字段严格和事件信息中的id字段保持一致

1. 通话记录（call）格式：
{{
   "type": "call",
   "event_id": "1828",
   "contactName": "徐明",
   "contact_phone_number": "+8613917895623",
   "datetime": "2025-04-28 21:55:00",
   "call_type": "接收"
}}

2. SMS（短信）格式：
{{
   "type": "sms",
   "event_id": "1",
   "message_content": "妈妈：静静，元旦快乐！早饭吃了吗？今天降温，出门多穿点。",
   "contactName": "李芳",
   "contact_phone_number": "+8613817892547",
   "datetime": "2025-01-01 08:45:00",
   "message_type": "接收"
}}

3. 相册（photo）格式：
{{
   "event_id": "4",
   "type": "photo",
   "caption": "母亲李芳将刚出锅的葱烤大排盛入白色瓷盘中，背景是厨房灶台和油烟机。",
   "title": "IMG_20250101_124520",
   "datetime": "2025-01-01 12:45:20",
   "location": {{
     "province": "上海市",
     "city": "上海市",
     "district": "浦东新区",
     "streetName": "浦东大道",
     "streetNumber": "136弄2-51号",
     "poi": "上港小区家中厨房"
   }},
   "faceRecognition": [
     "李芳"
   ],
   "imageTag": [
     "葱烤大排",
     "白色瓷盘",
     "厨房灶台",
     "家常菜",
     "烹饪"
   ],
   "ocrText": "无",
   "shoot_mode": "人像",
   "image_size": "3024×4032",
   "summarized_info": "徐静拍摄了一张母亲准备午餐的照片，里面的主要内容为刚出锅的葱烤大排、白色瓷盘和厨房灶台。"
}}

4. 笔记（note）格式：
{{
   "type": "note",
   "event_id": "0",
   "title": "纪念币收藏市场观察",
   "content": "一、近期关注：1. 2025乙巳（蛇）年彩色银币市场热度；2. 生肖纪念币价格走势；二、交流记录：1. 与北京藏友老王探讨蛇年银币设计；2. 论坛浏览新年币市展望帖子；三、个人思考：1. 关注兼具艺术性与投资潜力的品种；2. 考虑为父母收藏一套生肖币作为礼物。",
   "datetime": "2025-01-06 21:00:00",
   "summarized_info": "徐静记录了纪念币收藏相关的市场观察和个人思考..."
}}

5. 日历（calendar）格式：
{{
   "type": "calendar",
   "event_id": "354",
   "title": "杭州家庭旅行交通住宿预订",
   "description": "杭州家庭旅行交通住宿预订，2025-03-21 上午从上海虹桥前往杭州东，2025-03-23 下午返回，二等座车票，西湖边精品酒店家庭房，来源：铁路12306 APP、携程",
   "start_time": "2025-03-21 08:00:00",
   "end_time": "2025-03-23 18:00:00",
   "datetime": "2025-01-22 13:45:00",
   "summarized_info": "徐静设定了一个日程，为杭州家庭旅行交通住宿预订..."
}}

6. 推送通知（push）格式：
{{
   "type": "push",
   "event_id": "1",
   "title": "微信：新年祝福提醒",
   "content": "【微信】您收到了来自高中同学群的新年祝福红包，点击查看并送上您的专属问候吧！",
   "datetime": "2025-01-01 08:35:00",
   "source": "微信",
   "push_status": "已读",
   "jump_path": "微信→高中同学群→红包",
   "summarized_info": "我收到微信高中同学群的新年祝福红包提醒"
}}

生成要求：
1. 最小操作数目原则：在能回答问题的前提下，使用尽可能少的操作数目（2-5个，符合要求范围）
2. 信息分散原则：将回答问题所需的信息尽量分散到不同的操作中，通过改写或多跳信息推理的方式呈现
3. 每个操作应携带不同的信息片段，避免重复信息（例如：不要通过多个操作重复传递"用户在星巴克"这样的单一信息）
4. 必须包含至少两个手机操作，且单个操作不能直接暴露回答问题所需的全部信息
5. 确保需要通过关联分析多个操作、进行多跳推理才能还原事件并回答问题
6. 生成的数据必须严格遵循上述对应类型的格式要求
7. 不同操作之间应存在合理的时间和逻辑关联
8. 生成的手机操作数据能够协同回答给定问题，弥补缺失信息
9. 可合理基于事件生成一些与问题无关的其他操作。丰富手机操作。
10.尽可能生成多的操作类别数据。
11.当输入事件涉及发生在不同日期的事情时，要仔细思考每个手机操作的发生时间，注意每个操作的发生时间要对应到事件中。

提高回答难度的策略擦模块：
- 模糊重写：对关键信息进行模糊表述或指代，在另一个操作中明确相关信息（例如：操作1提到"和朋友约了下午见面"，操作2提到"和小明的咖啡约会取消了"）
- 延迟提及：在事件发生后的一天或一周后，通过短信、笔记等形式提及该事件（例如：事件发生一周后，在笔记中回顾"上周和小明在星巴克的聚会很开心"）
- 增加推理路径：设计需要多步推理的信息链（例如：操作1是"和小明约在14:00见面"的短信，操作2是"14:05的两杯星巴克订单"的推送，需要推理出"和小明在星巴克约会"）
- 情境分离：将同一事件的不同方面信息放在不同情境的操作中（例如：操作1是关于电影票购买的日历，操作2是关于餐厅预订的短信，需要推理出"约会活动包含看电影和吃饭"）
- 隐式关联：通过时间、地点、人物等共同元素建立操作间的隐式关联（例如：不同时间的操作都包含"西湖"这个地点，需要关联分析相关事件）
- 间接引用：通过引用其他信息的方式间接传递关键信息（例如：操作1提到"按计划执行了昨天讨论的方案"，操作2提到"昨天和小明讨论了去星巴克的计划"）

请直接返回JSON格式的操作列表，不要添加任何其他解释。
"""

# Template for judging if event can be inferred from phone operations
EVENT_INFERENCE_JUDGMENT_TEMPLATE = """请判断以下手机操作数据能否回答给定的问题。

注意事项：
- 事件信息仅作为真实发生情况的参考，在后续回答问题时是不可见的
- 判断时只能基于手机操作数据本身，不要利用事件信息中的内容
- 回答问题的所有信息必须来自手机操作数据，不能依赖事件信息

事件信息（仅作为参考）：
{event_info}

手机操作数据：
{phone_operations}

问题：
{question}

判断要求：
1. 仅分析手机操作数据是否包含足够信息回答问题，完全忽略事件信息
2. 如果不能回答，请明确列出需要知道的额外信息
3. 为新的手机数据合成提供必要的背景指导，确保新数据能够支持回答问题

输出格式：
请严格按照以下JSON格式输出：
{{
  "can_infer": true/false,
  "missing_info": ["需要知道的信息1", "需要知道的信息2"],
  "synthesis_background": "合成新手机数据的背景指导"
}}
请严格按照上述格式输出JSON结果，不包含任何无关解释、注释或代码，直接以{{}}开头。在JSON字符串值中避免使用双引号，如果需要表示引号，请使用[]或其他替代符号，或者使用转义字符\\"。
"""

# Template for multi-event inference judgment
MULTI_EVENT_INFERENCE_JUDGMENT_TEMPLATE = """请判断以下多个事件对应的手机操作数据能否回答给定的问题。

注意事项：
- 事件信息仅作为真实发生情况的参考，在后续回答问题时是不可见的
- 判断时只能基于手机操作数据本身，不要利用事件信息中的内容
- 回答问题的所有信息必须来自手机操作数据，不能依赖事件信息

事件和手机操作数据列表：
{event_phone_data}

问题：
{question}

判断要求：
对于每个事件的手机操作数据，分别判断：
1. 该事件是否与问题相关（related）
2. 如果事件相关，手机操作数据是否包含足够的信息可以回答与该事件相关的问题部分（can_infer）
   - 注意：如果事件不相关（related为false），则can_infer应设置为true，表示不需要重新生成该事件的手机操作数据
3. 如果该事件相关但信息不足（related为true且can_infer为false），列出该事件需要补充的具体信息
4. 为该事件的手机数据合成提供必要的背景指导，需明确说明要合成出什么信息

输出格式：
请严格按照以下JSON格式输出，每个事件的判断结果应与事件ID对应：
{{
  "event_judgments": [
    {{
      "event_id": "事件ID1",
      "related": true/false,
      "can_infer": true/false,
      "missing_info": ["该事件需要补充的信息1", "该事件需要补充的信息2"],
      "synthesis_background": "该事件手机操作数据的合成指导，需明确说明要合成出什么信息"
    }},
    {{
      "event_id": "事件ID2",
      "related": true/false,
      "can_infer": false,
      "missing_info": ["该事件需要补充的信息1"],
      "synthesis_background": "该事件手机操作数据的合成指导，需明确说明要合成出什么信息"
    }}
  ]
}}
"""

# Template for event-based questions
EVENT_QUESTION_TEMPLATE = """基于以下事件数据生成{num_questions}个单跳问题：
{event_info}

请严格按照以下原则生成问题，注意只能基于已有信息进行精确抽取，不得编造任何未在事件数据中提及的内容：
1. 问题设计思路：
   - 参考W原则（Who、What、When、Where、Why、How、IF）基于事件信息内容、属性、特殊节点、方式进行提问，例如："9月2日至15日期间，我偶遇的邻居向我推荐了什么产品？"
   - 直接基于事件属性提问，检查事件定位能力，例如："2025年8月我和父亲一起前往了哪里，做了什么？","我去杭州旅行时是否下雨？"
   - 问题表述应尽量减少帮助检索的信息（模糊化），但又要有足够确定该事件的信息量，要保证该问题不会定位到其他事件上。
   - 时间问题的模糊化策略：
     - 考虑事件可能的发生频率，如果可能会在其他时间发生，先考虑模糊为月份（如"2月"）
     - 如果同月份内有相同事件可能发生，则模糊为日期范围（如"2月5日至10日"）
     - 可观察输入数据的日期范围，如果该范围内没有可能导致定位错误的相似事件，则可以直接使用输入数据的起始日期和结束日期
     - 若以上方法仍无法准确定位事件，则明确具体日期（如"2025年2月15日"）（尽量不具体到日，一些不可能在附近几天发生的事件，题目描述都改为时间范围）
     - 选择不用时间来表示问题，而是基于一些其他属性或特殊节点（如我从杭州回来那天，我在巴黎的第一天，我和小红认识的第一天等）
   - 可合理重写事件描述，只保留足够定位该事件的信息，例如："2025年8月31日我在小区花园透气并偶遇高齐强深入请教"可简化为"2025年8-9月有一次我在花园逛并偶遇邻居"
   - 可进行描述的等价替换，例如用名字替换亲属称谓（如"女儿"替换成"小美"）

2. 信息定位准确性挑战，围绕下面的思路设计问题：
   - 精确识别事件中的关键实体（人物、时间、地点、活动）
   - 准确提取事件描述中的具体细节
   - 定位特定字段中的确切信息

3. 结构化信息抽取挑战：
   - 从复杂事件描述中分离出不同组成部分
   - 识别事件参与者及其角色关系
   - 提取事件的时间范围和持续周期

4. 细节识别挑战：
   - 从长文本描述中找到特定信息片段
   - 识别隐含在上下文中的明确事实/实体
   - 区分相似信息之间的细微差别

请生成{num_questions}个关于这些事件的单跳问题，其中一半为问答题，一半为选择题。

1. 问答题：直接提出问题，无需选项
2. 选择题：提供一个问题和4个选项（A、B、C、D），并明确标记正确答案

问题设计要求：
  - 所有问题的答案必须可以直接从事件数据中精确抽取，重点考查对复杂事件信息的定位和提取能力
  - 问题表述应遵循最小信息原则，使用模糊化处理，不要包含过多帮助检索的信息
  - 选择题的选项内容必须遵循最小信息原则，仅包含必要的核心信息
  - 选择题选项不要额外叙述任何信息与推断，不要增加帮助解答的信息

请为每个问题提供：
- 具体的问题内容
- 具体、明确的答案
- 得分点设计（满分10分），每个得分点对应一个明确的事实信息

注意：
- 得分点需与答案强绑定，确保得分点的完成情况可通过答案直接验证
- 无答案支撑的得分点无效
- 可以只有一个得分点（直接10分）
- 得分点只针对答案文本设计，不针对事件数据
- 答案应简洁精准，避免开放性叙述问题
- id必须严格来自输入事件数据中的id字段，确保完全一致
- 确保设计的问题能够通过事件数据中的信息准确回答
输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "问题内容",
      "answer": "问题答案",
      "score_points": [
        {{
          "description": "得分点描述",
          "score": 分数
        }}
      ],
      "required_events": [
        {{
          "event_id": "事件id1",
          "event_name": "事件名称1"
        }},
        {{
          "event_id": "事件id2",
          "event_name": "事件名称2"
        }}
      ]
    }},
    {{
      "question": "选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "required_events": [
        {{
          "event_id": "事件id1",
          "event_name": "事件名称1"
        }},
        {{
          "event_id": "事件id2",
          "event_name": "事件名称2"
        }}
      ]
    }},
    ...
  ]
}}
"""

# Template for capturing user summary and interesting topics from draft events
USER_SUMMARY_TOPICS_TEMPLATE = """根据以下一个月的用户活动数据，捕捉这段时间内用户本月事件的总结和感兴趣的话题：

{event_data}

请分析这些活动数据，提取：
1. 一个简洁的本月事件总结，描述用户这段时间的主要经历关键事件或身边人的关键事件和习惯模式
2. 3-6个用户感兴趣的话题，这些话题应该是用户在这段时间内经常接触或关注的

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "user_summary": "用户总结内容",
  "interesting_topics": ["话题1", "话题2", "话题3"]
}}
"""

# Template for generating persona-based questions with SMS conversations
PERSONA_BASED_SMS_QUESTION_TEMPLATE = """基于以下用户画像、用户总结和感兴趣的话题，生成{num_questions}个有一定难度的问题，以及对应的答案、得分点和能回答这些问题的短信对话数据：

用户画像：
{persona_info}

用户总结：
{user_summary}

感兴趣的话题：（不一定要参考，你可以合理虚构事件和情节并设计问题）
{interesting_topics}

{existing_questions_info}

请生成{num_questions}个问题，其中一半为问答题，一半为选择题。每个问题需要：
1. 有一定难度的问题
2. 不涉及需要明确安排事项的事件，不要涉及具体现实生活的事件安排
3. 优先生成以下三种类型的问题（可以合理虚构信息）：
   a) 与某人谈论某某人发生了什么事情，且该事情不影响自己的生活
   b) 谈论自己目前的一些具体品味偏好（不涉及具体事件，只分享信息）
   c) 谈论对一些可能接触的事物的看法（如某个电影，某本书，某个学校等）
4. 可以不基于任何已有事件，可以谈论任何信息，你可以合理虚构生成用户的对话（如他人的、附近的、网络的、感兴趣的）
5. 设计好核心问题信息点
6. 注意，你生成的事件、问题和手机操作都要发生在2025年。

对于每个问答题，请提供：
1. 问题内容（有一定难度）
2. 具体、明确的答案
3. 得分点设计（满分10分），每个得分点对应一个明确的事实信息
4. 3-5条短信对话数据，这些对话必须包含能回答该问题的信息点

对于每个选择题，请提供：
1. 问题内容（有一定难度）
2. 4个选项（A、B、C、D），其中只有一个正确答案
3. 正确选项的标识（如A、B、C、D）
4. 3-5条短信对话数据，这些对话必须包含能回答该问题的信息点

注意：
- 得分点需与答案强绑定，确保得分点的完成情况可通过答案直接验证
- 注意问题必须明确是几月份的事件
- 无答案支撑的得分点无效
- 可以只有一个得分点（直接10分）
- 得分点只针对答案文本设计
- 答案应简洁精准，避免开放性叙述问题
- 所有问题的答案必须与手机操作强绑定，即100%能从生成的手机短信对话中直接推理出来
- 短信对话应自然流畅，符合真实的聊天场景
- 短信对话中必须包含能回答该问题的全部信息点，但这些信息点可以分散在不同的短信中，短信对话可以多轮也可以涉及多个人
- 短信对话必须严格按照以下格式生成：
  {{
    "type": "sms",
    "event_id": "0",
    "message_content": "发送者：消息内容",
    "contactName": "联系人姓名",
    "contact_phone_number": "+8613817892547"（或其他有效的中国手机号格式）,
    "datetime": "2025-01-01 08:45:00"（合理的时间戳）,
    "message_type": "发送"或"接收"
  }}
- 所有短信对话的event_id必须设置为"0"
- 选择题的干扰项需设计合理，具有一定的迷惑性
- 请确保生成的问题与已有问题的主题不相似，避免重复内容
- 每个问题必须包含ask_time字段，格式为"2025-01"（表示2025年1月），ask_time应随机选择大于等于事件发生时间的月份，最大为2025-12，确保问题提问时间在2025年内

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "多跳推理问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{ 
          "description": "得分点描述1",
          "score": 5
        }},
        {{ 
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "ask_time": "2025-01",
      "sms_conversations": [
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "妈妈：静静，元旦快乐！早饭吃了吗？今天降温，出门多穿点。",
          "contactName": "李芳",
          "contact_phone_number": "+8613817892547",
          "datetime": "2025-01-01 08:45:00",
          "message_type": "接收"
        }},
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "静静：谢谢妈妈，我吃过早饭了。今天要去图书馆学习，会多穿点的。",
          "contactName": "李芳",
          "contact_phone_number": "+8613817892547",
          "datetime": "2025-01-01 08:50:00",
          "message_type": "发送"
        }}
      ]
    }},
    {{
      "question": "选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "sms_conversations": [
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "朋友：周末要不要一起去爬山？",
          "contactName": "王强",
          "contact_phone_number": "+8613912345678",
          "datetime": "2025-01-02 10:00:00",
          "message_type": "接收"
        }}
      ]
    }},
    ...
  ]
}}
"""

# Template for generating low-frequency events
LOW_FREQUENCY_EVENT_GENERATION_TEMPLATE = """你是一个专业的个人生活事件规划师。你的任务是生成10个左右的一年只发生几次（不超过5次）的低频事件。

【用户画像（可选参考）】:
{persona_info}


【指令】:
1. 生成约10个低频事件，每个事件一年发生次数不超过5次。
   请确保**至少包含一个新奇体验事件**（与画像无关且低频）。
   
   事件可以包括：
   - 一个人尝试一次没经历过的新体验事件
   - 与个人画像相关的兴趣或职业事件或关键事件
   - 人类共性的重要活动
   - 多样性丰富的生活体验


2. 每个事件需要包含以下信息：
   - 事件名：简洁明了的事件名称
   - 发生次数：一年中该事件发生的次数（1-4次）
   - 每次发生的日期：格式为YYYY-MM-DD，确保日期合理分布在一年中
   - 每次发生的描述：详细描述该次事件的内容，不同次发生的内容可以有所不同

3. 事件生成原则：
   - 不需要严格局限于用户画像，可以生成与画像无关的新体验事件
   - 确保事件的多样性和合理性
   - 平衡常见的低频事件和新颖的尝试体验
   - 考虑人类生活的各个方面（个人、家庭、社交、职业、兴趣等）

4. 输出格式要求：
   请严格按照以下JSON格式输出，不要包含任何其他内容：
   {{
     "low_frequency_events": [
       {{
         "event_name": "事件名称",
         "occurrences": [
           {{
             "date": "YYYY-MM-DD",
             "description": "事件描述"
           }},
           ...
         ],
         "total_occurrences": 发生次数
       }},
       ...
     ]
   }}

请确保生成的事件内容丰富多样，符合人类生活的实际情况。
【参考事件列表】:
景点浏览、出海游船、露营、城市切换、城市旅游、旅程、游玩主题乐园、参观动物园、参观博物馆、参观美术馆、参观海洋馆、节假日回乡、扫墓、探亲、看演唱会、看话剧、看音乐剧、看展览、看脱口秀、看相声、看音乐会、看音乐节、看戏曲、看电竞赛事、看舞蹈、看体育赛事、看魔术、看电影、看亲子演出、划船、射击射箭、溜冰、马术、钓鱼、按摩足疗、洗浴汗蒸、密室逃脱、游戏厅、网吧、采摘农家乐、撸宠、K歌、酒吧、轰趴、剧本杀、逛街、电子游戏、做SPA、桌游、茶馆棋牌、DIY手工、游泳、健身锻炼、跑步、骑行、户外步行、武术、舞蹈、羽毛球、棒球、滑雪、足球、篮球、轮滑、户外探险、健美操、漫步机、射箭、羽毛球、芭蕾舞、沙滩足球、沙滩排球、肚皮舞、冬季两项、BMX自行车、搏击操、保龄球、拳击、闭气测试、闭气训练、蹦极、皮划艇、核心训练、板球、越野滑雪、Crossfit、冰壶、飞镖、自由潜水、躲避球、龙舟、漂流、椭圆机、电子竞技、击剑、钓鱼、自由搏击、自由训练、飞盘、功能性训练、门球、打高尔夫、高尔夫场地模式、高尔夫练习场模式、手球、HIIT、徒步、曲棍球、骑马、呼啦圈、对战游戏、冰球、室内骑行、室内跑步、室内步行、爵士舞、跳绳、空手道、剑道、放风筝、拉丁舞、武术、摩托艇、登山、障碍赛、开放水域游泳、定向越野、笼式网球、跳伞、双杠、跑酷、体能训练、普拉提、操场赛跑、广场舞、台球、泳池游泳、赛车、攀岩、轮滑、划船机、赛艇、橄榄球、帆船、水肺潜水、体感运动、藤球、毽球、单杠、滑板、滑冰、滑雪、滑雪橇、单板滑雪、雪地摩托、垒球、动感单车、壁球、爬楼、踏步机、街舞、力量训练、桨板冲浪、冲浪、秋千、乒乓球、跆拳道、太极拳、网球、越野跑、铁人三项、拔河、排球、瑜伽

"""

# Template for plot generation with interference information
PLOT_GENERATION_WITH_INTERFERENCE_TEMPLATE = """你是一个专业的事件分析专家。你的任务是基于给定的真实事件和用户画像，生成{count}个具有挑战性的问题及其对应的干扰事件，以增加信息检索的难度。

【用户画像】:
{persona_info}

【真实事件】:
{real_event}

【指令】:
1. 基于真实事件和用户画像生成{count}个精确的问题，每个问题都需要从事件数据中提取关键信息才能回答。
   请严格按照以下原则生成问题，注意只能基于已有信息进行精确抽取，不得编造任何未在事件数据中提及的内容：
   - 信息定位准确性：精确识别事件中的关键实体（人物、时间、地点、活动，缘由等）
   - 结构化信息抽取：从复杂事件描述中分离出不同组成部分
   - 细节识别挑战：从长文本描述中找到特定信息片段
   - 答案具体性：确保问题的答案是具体、明确的，避免开放性问题或难以明确判断正确性的问题
   
   问题设计策略（以下策略不一定全部使用，仅作为参考）:
   - 使用精确信息约束：用具体的时间、地点、人物等信息定位事件，确保答案唯一且可验证
   - 问题表述应遵循最小信息原则，仅包含必要的核心信息，不要包含过多帮助检索的信息
   - 使用模糊化处理：
     * 将人名、关系替代（如"张三"替换成"父亲"、"李四"替换成"同事"等）
     * 将具体地点替换成更高层次或其他描述（如"杭州市西湖区某咖啡厅"替换成"西湖边的休闲场所"）
     * 改变表达方式但保持语义一致（如"购买手机"替换成"购置电子设备"）
     等方式，增加query和信息的不匹配度，但仍需确保答案的唯一性。
   - 问题聚焦于具体事实：询问事件的具体属性、发生情况或结果，而非主观评价或推测
   - 注意：不要因为难度增加导致问题无法检索出原事件，必须确保问题的约束信息足够定位到原事件信息
   - 确保每个问题都能清晰地与至少一个真实事件相关联，且问题之间具有多样性，避免重复或相似的问题
   - 选择题的选项内容必须遵循最小信息原则，仅包含必要的核心信息，不要额外叙述任何信息与推断，不要增加帮助解答的信息
   
2. 为每个生成的问题分析并生成1-3个干扰事件，这些事件应该与该问题所涉及的真实事件在某些方面相似但又有关键差异，以增加识别真实事件的难度。
   事件设计策略（以下策略不一定全部使用，仅作为参考）：
   - 构造平行相似事件：添加1-2个与目标事件同类型、同维度的事件，仅细节不同。这些事件应与真实事件属于同一类别（如都是会议、通话、购买等），涉及相似的人物或主题，但在具体细节上有所区别（如金额、结果、状态等）。
   - 混入高相似度干扰事件：与目标事件同类型、同人物，但细节不同（如目标事件是"3月15日项目评审通过"，干扰事件是"3月20日项目例会、4月10日项目中期汇报"）。
   - 如果问题是关于某个时间点的活动，可以创建在其他时间点发生的相似活动作为干扰
   - 如果问题是关于某个地点的访问，可以创建去往相似或相关地点的活动作为干扰
   - 事件发展曲折性：生成逻辑上与真实事件类似但存在计划与实际差异的干扰事件，增加事件识别的难度：
     * 时间曲折性：计划在某一日期发生，但实际发生在不同日期（如真实事件是"3月5日参加培训"，干扰事件是"原计划3月3日参加培训，后调整到3月8日"）
     * 地点曲折性：计划在某一地点进行，但实际在不同地点进行（如真实事件是"在社区医院就诊"，干扰事件是"原计划去市医院，后改为社区诊所"）
     * 人物曲折性：计划与某人一起参与，但实际参与者不同（如真实事件是"与同事张三开会"，干扰事件是"原计划与李四讨论，后改为和王五协商"）
     * 属性曲折性：计划进行某项活动，但实际活动内容有细微差异（如真实事件是"购买红色外套"，干扰事件是"原打算买蓝色外套，最终选择了黑色"）
   - 干扰事件应包含name、date、description字段
   - 这些事件应该符合个人画像的背景，不得违背个人画像。
   - 注意：不要因为干扰事件过于相似导致问题无法检索到原事件，必须确保真实事件仍是问题的唯一正确答案。
   
3. 为每个问题设计得分点（满分10分），明确指出每个得分点的具体要求和分值。
   得分点设计策略：
   - 依据答案的关键信息点进行拆分
   - 每个得分点对应一个明确的事实信息
   - 确保得分点可量化、可验证
   - 避免主观评价或模糊描述
   
4. 为每个问题指定得出答案需要的具体事件，即哪些事件包含了回答该问题所需的关键信息。
   - 明确列出事件的名称或标识
   - 确保指定的事件确实包含回答问题所需的信息
   
5. 最后，必须为每个问题验证其与干扰事件的一致性：
   - 检查新增的干扰事件是否改变了原问题的答案，确保真实事件仍然是问题的唯一正确答案。
   - 如果发现干扰事件会影响问题答案的唯一性，需要调整问题的约束条件或修改干扰事件，确保问题提供的约束信息足够定位到原事件信息。
   - 例如：若原事件为"6月杭州旅行"，新增事件为"7月杭州旅行"，则问题"今年几月去杭州旅行"会被干扰，要么修改为"6月份哪一天去的杭州"或类似能精确定位原事件的问题，要么删除干扰事件。
    
【输出格式】:
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "基于真实事件的具体问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 3
        }},
        {{
          "description": "得分点描述2",
          "score": 4
        }},
        {{
          "description": "得分点描述3",
          "score": 3
        }}
      ],
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "interference_events": [
        {{
          "name": "干扰事件名称1",
          "date": "干扰事件日期1",
          "description": "干扰事件描述1"
        }},
        ...
      ]
    }},
    {{
      "question": "基于真实事件的具体问题2",
      "answer": "具体、明确的答案2",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 5
        }},
        {{
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "required_events": [
        "事件名称3",
        "事件名称4"
      ],
      "interference_events": [
        {{
          "name": "干扰事件名称2",
          "date": "干扰事件日期2",
          "description": "干扰事件描述2"
        }},
        ...
      ]
    }},
    ...
  ]
}}
确保每个问题的答案明确来自真实事件，答案具体可验证，得分点设计合理可量化，所需事件明确准确，并且干扰事件能够增加问题的难度。
"""

# Template for multi-hop questions
MULTI_HOP_QUESTION_TEMPLATE =  """基于以下{question_type}信息，生成{num_questions}个推理问题，包含三种类型：1）多跳问题、2）因果推理问题、3）时序推理问题，比例约为4:2:2。所有问题均需结合多个信息片段、事件关联推导作答，深度适配LLM记忆能力评估场景，精准体现事件间的关联、影响或深层逻辑。
事件基础信息：{event_info}
一、核心设计原则（真多跳约束优先，严格落地）
1. 真多跳核心要求：每个问题必须关联至少2个事件，答案无法从单一事件中提取，需通过“事件A关键信息→事件B关键信息”的联动推导得出，形成完整推理链，严禁仅罗列双事件、答案源于单一事件的伪多跳问题。

2. 杜绝伪多跳表述：避免用“在此之前/之后”仅串联时序、无推理关联的话术，时序仅作为辅助定位手段，核心聚焦事件间的逻辑联动（因果、属性、条件等）。

3. 表述与信息原则：问题为单句事实设问，字数控制在30-60字，遵循“最小信息原则”——仅保留定位事件的必要信息，剔除冗余检索提示；答案需具体明确，无开放性、多元解读空间。

4. 关联逻辑多样化：优先覆盖以下推理类型，确保问题维度丰富：
  - ① 关联整合型：整合同一主体的跨事件行为、时间线或同一主题的连贯事件；
  - ② 因果推导型：基于事件A结果推导事件B原因/背景，或通过事件B行为反推事件A前提；
  - ③ 细节互补型：拼接不同事件中同一维度的碎片化信息，形成完整结论；
  - ④ 对比辨析型：针对易混淆的人物、时间、行为细节，设计跨事件对比设问；
  - ⑤ 相对定位型：基于重要事件的相对时间、地点、人物关联定位并推理。

二、专项推理类型设计要求

1. 因果关系推理（深度关联型）
  聚焦事件间“直接因果→间接影响”的多层关联，避免单一因果设问，核心禁忌：禁止设计“无需依托具体事件数据，仅通过通用逻辑、常识即可推导答案”的问题（如仅问“取消聚会可能的原因”，无事件数据支撑则属于臆断范畴）。
  
  需严格绑定事件细节挖掘：
  - ① 某行为/决策的核心触发因素（需对应事件中明确的干扰项、前置条件，排除通用常识性原因）；
  - ② 某事件引发的连锁反应（限定“直接结果”与“衍生结果”边界，结果必须是事件中明确发生的行为变更，非理论上的可能影响）；
  - ③ 因果倒置陷阱规避（明确推理逻辑不可逆，且倒置依据需通过事件数据验证）。
  
  示例：基于“因暴雨取消户外调研→改为整理数据→延迟提交报告”，设计问题需绑定“暴雨”这一事件数据，而非泛问“取消调研的原因”。

2. 时序关联推理（多维定位型）
  结合事件的绝对时间、相对时间（选择合适的其他事件）、先后顺序及时间间隔，构建多维时序推理场景。
  
  核心方向：
  - ① 相对时间推导（如“事件A发生后X天是否发生事件B”“某时间点个体的行为状态”）；
  - ② 时序逻辑补全（基于已有时间节点，推导未明确标注的事件发生时间）；
  - ③ 跨事件时序关联（多个事件的时间线交织验证）。
  
  需避免单一时间点提取，强化“时间+行为+属性”的组合推理。可针对性设计细分题型：
  - 行为枚举类（如“某段行程中去过哪些餐厅”），考察事件分类提取与聚合能力；
  - 频次统计类（如“某段时间内户外活动次数”），融合时序筛选与计数推理；
  - 时间节点定位类（如“第一次/最后一次某行为的时间”），考察时序排序与边界识别；
  - 先后关系判断类（如“甲活动是否在乙活动之前”），聚焦双事件时序比对；
  - 关联行为追溯类（如“某行为在哪个活动之后发生”），强化多事件时序链条串联。

三、信息模糊化处理规范

1. 时间模糊化策略：
  - 优先模糊为月份（如“2月”），适用于无同类型事件干扰的场景；
  - 同月份有相似事件时，模糊为日期范围（如“2月5日至10日”）；
  - 无相似事件干扰的日期范围，可直接使用原始起止日期（如“2025年8月1日至31日”）；
  - 上述方法无法准确定位时，再明确具体日期（尽量不细化到日）；
  - 支持相对时间定位（如“从西藏旅游回来后1周”），结合人物、地点信息强化唯一性。

2. 事件描述/题目表示优化：通过灵活替换实体与事件的表示方式增加推理难度，同时确保核心信息可定位：
   - ① 实体替换：用具体姓名替换亲属称谓（如“小美”替换“女儿”），或用群体/类别名称替换具体个体（如“同事”替换“张三”）；
   - ② 信息模糊：简化或等价替换表述，仅保留定位核心信息（如将“2025年8月31日在小区花园透气并偶遇邻居深入请教”简化为“在花园闲逛时偶遇邻居请教”）；
   - ③ 关联指代：基于其他事件或属性进行间接指代（如用“我去云南的时候”指代特定时间段，用“我八月和同事聚餐的地方”指代具体地点，用“我参加编程比赛期间”指代特定活动时段）。
   所有替换需确保仍能通过多跳推理定位到原始事件信息，避免过度模糊导致无法关联。

四、分题型专项要求

（一）问答题

1. 严格遵循真多跳逻辑，推理链清晰可验证；
2. 答案简洁精准，对应事件核心事实，无冗余叙述；
3. 得分点设计（满分10分）：与答案强绑定，每个得分点对应一个明确事实，可通过答案直接验证；允许单得分点（10分），无答案支撑的得分点无效，得分点仅针对答案文本设计。

（二）选择题

1. 题干遵循上述所有设计原则，选项需符合“最小信息原则”，仅含核心内容，无额外解读或检索提示；
2. 提供4个选项，仅1个正确答案，正确答案需贴合多跳推理结论；
3. 干扰项设计：需基于跨事件关联信息改编，融合多个事件碎片信息但逻辑错误（如混淆事件主体与行为、颠倒时序、错配因果），严禁仅基于单一事件设计干扰项，确保迷惑性源于多跳逻辑偏差。

五、示例问题
- 问答题：我在纽约旅行期间去了哪些餐厅？
- 问答题：我在纽约旅行期间做了多少次户外活动？
- 问答题：我在参观大都会艺术博物馆几天后去了自由女神像？
- 问答题：我第一次在纽约用餐是在何时？
- 问答题：我最后一次在纽约进行户外活动是在何时？
- 选择题：我去中央公园是在去布鲁克林大桥之前吗？
  A. 是  B. 否  C. 同时  D. 无法确定
- 选择题：我在纽约旅行期间，以下哪个活动发生的次数最多？
  A. 用餐  B. 参观博物馆  C. 户外活动  D. 购物
- 选择题：我在哪个活动之后去了Shake Shack用餐？
  A. 参观大都会艺术博物馆  B. 在中央公园散步  C. 参观自由女神像  D. 在布鲁克林大桥骑行
- 问答题：我在3月出差期间，第一次进行客户拜访是在抵达目的地几天后？
- 问答题：我调整3月工作计划中“线下调研”环节的直接原因是什么？（需依托事件中明确的前置事件，如“合作方临时变更场地”“天气预警通知”等数据，而非通用原因）
- 选择题：9月我取消与供应商的当面洽谈，最核心的原因是？
  A. 供应商临时变更行程  B. 公司内部会议冲突  C. 交通出行受阻  D. 洽谈事项可线上完成

六、输出格式
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "多跳推理问答题内容（符合字数与模糊化要求）",
      "question_type": "mutihop",
      "answer": "具体明确的答案",
      "score_points": [
        {{
          "description": "得分点描述（对应答案中的事实信息）",
          "score": 5
        }},
        {{
          "description": "得分点描述（对应答案中的事实信息）",
          "score": 5
        }}
      ],
      "required_events": ["事件1描述", "事件2描述"],
      "required_event_dates": ["事件1日期", "事件2日期"]
    }},
    {{
      "question": "因果推理选择题内容（符合字数与模糊化要求）",
      "question_type": "reasoning",
      "options": [
        {{
          "option": "A",
          "content": "选项内容（跨事件逻辑错误的干扰项/正确项）"
        }},
        {{
          "option": "B",
          "content": "选项内容（跨事件逻辑错误的干扰项）"
        }},
        {{
          "option": "C",
          "content": "选项内容（跨事件逻辑错误的干扰项）"
        }},
        {{
          "option": "D",
          "content": "选项内容（跨事件逻辑错误的干扰项）"
        }}
      ],
      "answer": "正确选项（A/B/C/D）",
      "required_events": ["事件1描述", "事件2描述"],
      "required_event_dates": ["事件1日期", "事件2日期"]
    }},
    {{
      "question": "时序推理问答题内容（符合字数与模糊化要求）",
      "question_type": "temporal",
      "answer": "具体明确的答案",
      "score_points": [
        {{
          "description": "得分点描述（对应答案中的事实信息）",
          "score": 10
        }}
      ],
      "required_events": ["事件1描述", "事件2描述", "事件3描述"],
      "required_event_dates": ["事件1日期", "事件2日期", "事件3日期"]
    }},
    ...
  ]
}}
"""


# Template for multi-day conversation questions
MULTI_DAY_CONVERSATION_QUESTION_TEMPLATE = """基于以下用户画像和联系人信息，生成{num_questions}个多跳推理问题，并为其生成解答所需要的个人短信对话数据。问题需整合至少两个发生在不同日期的短信交流数据才能回答，通过不同时间点短信信息的联动推导，体现对话间的关联逻辑与深层信息。**注意手机操作和问题和事件设计都要发生在2025年。**

用户画像信息：
{persona_info}

联系人信息（可用于生成短信数据）：
{contact_info}

一、核心设计原则
1. **真多日短信约束**：每个问题必须关联至少两个不同日期的短信交流，答案无法从单一短信或单日短信中直接提取，需通过"短信A关键信息→短信B关键信息"的链式推导得出完整结论。

2. **数据类型规范**：仅使用短信（sms）类型数据，确保每条信息包含明确的时间戳和完整对话内容。

3. **表述精简原则**：问题采用单句事实设问，字数控制在30-60字，遵循"最小信息原则"——仅保留定位短信的必要信息，剔除冗余检索提示；答案需具体明确，无开放性、多元解读空间。但要保证问题所需信息可以被定位到。

4. **内容创作自由度与限制**：
   - 短信交流内容可完全虚构，包括故事、事件、新闻、网络热点等各类信息
   - 联系人可以多样化，不同日期的短信可以涉及不同联系人
   - **严格禁止**：
     1. 不得生成任何涉及本人**生活安排**的内容（如日程、计划、活动安排等）
     2. 不得提及任何可能与已确定的本人生活安排产生冲突的事件
5.- **事件生成约束**：
     1. 优先生成**与本人无关的事件**（如纯新闻、他人经历事件、通用信息等）
     2. 如需涉及本人，仅允许提及**静态属性信息**：
        - 实体相关：自己喜欢的东西、已拥有的物品等
        - 偏好相关：兴趣爱好、口味偏好等
        - 内容相关：感兴趣的话题、关注的领域等
     3. **避免生成涉及本人生活安排或可能影响本人生活的事件或任何本人实际具体参与的事件**

二、多跳问题定义与类型
多跳问题的核心特征是：**回答问题所需的关键信息分散在不同日期的对话中**，而非问题本身必须包含两个事件的完整信息。具体分为以下三类（注意下面的张三李四王五都不是本人而是与本人相关的人）：

1. **指代类**：对话中某个指代的具体信息需通过另一个对话明确
   示例："张三在5月8日在哪里收到了录取通知？"
   信息分布：
   - 5月8日短信："今天跑步时收到了心仪大学的录取通知，太开心了！"
   - 5月9日短信："昨天在羊山公园跑步时偶遇了高中同学"

2. **时序关联类**：事件的发生时间需结合另一个对话中的时间信息推断
   示例："李四在6月3日提到的出差结束后第二天具体是哪天去旅游的？"
   信息分布：
   - 6月3日短信："出差结束后第二天顺便去周边旅游放松一下"
   - 5月28日短信："6月5日出差回来，终于可以休息了"

3. **信息聚合类**：需整合两个对话中的部分信息才能完整回答
   示例："王五在7月10日和8月初总共推荐了几个电影？"
   信息分布：
   - 7月10日短信："推荐你看《星际穿越》和《盗梦空间》，超好看"
   - 8月2日短信："上次忘了说，《奥本海默》和《芭比》也很值得一看"

三、问题设计要求
1. 每个问题必须关联**至少两个不同日期**的短信交流数据，基于短信间的人物、时间、内容、因果等逻辑关联设计设问
2. 问题需明确体现对跨日期短信信息的依赖，避免可通过单一短信或单日对话回答的问题
3. 问题表述需以海量短信视角设计，确保能从海量短信中精准定位相关信息。若短信提及的事件包含独特标识信息（如关键地点、核心人物、重要属性等），可直接依托该事件表征信息以避免重复定位；若无此类独特信息，可采用「XX 某日提及的 XX」形式表征，也可结合节日等特定信息进行表述。或者描述清楚月份。
4. 问题表述遵循**最小信息原则**，在保障可定位性的前提下精简表述，仅保留必要的定位信息，避免透露过多短信内容
5. 问题应体现多跳推理特性，需整合多个分散信息点才能得出答案
6. 答案必须具体明确，避免开放性问题或存在多元解读的问题

四、短信数据生成要求
1. 生成**至少两个不同日期**的短信交流内容，日期间隔可以多样化：
   - 短期间隔：隔天
   - 中期间隔：几天、几星期
   - 长期间隔：几个月、回忆提及等
   每轮交流包含至少2条短信
2. 短信可以涉及**不同联系人**，联系人组合多样化
3. 短信内容可涵盖故事、事件、新闻、网络内容等，支持完全虚构，无需严格基于用户画像，不太偏离真实性即可。
4. 每条短信需包含完整的时间戳、发送者、接收者和内容信息
5. 两天的短信交流需存在逻辑关联，便于构建多跳推理问题

五、输出格式要求
请严格按照以下JSON格式输出，不要包含任何其他内容（包括思考过程、说明文字等）：

{{
  "questions": [
    {{
      "question": "张三在5月8日在哪里收到了录取通知？",
      "answer": "羊山公园",
      "score_points": [
        {{
          "description": "明确张三收到录取通知的具体地点",
          "score": 10
        }}
      ],
      "evidence": [
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "今天跑步时收到了心仪大学的录取通知，太开心了！",
          "contactName": "张三",
          "contact_phone_number": "+8613817892547",
          "datetime": "2025-05-08 08:45:00",
          "message_type": "接收"
        }},
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "昨天在羊山公园跑步时偶遇了高中同学",
          "contactName": "张三",
          "contact_phone_number": "+8613817892547",
          "datetime": "2025-05-09 14:30:00",
          "message_type": "接收"
        }}
      ]
    }},
    {{
      "question": "李四在6月提到的项目完成后第二天具体是哪天？",
      "answer": "2025年6月6日",
      "score_points": [
        {{
          "description": "明确项目完成后第二天的具体日期",
          "score": 10
        }}
      ],
      "evidence": [
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "项目完成后第二天准备庆祝一下",
          "contactName": "李四",
          "contact_phone_number": "+8613917895623",
          "datetime": "2025-06-03 10:20:00",
          "message_type": "接收"
        }},
        {{
          "type": "sms",
          "event_id": "0",
          "message_content": "6月5日项目就要结束了，终于可以放松了",
          "contactName": "李四",
          "contact_phone_number": "+8613917895623",
          "datetime": "2025-05-28 16:45:00",
          "message_type": "接收"
        }}
      ]
    }}
  ]
}}
"""

# Template for event tracing analysis
EVENT_TRACING_TEMPLATE = """请分析以下日期的事件数据，重点关注指定事件在当日的具体执行情况：

日期：{date}

关注事件：{event_description}

事件数据：
{event_info}

用户画像：
{persona}

分析要求：
1. 识别当日发生的所有事件
2. 找出与关注事件相关的所有事件
3. 详细说明关注事件在当日的具体执行情况，包括时间顺序、执行细节等
4. 提取所有与关注事件相关的事件信息

请严格按照以下格式输出结果，包含思考过程和结构化JSON：

<think>
// 在此处详细说明你的分析过程，包括：
// 1. 如何识别当日发生的所有事件
// 2. 如何筛选与关注事件相关的事件
// 3. 如何构建多跳推理问题
// 4. 如何确定每个问题的得分点和相关事件ID
</think>

<output>
{{
  "questions": [
    // 问答题示例
    {{
      "question": "多跳推理问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 5
        }},
        {{
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "required_events_id": ["相关事件ID1", "相关事件ID2"]
    }},
    // 选择题示例
    {{
      "question": "选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "required_events_id": ["相关事件ID3", "相关事件ID4"]
    }}
  ]
}}
</output>
"""

# Template for temporal reasoning questions
TEMPORAL_REASONING_TEMPLATE = """基于以下事件数据生成{num_questions}个时序推理问题：
{event_info}

请生成{num_questions}个时序推理问题，这些问题需要结合时间顺序、频率、时间间隔等时间相关因素才能回答。问题类型应均匀分布，一半为问答题，一半为选择题。

时序推理问题定义：基于事件数据中的时间属性（如发生时间、持续时间、时间间隔、频率等），分析事件之间的时间关系，推断出特定结论的问题。

问题设计思路：
1. 参考W原则（Who、What、When、Where、Why、How）设计问题，重点聚焦时间维度的关联分析，例如："我在2025年8月第一次去健身房后，间隔了多久又去了第二次？"
2. 直接基于事件的时间属性设计问题，突出时间因素在解答中的核心作用，例如："2025年9月我参加的所有活动中，最早开始的是什么？"
3. 问题表述应遵循最小信息原则，在保障可解答的前提下包含最小信息量，避免提供过多帮助检索的线索
4. 应用信息模糊化处理技术，包括：
   - 时间模糊化策略：
     * 考虑事件可能的发生频率，如果可能在多个时间点发生，优先模糊为月份（如"2月"）
     * 若同月份内有相同事件多次发生，可模糊为日期范围（如"2月5日至10日"）
     * 观察输入数据的日期范围，若该范围内无相似事件可能导致定位错误，可直接使用原始日期
     * 若以上方法仍无法准确定位事件，则明确具体日期（如"2025年2月15日"）（尽量不具体到日，一些不可能在附近几天发生的事件，题目描述都改为时间范围）
   - 事件描述简化：保留足够定位事件的核心信息，例如将"2025年8月31日我在小区花园透气并偶遇邻居"简化为"我在花园闲逛并偶遇邻居"
   - 等价替换：使用更简洁的表述替代复杂描述，例如用名字替换亲属称谓（如"女儿"替换为"小美"）
5. 问题应具备一定的推理深度，避免简单的时间信息提取，需要结合多个事件的时间关系进行分析

问题设计策略：
1. 时间顺序分析：询问事件发生的先后顺序或特定时间点的活动安排，例如："我在2025年10月参加的活动中，按照时间顺序排列是什么？"
2. 时间间隔计算：计算两个相关事件之间的时间差或间隔天数，例如："我第一次去图书馆和最后一次去图书馆之间间隔了多少天？"
3. 频率模式识别：识别重复发生事件的频率和时间规律，例如："我在2025年第三季度平均每周去健身房多少次？"
4. 时序关系推理：基于事件逻辑链条推断接下来的事件，例如："我在第一次去迪士尼后为了纪念这趟旅行做了什么？"
5. 时间趋势分析：分析事件随时间变化的趋势或模式，例如："与2025年7月相比，我8月的工作会议频率有何变化？"
6. 重叠事件分析：识别同一时间区间内发生的重叠事件，例如："2025年9月15日，我是否有时间冲突的安排？"

示例问题：
- 问答题：我在2025年8月第一次去健身房后，间隔了多久又去了第二次？
- 选择题：我在2025年第二季度参加技术培训的次数是：
  A. 1次  B. 2次  C. 3次  D. 4次
- 问答题：与7月相比，我8月的阅读频率有何变化？
- 选择题：2025年9月，我最早开始的活动是：
  A. 晨跑  B. 会议  C. 学习  D. 购物

要求：
1. 问题必须严格基于提供的事件数据，聚焦于时间维度的分析
2. 问题应充分体现时间顺序、频率、时间间隔等时间因素的推理需求
3. 问题表述应遵循最小信息原则，仅包含必要的核心信息，避免过多提示性内容
4. 必须应用信息模糊化处理技术，包括时间模糊化、事件描述简化和等价替换
5. 问题应具备一定的深度和复杂度，需要结合多个事件的时间关系进行分析，避免简单的信息提取
6. 答案必须具体、明确，避免开放性或难以判断正确性的问题
7. 选择题需提供4个选项，其中只有一个正确答案
8. 选择题的选项内容必须遵循最小信息原则，仅包含必要的核心信息，不添加额外推断或解释
9. 问答题和选择题的比例应保持均衡，各占总问题数的一半

请为每个问题提供：
- 具体的问题内容
- 具体、明确的答案
- 得分点设计（满分10分），每个得分点对应一个明确的事实信息

注意：
- 得分点需与答案强绑定，确保得分点的完成情况可通过答案直接验证
- 无答案支撑的得分点无效
- 可以只有一个得分点（直接10分）
- 得分点只针对答案文本设计，不针对事件数据
- 答案应简洁精准，避免开放性叙述问题

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "时序推理问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 5
        }},
        {{
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "type": "short_answer"
    }},
    {{
      "question": "选择题内容",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "type": "multiple_choice"
    }},
    {{
      "question": "时序推理问题2",
      "answer": "具体、明确的答案2",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 4
        }},
        {{
          "description": "得分点描述2",
          "score": 3
        }},
        {{
          "description": "得分点描述3",
          "score": 3
        }}
      ],
      "required_events": [
        "事件名称3",
        "事件名称4",
        "事件名称5"
      ],
      "type": "short_answer"
    }},
    ...
  ]
}}
"""

# Template for updating reasoning questions
UPDATING_REASONING_TEMPLATE = """基于以下事件数据生成{num_questions}个更新推理问题对：
{event_info}

请生成{num_questions}个更新推理问题对，每个问题对包含两个相关问题，这些问题在不同时间点询问会得到不同的答案，考察记忆更新能力。

更新推理问题定义：基于事件数据中随时间变化的信息，生成两个相关问题，第一个问题在本月1号询问会得到一个答案，第二个问题在本月最后一日询问会得到不同的答案，反映了当月信息或状态的变化。

问题设计思路：
1. 识别事件数据中当月内随时间变化的信息（如爱好变化、状态变化、重要事件、独特事件等）
2. 生成第一个问题，基于本月1号前的信息可以回答
3. 生成第二个问题，与第一个问题完全相同，但基于本月最后一日前的信息会得到不同的答案
4. 两个问题应紧密相关，体现同一主题的变化
5. 问题表述应清晰，不包含任何时间信息

问题设计策略：
1. 爱好变化分析：例如，月初问"我是否喜欢滑雪？"，月末问"我是否喜欢滑雪？"（如果当月开始学习或放弃滑雪）
2. 状态变化分析：例如，月初问"张三是否已婚？"，月末问"张三是否已婚？"（如果当月发生了结婚事件）
3. 独特事件分析：例如，月初问"我上次去迪士尼是什么时候？"，月末问"我上次去迪士尼是什么时候？"（如果当月去了迪士尼）
4. 数量变化分析：例如，月初问"我有多少个未读消息？"，月末问"我有多少个未读消息？"
5. 关系变化分析：例如，月初问"我与李四的联系频率如何？"，月末问"我与李四的联系频率如何？"
6. 数量变化分析：例如，在不同时间点询问"我参加了多少次技术培训？"会得到不同答案
7. 习惯变化分析：例如，在不同时间点询问"我每周锻炼几次？"会得到不同答案
8. 进度变化分析：例如，在不同时间点询问"我的项目完成进度如何？"会得到不同答案

示例问题对：
- 问题对1：
  问题1（询问时间：2025年8月1日）：我是否喜欢滑雪？
  答案1：不明确
  问题2（询问时间：2025年8月31日）：我是否喜欢滑雪？
  答案2：喜欢（因为8月15日开始学习滑雪）
- 问题对2：
  问题1（询问时间：2025年8月1日）：张三是否已婚？
  答案1：未婚
  问题2（询问时间：2025年8月31日）：张三是否已婚？
  答案2：已婚（因为8月20日张三结婚了）
- 问题对3：
  问题1（询问时间：2025年8月1日）：我上次去迪士尼是什么时候？
  答案1：2023年12月25日
  问题2（询问时间：2025年8月31日）：我上次去迪士尼是什么时候？
  答案2：2025年8月5日

要求：
1. 问题必须严格基于提供的事件数据，聚焦于当月内随时间变化的信息
2. 每个问题对的两个问题必须完全相同，仅提问时间不同
3. 问题表述应清晰，不包含任何时间信息
4. 答案必须具体、明确，且两个问题的答案必须不同
5. 问题应具备一定的深度，需要结合多个事件的信息进行分析
6. 提问时间必须为当月1号和当月最后一日（YYYY-MM-DD格式）

请为每个问题对提供：
- 两个完全相同的问题内容（不包含时间信息）
- 两个不同的询问时间（YYYY-MM-DD格式，必须为当月1号和当月最后一日）
- 两个具体、明确且不同的答案
- 得分点设计（每个问题满分10分），每个得分点对应一个明确的事实信息

注意：
- 得分点需与答案强绑定，确保得分点的完成情况可通过答案直接验证
- 无答案支撑的得分点无效
- 可以只有一个得分点（直接10分）
- 得分点只针对答案文本设计，不针对事件数据
- 答案应简洁精准，避免开放性叙述问题

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "question_pairs": [
    {{
      "question1": "第一个问题（不包含时间信息）",
      "ask_time1": "第一个问题的询问时间（YYYY-MM-DD格式，当月1号）",
      "answer1": "第一个问题的具体答案",
      "score_points1": [
        {{
          "description": "第一个问题的得分点描述",
          "score": 10
        }}
      ],
      "required_events1": [
        "事件名称1",
        "事件名称2"
      ],
      "question2": "第二个问题（与第一个问题完全相同，不包含时间信息）",
      "ask_time2": "第二个问题的询问时间（YYYY-MM-DD格式，当月最后一日）",
      "answer2": "第二个问题的具体答案（与第一个不同）",
      "score_points2": [
        {{
          "description": "第二个问题的得分点描述",
          "score": 10
        }}
      ],
      "required_events2": [
        "事件名称3",
        "事件名称4"
      ]
    }},
    {{
      "question1": "第二个问题对的第一个问题（不包含时间信息）",
      "ask_time1": "第二个问题对的第一个问题的询问时间（YYYY-MM-DD格式，当月1号）",
      "answer1": "答案1",
      "score_points1": [
        {{
          "description": "得分点描述",
          "score": 10
        }}
      ],
      "required_events1": [
        "事件名称5",
        "事件名称6"
      ],
      "question2": "第二个问题对的第二个问题（与第一个问题完全相同，不包含时间信息）",
      "ask_time2": "第二个问题对的第二个问题的询问时间（YYYY-MM-DD格式，当月最后一日）",
      "answer2": "答案2（与答案1不同）",
      "score_points2": [
        {{
          "description": "得分点描述",
          "score": 10
        }}
      ],
      "required_events2": [
        "事件名称7",
        "事件名称8"
      ]
    }}
  ]
}}"""

# Enhanced template for event tracing analysis
EVENT_TRACING_ENHANCED_TEMPLATE = """请基于以下信息，完成核心任务：① 核查日期对应事件数据集能否提取足够信息回答原问题，精准提取所需事件的唯一ID；② 若信息不足则按规则处理；③ 优化/重写问题:

完整问题信息：
{question}

相关日期：
{dates}

日期对应的事件数据：（daily_event）
{events_by_date}

用户画像：
{persona}

分析要求：
1. 事件核查与ID提取：逐日期校验daily_event，核心判断两点：一是是否包含回答原问题所需的全部事实信息，二是精准定位所需信息对应事件的唯一ID。需明确思考“信息充足（含对应事件ID列表）”“信息不足（缺失关键事实+无对应ID）”“部分充足（含部分事件ID，缺失核心事实）”，同时建立“问题所需事实-事件ID-事件细节”的映射关系。
2. 原问题适配性评估：判断原问题是否可通过提取的事件ID对应的细节作答。评估是否需要修改原问题以适应现有事件数据。
3. 如果有些信息daily_event并不包含，请做以下缺失信息处理方案选择：
        2）放弃该问题：仅当缺失回答问题的核心事实≥50%，且无对应事件ID可支撑推理，无法通过新增事件或重构问题弥补（需标注缺失的核心事实及无对应ID的原因）；
        3）新增补充信息：仅当缺失信息为非核心但必要事实，且无对应事件ID，可新增一个用户和某人交流的事件，交流内容中提及该信息。新增事件交流内容需不冲突现有逻辑、贴合用户画像及日期场景可合理虚构一些情节内容交流然后引出信息，补充后可形成完整事实链作答；
        4）重新设计问题：当事件ID对应的信息不全，但可以尝试基于现有信息设计更简单问题或者其他方面的问题。要求问题需要多跳推理（跨2个及以上事件ID）来解答，且保持与原问题类型（问答/选择）一致。
4.问题优化（可选），仅当原问题质量不高（表述不当、难度不足、关联性弱）时执行优化；若问题设计合理、难度达标（需多跳推理），则保持不变。优化需遵循以下细则，确保问题精准度与挑战性，且保持与原问题类型（问答/选择）一致：
    1）思考答案与得分点，优化问题表述：当原问题表述不当（冗余、偏离、信息过于丰富），或难度不足/信息丰富时，基于事件ID对应的细节优化问题。要求问题事实明确、答案唯一，严格绑定事件细节。同时对于一些答案和问题所文关联呢不大，或部分答案已经足够回答问题，其他答案只是加分项的情况下，重新修改问题，要求答案就是问题所问的所有内容。
    2）问题设计优化：问题的表述应仅保留检索问题信息的最低信息量，不要有过多的细节，尽量模糊信息，信息能够定位事件就好，不要提及多个能够定位的信息，但要保证问题的可回答性。关于关键信息的指代可通过时间、地点、人物等方式引出来，也可通过其他事件的相对时间引出来，也可以直接表述。思考多样化设计。如（四月下旬（范围时间，针对不会常做的事情合理选择范围，对于可能常做的事情若用时间来表示需要具体到天），父亲住院（关键事件）后一周（相对时间），在羊山公园时（通过地点表示问题检索信息），）
    3）问题尽量需要多跳信息整合和推理才能回答，具有一定难度。
    4）需规避的劣质问题类型：
- 假多跳问题：看似涉及多个事件，实则无需跨事件推理即可作答，或多事件无关联、无法形成推理链。示例：“徐静在端午节前为父母采购了助眠设备，在此之前她参加了一次社区活动并分享了健康理念。请问她在活动中向邻居分享的健康理念具体是什么？”（该问题仅需提取“社区活动”单一事件信息，采购助眠设备与问题答案无推理关联，属于假多跳）。
- 题面含答案问题：问题设问与题面信息重复，答案已隐含在题干中，无需检索事件ID信息。示例：“我星期六在公园跑步的时候在哪？”（题干已明确“在公园”，答案无需依托事件数据，无评估意义）。

请直接输出JSON格式的结果，无需包含任何思考过程或额外说明，严格按照以下格式输出：

{{
  "instruction": 1, // 1表示信息够用，只优化问题信息；2表示选择放弃该问题（缺失信息过多，难以修改）；3表示新增事件后优化问题；4表示重新设计问题
  "questions": {{}}, // 问题内容，根据原问题类型（问答/选择）调整结构
  "new_events": [] // 新增事件列表，信息不足时使用
}}

不同类型题目格式输出示例如下：
输出格式示例1（问答题结构）：
{{
  "instruction": 1,
  "questions": {{
    "question": "优化后的多跳推理问题",
    "answer": "具体、明确的答案",
    "score_points": [
      {{
        "description": "得分点描述1",
        "score": 5
      }},
      {{
        "description": "得分点描述2",
        "score": 5
      }}
    ],
    "required_events_id": ["相关事件ID1", "相关事件ID2"],
    "question_type": "与输入问题的question_type保持一致"
  }},
  "new_events": []
}}

输出格式示例2（选择题结构）：
{{
  "instruction": 3,
  "questions": {{
    "question": "优化后的选择题内容",
    "options": [
      {{
        "option": "A",
        "content": "选项内容A"
      }},
      {{
        "option": "B",
        "content": "选项内容B"
      }},
      {{
        "option": "C",
        "content": "选项内容C"
      }},
      {{
        "option": "D",
        "content": "选项内容D"
      }}
    ],
    "answer": "正确选项（如A、B、C、D）",
    "required_events_id": ["相关事件ID3", "相关事件ID4"],
    "question_type": "与输入问题的question_type保持一致"
  }},
  "new_events": [
    {{
      "date": "事件日期",
      "name": "事件名称",
      "description": "事件描述",
      "event_id":"从相关事件中选择最相关的事件ID",
      "info":"解答问题必须要有的信息是什么"
    }}
]
}}

"""

# Enhanced event tracing template without adding new events
EVENT_TRACING_ENHANCED_NO_ADD_TEMPLATE = """请基于以下信息，完成核心任务：① 核查日期对应事件数据集能否提取足够信息回答原问题，精准提取所需事件的唯一ID；② 若信息不足则按规则处理；:
注意，你只要关心日期对应的事件数据的是否能反映问题的信息。

完整问题信息：
{question}

相关日期：
{dates}

日期对应的事件数据：
{events_by_date}

用户画像：
{persona}

分析要求：
1. 事件核查与ID提取：逐日期校验事件数据，核心判断两点：一是是否包含回答原问题所需的全部事实信息，二是精准定位所需信息对应事件的唯一ID。需明确思考“信息充足（含对应事件ID列表）”“信息不足（缺失关键事实+无对应ID）”“部分充足（含部分事件ID，缺失核心事实）”，同时建立“问题所需事实-事件ID-事件细节”的映射关系。
2. 原问题适配性评估：判断原问题是否可通过提取的事件ID对应的细节作答。评估是否需要修改原问题以适应现有事件数据。
3. 缺失信息处理方案：
   - 放弃问题（代码2）：仅当缺失回答问题的核心事实≥50%，且无对应事件ID可支撑推理，无法通过重构问题弥补
   - 重新设计问题（代码4）：当事件ID对应的信息不全，但可以尝试基于现有信息设计更简单问题或者其他方面的问题。要求问题需要多跳推理（跨2个及以上事件ID）来解答，且保持与原问题类型（问答/选择）一致


请直接输出JSON格式的结果，无需包含任何思考过程或额外说明，严格按照以下格式输出：

{{
  "instruction": 1, // 1表示信息够用，只优化问题信息；2表示选择放弃该问题；4表示重新设计问题
  "questions": {{
    "question": "优化后的多跳推理问题",
    "answer": "具体、明确的答案",
    "score_points": [
      {{
        "description": "得分点描述1",
        "score": 5
      }},
      {{
        "description": "得分点描述2",
        "score": 5
      }}
    ],
    "required_events_id": ["相关事件ID1", "相关事件ID2"],
    "required_events_date": ["相关事件日期1", "相关事件日期2"],
    "ask_time": "2025-xx", // 提出问题的月份，在所有相关事件完成后的月份随机选择，格式为"2025-xx"
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

输出格式示例1（问答题结构）：
{{
  "instruction": 1,
  "questions": {{
    "question": "优化后的多跳推理问题",
    "answer": "具体、明确的答案",
    "score_points": [
      {{
        "description": "得分点描述1",
        "score": 5
      }},
      {{
        "description": "得分点描述2",
        "score": 5
      }}
    ],
    "required_events_id": ["相关事件ID1", "相关事件ID2"],
    "required_events_date": ["相关事件日期1", "相关事件日期2"],
    "ask_time": "2025-06", // 提出问题的月份，在所有相关事件完成后的月份随机选择
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

输出格式示例2（选择题结构）：
{{
  "instruction": 1,
  "questions": {{
    "question": "优化后的选择题内容",
    "options": [
      {{
        "option": "A",
        "content": "选项内容A"
      }},
      {{
        "option": "B",
        "content": "选项内容B"
      }},
      {{
        "option": "C",
        "content": "选项内容C"
      }},
      {{
        "option": "D",
        "content": "选项内容D"
      }}
    ],
    "answer": "正确选项（如A、B、C、D）",
    "required_events_id": ["相关事件ID3", "相关事件ID4"],
    "required_events_date": ["相关事件日期3", "相关事件日期4"],
    "ask_time": "2025-08", // 提出问题的月份，在所有相关事件完成后的月份随机选择
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

注意：
1. 输出格式必须与原问题类型保持一致：原问题为问答题则输出问答题格式（包含question、answer、score_points、required_events_id字段）；原问题为选择题则输出选择题格式（包含question、options、answer、required_events_id字段）。
2. questions字段仅返回一个问题。
"""

EVENT_TRACING_ENHANCED_NO_ADD_TEMPLATE2 = """请基于以下信息，完成核心任务：① 核查日期对应事件数据集能否提取足够信息回答原问题，精准提取所需事件的唯一ID；② 若信息不足则按规则处理:

完整问题信息：
{question}

相关日期：
{dates}

日期对应的事件数据：
{events_by_date}

用户画像：
{persona}

分析要求：
1. 事件核查与ID提取：逐日期校验事件数据，核心判断两点：一是是否包含回答原问题所需的全部事实信息，二是精准定位所需信息对应事件的唯一ID。需明确思考“信息充足（含对应事件ID列表）”“信息不足（缺失关键事实+无对应ID）”“部分充足（含部分事件ID，缺失核心事实）”，同时建立“问题所需事实-事件ID-事件细节”的映射关系。
2. 原问题适配性评估：判断原问题是否可通过提取的事件ID对应的细节作答。评估是否需要修改原问题以适应现有事件数据。
3. 缺失信息处理方案：
   - 放弃问题（代码2）：仅当缺失回答问题的核心事实≥50%，且无对应事件ID可支撑推理，无法通过重构问题弥补
   - 重新设计问题（代码4）：当事件ID对应的信息不全，但可以尝试基于现有信息设计更简单问题或者其他方面的问题。要求问题需要多跳推理（跨2个及以上事件ID）来解答，且保持与原问题类型（问答/选择）一致

4. 选择题特殊处理：仅需分析正确选项能否溯源，其他选项为虚假信息，无需分析

请直接输出JSON格式的结果，无需包含任何思考过程或额外说明，严格按照以下格式输出：

{{
  "instruction": 1, // 1表示信息够用，只优化问题信息；2表示选择放弃该问题；4表示重新设计问题
  "questions": {{
    "question": "问题",
    "answer": "具体、明确的答案",
    "score_points": [
      {{
        "description": "得分点描述1",
        "score": 5
      }},
      {{
        "description": "得分点描述2",
        "score": 5
      }}
    ],
    "required_events_id": ["相关事件ID1", "相关事件ID2"],
    "required_events_date": ["相关事件日期1", "相关事件日期2"],
    "ask_time": "2025-xx", // 提出问题的月份，在所有相关事件完成后的月份随机选择，格式为"2025-xx"
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

输出格式示例1（问答题结构）：
{{
  "instruction": 1,
  "questions": {{
    "question": "问题",
    "answer": "具体、明确的答案",
    "score_points": [
      {{
        "description": "得分点描述1",
        "score": 5
      }},
      {{
        "description": "得分点描述2",
        "score": 5
      }}
    ],
    "required_events_id": ["相关事件ID1", "相关事件ID2"],
    "required_events_date": ["相关事件日期1", "相关事件日期2"],
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

输出格式示例2（选择题结构）：
{{
  "instruction": 1,
  "questions": {{
    "question": "选择题内容",
    "options": [
      {{
        "option": "A",
        "content": "选项内容A"
      }},
      {{
        "option": "B",
        "content": "选项内容B"
      }},
      {{
        "option": "C",
        "content": "选项内容C"
      }},
      {{
        "option": "D",
        "content": "选项内容D"
      }}
    ],
    "answer": "正确选项（如A、B、C、D）",
    "required_events_id": ["相关事件ID3", "相关事件ID4"],
    "required_events_date": ["相关事件日期3", "相关事件日期4"],
    "question_type": "与输入问题的question_type保持一致"
  }}
}}

注意：
1. 输出格式必须与原问题类型保持一致：原问题为问答题则输出问答题格式（包含question、answer、score_points、required_events_id字段）；原问题为选择题则输出选择题格式（包含question、options、answer、required_events_id字段）。
2. questions字段仅返回一个问题。
"""

# Template for pattern recognition questions
PATTERN_RECOGNITION_TEMPLATE = """基于以下事件数据和用户画像数据生成{num_questions}个问题，分为两大类：1）用户建模问题（包含模式识别和用户建模）、2）开放知识推理问题：
事件数据：
{event_info}

用户画像数据：
{persona_info}

请生成{num_questions}个问题，其中用户建模问题与开放知识推理问题的比例为2:1，且一半为问答题，一半为选择题。

用户建模问题（user_modeling）：包含模式识别和用户建模两类子问题：
  - 模式识别：基于多个事件识别个人的行为模式、习惯、偏好、性格特征或做某件事情的常用方式/偏好，例如分析某人的运动习惯、阅读偏好或社交模式。
  - 用户信息识别：询问用户相关信息情况，如工作生活情况（我这个时间在哪里，在做什么工作等）、关系情况（XX是谁）等，帮助溯源构建用户画像。

开放知识推理问题（open_domain）：结合事件信息和常识知识进行推理，基于已知事实推断未知结论，例如根据某人爱听《青花瓷》推断其可能喜欢周杰伦，或根据某人经常去医院推断其可能有健康问题。

问题设计思路：
1. 参考W原则（Who、What、When、Where、Why、How、If）设计问题，根据问题类型选择合适的维度
2. 用户建模问题中的模式识别部分应聚焦于活动总结，行为的重复性、规律性和一致性，例如："我通常在什么时间进行健身活动？"
3. 开放知识推理问题应结合事件信息和常识，建立合理的推理链条，例如："根据我听的音乐类型，我可能喜欢哪位歌手？"
4. 问题表述应尽量减少帮助检索的信息（模糊化），但又要有足够确定相关事件的信息量
5. 问题设计要分析是否能直接推断出答案，必须通过分析多个相关事件才能推理得出结论，而不是让别人可以直接通过题目描述得出答案，例如：不能直接问"根据青花瓷，请问我喜欢周杰伦吗？"，而应问"根据我听的音乐，我可能喜欢哪位歌手？"
6. 时间问题的模糊化策略：
   - 问题描述中应当提到月份（如"2月"、"3月"），优先使用月份进行时间定位
   - 考虑事件可能的发生频率，如果可能会在其他时间发生，必须模糊为月份（如"2月"）
   - 如果同月份内有相同事件可能发生，则可模糊为日期范围（如"2月5日至10日"）
   - 可观察输入数据的日期范围，如果该范围内没有可能导致定位错误的相似事件，则可以直接使用输入数据的起始日期和结束日期
   - 若以上方法仍无法准确定位事件，则明确具体日期（如"2025年2月15日"）
7. 可合理简化事件描述，只保留足够定位相关事件的核心信息
8. 可进行描述的等价替换，例如用名字替换亲属称谓（如"女儿"替换成"小美"）

问题设计策略：

【用户建模问题策略】
1. 行为模式识别：识别重复出现的行为序列或组合，如"工作日的活动安排模式"，或是做某件事的习惯偏好如偏好去XX球馆打球等。
2. 习惯分析：分析个人的日常习惯和固定行为，如"起床后的习惯活动"
3. 偏好识别：推断个人的偏好和倾向，如"喜欢的音乐类型或电影类型"
4. 特征提取：总结个人的性格特征或属性信息，如"是否注重健康管理"
5. 规律发现：发现行为背后的规律和周期性，如"健身活动的频率和时间规律"
6. 工作生活情况：询问用户特定月份的工作地点、职业或生活状态，如"我3月主要在做什么项目，是否熬夜加班？"
7. 根据画像信息选择事件数据中能体现画像信息的数据，问题设计优先选择有难度的画像信息比如小红的工作是什么，父亲5月份身体怎么样。

【开放知识推理问题策略】
1. 关联推理：根据事件之间的关联关系进行推理，如"根据购买的书籍推断阅读兴趣"
2. 常识应用：结合常识知识解释事件，常识知识包括如"法国的首都是巴黎"、"贝多芬是古典主义音乐家"这类通用知识，如"根据去法国旅游的事件推断可能停留的城市"
3. 偏好延伸：基于已知偏好推断相关偏好，如"根据喜欢的歌手推断可能喜欢的其他歌手"或"根据听歌口味推断是否适合贝多芬的音乐"
4. 动机推断：根据行为推断潜在动机，如"根据周末安排推断休息方式偏好"

注意开放知识推理可以通过修改描述和题目实现而不是一定要进行推理，如原事件为去巴黎旅游，那么设计题目是改为去法国首都旅游时即可，这也是常识知识推理。

示例问题：

【用户建模问题（user_modeling）】
- 问答题：我3月通常在工作日的什么时间进行健身活动？
- 选择题：我2月参加会议的地点主要集中在：
  A. 办公室  B. 会议室  C. 线上  D. 客户现场
- 问答题：我5月主要在哪里工作？
- 选择题：李明是谁？
  A. 同事  B. 家人  C. 朋友  D. 客户

【开放知识推理问题（open_domain）】
- 问答题：根据我4月听的音乐类型，我可能喜欢哪位歌手？
- 选择题：根据我8月的行为，可以推断我：
  A. 喜欢阅读  B. 从事学术研究  C. 寻找安静环境  D. 以上都有可能
- 问答题：我上次去法国首都旅游时呆了几天？
- 选择题：根据我8月份的听歌口味，贝多芬是否适合？
  A. 适合  B. 不适合  C. 无法判断  D. 部分适合

要求：
1. 问题必须基于事件数据，用户建模问题聚焦于行为规律或用户信息，开放知识推理问题结合常识
2. 问题类型比例要求：
   - user_modeling与open_domain的比例为2:1
   - 选择题与问答题的比例为1:1
3. 问题表述应遵循最小信息原则，在保障可解答的前提下包含最小信息量，不要包含过多帮助检索的信息
4. 问题必须使用信息模糊化处理，可参考时间模糊化策略、事件描述简化、等价替换等方法
5. 问题设计禁止直接推断出答案，必须通过分析多个相关事件才能推理得出结论，避免直接提取事件属性
6. 问题应具有一定的深度和复杂度，避免过于简单的直接提取
7. 答案必须具体、明确，避免开放性问题或难以明确判断正确性的问题
8. 选择题需提供4个选项，其中只有一个正确答案
9. 选择题的选项内容必须遵循最小信息原则，仅包含必要的核心信息，不要额外叙述任何信息与推断，不要增加帮助解答的信息

请为每个问题提供：
- 具体的问题内容
- 具体、明确的答案
- 得分点设计（满分10分），每个得分点对应一个明确的事实信息
- 得出答案需要的具体事件，注意不需要全量提取，只需要足够推理出答案的事件数目即可。
- 每个事件对应的发生日期
- 问题类型（question_type）：user_modeling 或 open_domain

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "用户建模问题（模式识别）",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 5
        }},
        {{
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_event_dates": [
        "事件日期1",
        "事件日期2"
      ],
      "type": "question_answer",
      "question_type": "user_modeling"
    }},
    {{
      "question": "用户建模问题（用户建模）",
      "options": [
        {{
          "option": "A",
          "content": "选项内容A"
        }},
        {{
          "option": "B",
          "content": "选项内容B"
        }},
        {{
          "option": "C",
          "content": "选项内容C"
        }},
        {{
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_event_dates": [
        "事件日期1",
        "事件日期2"
      ],
      "type": "multiple_choice",
      "question_type": "user_modeling"
    }},
    {{
      "question": "开放知识推理问题",
      "answer": "具体、明确的答案2",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 4
        }},
        {{
          "description": "得分点描述2",
          "score": 3
        }},
        {{
          "description": "得分点描述3",
          "score": 3
        }}
      ],
      "required_events": [
        "事件名称3",
        "事件名称4",
        "事件名称5"
      ],
      "required_event_dates": [
        "事件日期3",
        "事件日期4",
        "事件日期5"
      ],
      "type": "question_answer",
      "question_type": "open_domain"
    }},
    ...
  ]
}}
"""

COUNT_TEMPLATE = """
输入为同一类事件的多次时序发生数据（含事件名称、各次发生的时间 + 全量核心属性，按发生时间正序排列），基于数据生成符合指定 JSON 格式的记忆更新考察问题，核心围绕次数、时间、人物、地点这四个要素设计，确保不同询问时间对应不同答案，严格遵循以下生成规则：
核心生成规则
问题设计四大核心要素
仅基于以下四个要素设计问题：
1. 次数：事件发生的累计次数、特定次数的事件信息
2. 时间：事件发生的具体时间、时间顺序、时间间隔等
3. 人物：参与事件的人物信息
4. 地点：事件发生的地点信息
格式严格要求
question：仅写问题原文，符合日常对话语境；
ask_time：统一为YYYY-MM格式，为问题提问的时间，选择一个月份在月末尾（即该月30号/31号）进行提问,请你注意时间的对应，在提问时间之前发生的次数，提问时间在哪两次之间在哪一次之后。；
answer：对应单一提问，具体明确，字数控制在20字以内，得分点不超过3个，无多设问衍生的多重答案。0 次时答 "你还没有发生过该事件"，计数类答具体数字，其他类答对应属性值 / 类型集合；
score_points：满分10分，按"推理难度+信息重要性"分配分值，每个得分点对应答案中的一个关键信息，描述需完全贴合答案，无冗余。**注意，得分点只与答案文本关联，不与推导过程关联！**；
required_events：数组内填写该问题作答所需的事件名称；**注意问题所需事件为发生在提问时间之前的所有事件。**
required_events_date：标注对应事件的具体发生日期（格式：YYYY-MM-DD），与required_events一一对应，禁止使用日期范围，只关注最底层的事件发生时间。
问题数目限制
设计问题数目不超过 3 个；
确保每个问题的答案，与该节点对应的事件发生次数、属性特征严格匹配，体现 “次数增加 - 记忆更新 - 答案变化” 的逻辑。
输出格式（固定 JSON）：
[{{"question": "问题","ask_time": "YYYY-MM","answer": "问题的具体答案","score_points": [{{"description": "得分点描述1","score": 5}},{{"description": "得分点描述2","score": 5}}],"required_events": ["事件名称"],"required_events_date": ["事件日期"]}}]

输入事件数据:{event_info}
"""

# Template for causal reasoning questions
CAUSAL_REASONING_TEMPLATE = """
基于以下单一个体关联生活事件信息数据，生成{num_questions}个高难度因果与时序推理问题，核心用于评估大型语言模型（LLM）的个性化记忆提取、多步逻辑推导及事件关联能力：
生活事件信息：{event_info}

请严格依托给定事件信息，设计“多步推理”构建问题，答案必须完全源于事件细节的层层推导，无任何主观臆断或外部信息补充空间。具体设计要求、执行规范及输出标准如下：

一、推理核心设计策略

1. 因果关系推理（深度关联型）

聚焦事件间“直接因果→间接影响”的多层关联，避免单一因果设问，核心禁忌：禁止设计“无需依托具体事件数据，仅通过通用逻辑、常识即可推导答案”的问题（如仅问“取消聚会可能的原因”，无事件数据支撑则属于臆断范畴）。需严格绑定事件细节挖掘：① 某行为/决策的核心触发因素（需对应事件中明确的干扰项、前置条件，排除通用常识性原因）；② 某事件引发的连锁反应（限定“直接结果”与“衍生结果”边界，结果必须是事件中明确发生的行为变更，非理论上的可能影响）；③ 因果倒置陷阱规避（明确推理逻辑不可逆，且倒置依据需通过事件数据验证）。示例：基于“因暴雨取消户外调研→改为整理数据→延迟提交报告”，设计问题需绑定“暴雨”这一事件数据，而非泛问“取消调研的原因”。

2. 计算与聚合推理（数据精准型）

基于事件中的量化信息（时间跨度、金额、次数、频率、数量差值等），设计需多步计算的问题，禁止单一数据提取类设问。需包含：① 基础运算（加减、统计计数）；② 条件筛选（基于时间/地点/人物属性过滤数据）；③ 结果校验（确保计算依据完全来自事件细节）。示例：“2025年5月到七月我去了几次迪士尼？“

3. 时序关联推理（多维定位型）

结合事件的绝对时间、相对时间（选择合适的其他事件）、先后顺序及时间间隔，构建多维时序推理场景。核心方向：① 相对时间推导（如“事件A发生后X天是否发生事件B”“某时间点个体的行为状态”）；② 时序逻辑补全（基于已有时间节点，推导未明确标注的事件发生时间）；③ 跨事件时序关联（多个事件的时间线交织验证）。需避免单一时间点提取，强化“时间+行为+属性”的组合推理。可针对性设计细分题型：一是行为枚举类（如“某段行程中去过哪些餐厅”），考察事件分类提取与聚合能力；二是频次统计类（如“某段时间内户外活动次数”），融合时序筛选与计数推理；三是时间节点定位类（如“第一次/最后一次某行为的时间”），考察时序排序与边界识别；四是先后关系判断类（如“甲活动是否在乙活动之前”），聚焦双事件时序比对；五是关联行为追溯类（如“某行为在哪个活动之后发生”），强化多事件时序链条串联。

4. 信息转化推理（模糊映射型）

通过信息等价替换、模糊化映射提升推理复杂度，需依托事件中的关联属性构建映射关系。具体策略：① 人物替换（具体姓名→亲属关系/社交关系，如“张三”→“上周一起参与项目评审的同事”）；② 地点替换（具体名称→场景描述/关联事件，如“XX咖啡馆”→“上次和李四讨论方案的场所”）；③ 行为替换（具体动作→目的/结果描述，如“提交报销单”→“处理上月差旅费用相关事宜”）。替换后需保证唯一指向性，无歧义。

二、问题表述设计规范（最小信息+模糊化）

1. 核心原则

表述需满足“模糊化处理≠信息缺失”，仅保留定位事件的核心属性，无任何提示性、引导性语言，避免问题本身泄露答案线索。

2. 时间模糊化策略（优先级递减）,注意至少也要说明月份信息。

- 一级模糊：无同类型事件干扰时，模糊为“月份”（如“2025年3月”简化为“3月”）；

- 二级模糊：同月份有相似事件（同行为/同地点）时，模糊为“日期范围”（如“3月10日-15日”）；

- 三级模糊：无相似事件干扰的日期范围，保留原始起止时间（如“2025年8月1日至31日”）；

- 四级模糊：上述方法无法唯一定位时，仅明确至“日期”（尽量不细化到具体时段，如“3月12日”而非“3月12日上午9点”）；

- 相对时间定位：优先使用“事件关联型相对时间”（如“从上海出差回来后第3天”），结合人物、地点属性强化唯一性，替代绝对时间。

3. 事件描述优化

- 简化冗余信息：剔除修饰性、无关细节，仅保留“行为主体+核心动作+关键属性”（如“2025年8月31日傍晚在小区花园透气时偶遇邻居，就孩子教育问题深入请教”简化为“在小区花园偶遇邻居并请教问题”）；

- 等价替换表述：基于事件本质替换关键词，如“预约牙科复诊”→“安排口腔检查后续事宜”，确保语义一致；

- 多维度定位：可结合“地点+人物”“行为+相对时间”等组合属性定位事件，避免单一维度模糊导致歧义。

4. 禁忌要求

禁止问题表述直接对应事件原文（如事件为“3月5日去超市采购食材”，禁止设问“3月5日去超市做了什么”）；禁止过于模糊导致无法定位事件（如仅表述“去了某个地方”，无任何关联属性）；核心强调（因果推理专属）：禁止设计“脱离事件数据，仅凭通用逻辑、生活常识即可推导答案”的因果问题，所有因果设问必须绑定事件中明确的前置条件、关联行为、具体干扰项，确保答案只能通过提取、分析给定事件数据得出，无数据支撑则无法形成唯一结论。

三、示例问题

- 问答题：我在纽约旅行期间去了哪些餐厅？

- 问答题：我在纽约旅行期间做了多少次户外活动？

- 问答题：我在参观大都会艺术博物馆几天后去了自由女神像？

- 问答题：我第一次在纽约用餐是在何时？

- 问答题：我最后一次在纽约进行户外活动是在何时？

- 选择题：我去中央公园是在去布鲁克林大桥之前吗？
A. 是  B. 否  C. 同时  D. 无法确定

- 选择题：我在纽约旅行期间，以下哪个活动发生的次数最多？
A. 用餐  B. 参观博物馆  C. 户外活动  D. 购物

- 选择题：我在哪个活动之后去了Shake Shack用餐？
A. 参观大都会艺术博物馆  B. 在中央公园散步  C. 参观自由女神像  D. 在布鲁克林大桥骑行

- 问答题：我在3月出差期间，第一次进行客户拜访是在抵达目的地几天后？

- 问答题：我在处理完项目验收事宜后，间隔多久去参加了行业研讨会？

- 选择题：我去XX书店（上次和王五买书的地方）是在提交项目周报之前吗？
A. 是  B. 否  C. 同时  D. 无法确定

- 选择题：2025年第二季度，以下哪种行为的发生频率最高？
A. 线下客户拜访  B. 线上会议  C. 跨部门协作研讨  D. 个人技能培训

- 问答题：我调整3月工作计划中“线下调研”环节的直接原因是什么？（需依托事件中明确的前置事件，如“合作方临时变更场地”“天气预警通知”等数据，而非通用原因）

- 问答题：8月我未能按时完成月度总结报告，其衍生影响导致了哪些具体行为的变更？

- 选择题：9月我取消与供应商的当面洽谈，最核心的原因是？
A. 供应商临时变更行程  B. 公司内部会议冲突  C. 交通出行受阻  D. 洽谈事项可线上完成

- 

四、输出核心规则（刚性要求）

1. 问题设计规则

- 严谨性：完全依托给定事件信息，无主观推断、外部常识补充，推理链至少包含2个及以上推导步骤（单步推理视为低难度，需剔除）；因果推理专项要求：禁止脱离事件数据凭常识臆断，答案需绑定具体事件细节；问答题专项要求：基于事实维度设计，仅含一个提问，避免多设问、多事件堆砌导致答案杂乱。

- 均衡性：题型严格分为问答题（short_answer）和选择题（multiple_choice），两类题型数量均等（总题数为奇数时，允许差值1题）；

- 答案唯一性：答案需具体、明确，无开放性、模糊性表述（如“是/否”“2天”“A”），可通过原始事件直接验证；

- 尽量设计基于多个事实的问题。

- 提示。可适当选择一些间隔1个月以上的相关事件设计一个问题，提高问题的难度和挑战性。

2. 单题要素规范

（1）问答题（short_answer）

- 问题（question）：符合模糊化表述规范，聚焦多步推理，无提示性语言；核心要求：基于单一事件事实维度设计，仅包含一个提问（禁止多重设问），参考的底层日粒度事件数量不宜过多（避免信息过载，一个问题的回答要求简洁明确而不是多个问题堆成一个来增加难度），聚焦精准推理而非多事件信息堆砌。

- 答案（answer）：对应单一提问，具体明确，字数控制在20字以内，得分点不超过3个，无多设问衍生的多重答案。

- 得分点（score_points）：满分10分，按“推理难度+信息重要性”分配分值，每个得分点对应答案中的一个关键信息，描述需完全贴合答案，无冗余。**注意，得分点只与答案文本关联，不与推导过程关联！**

- 推理链（reasoning_chain）：按“信息定位→步骤1推导→步骤2推导→结论验证”的逻辑撰写，明确标注每一步依托的事件核心信息，可追溯推导过程，因参考事件较少，需强化单/双事件间的逻辑关联。

- required_events：准确标注推导答案所需的全部底层日粒度事件名称，数量控制在1-2个，无遗漏、无无关事件，与事件信息中的表述一致。

- required_events_date：标注对应事件的具体发生日期（格式：YYYY-MM-DD），与required_events一一对应，禁止使用日期范围。

（2）选择题（multiple_choice）

- 问题（question）：同问答题表述规范，确保选项均围绕问题核心设计；

- 选项（options）：设计4个选项（A/B/C/D），仅1个正确答案，错误选项需具备迷惑性（基于事件中的干扰信息设计，非凭空捏造），选项内容简洁，无额外解释、推断；

- 答案（answer）：仅标注正确选项字母（如“A”“B”）；

- 推理链（reasoning_chain）：明确说明正确选项的推导过程，同时简要排除错误选项（标注错误原因，如“选项B与事件中‘3月10日无会议安排’矛盾”）；

- required_events/required_events_date：要求同问答题，需覆盖正确选项及错误选项的验证依据。
三、整体输出格式要求
严格按照以下JSON格式输出，仅输出JSON文本，无任何额外说明、标点、空格或注释，JSON结构需语法正确、层级清晰：

{{
  "questions": [
    {{    
      "question": "因果推理问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{    
          "description": "得分点描述1（完全基于答案内容）",
          "score": 5
        }},
        {{    
          "description": "得分点描述2（完全基于答案内容）",
          "score": 5
        }}
      ],
      "reasoning_chain": "从问题到答案的详细推理过程，包括信息提取、逻辑关联和结论推导的具体步骤",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_events_date": [
        "2025-03-01",
        "2025-03-05"
      ],
      "type": "question_answer",
      "question_type": "reasoning"
    }},
    {{    
      "question": "时序推理问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{    
          "description": "得分点描述1（完全基于答案内容）",
          "score": 5
        }},
        {{    
          "description": "得分点描述2（完全基于答案内容）",
          "score": 5
        }}
      ],
      "reasoning_chain": "从问题到答案的详细推理过程，包括信息提取、时序关系分析和结论推导的具体步骤",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_events_date": [
        "2025-03-01",
        "2025-03-05"
      ],
      "type": "question_answer",
      "question_type": "temporal"
    }},
    {{    
      "question": "因果推理选择题内容",
      "options": [
        {{    
          "option": "A",
          "content": "选项内容A"
        }},
        {{    
          "option": "B",
          "content": "选项内容B"
        }},
        {{    
          "option": "C",
          "content": "选项内容C"
        }},
        {{    
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "reasoning_chain": "从问题到正确答案的详细推理过程，包括信息提取、逻辑关联和结论推导的具体步骤",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_events_date": [
        "2025-03-01",
        "2025-03-05"
      ],
      "type": "multiple_choice",
      "question_type": "reasoning"
    }},
    {{    
      "question": "时序推理选择题内容",
      "options": [
        {{    
          "option": "A",
          "content": "选项内容A"
        }},
        {{    
          "option": "B",
          "content": "选项内容B"
        }},
        {{    
          "option": "C",
          "content": "选项内容C"
        }},
        {{    
          "option": "D",
          "content": "选项内容D"
        }}
      ],
      "answer": "正确选项（如A、B、C、D）",
      "reasoning_chain": "从问题到正确答案的详细推理过程，包括信息提取、时序关系分析和结论推导的具体步骤",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "required_events_date": [
        "2025-03-01",
        "2025-03-05"
      ],
      "type": "multiple_choice",
      "question_type": "temporal"
    }}
  ]
}}
"""

# Template for multi-hop questions from event tree
MULTI_HOP_FROM_EVENT_TREE_TEMPLATE = """基于以下事件树信息生成{num_questions}个多跳推理问题：
{event_info}

请生成{num_questions}个需要结合事件树中的多个事件信息才能回答的多跳推理问题，其中一半为问答题，一半为选择题。
问题应该体现主事件与子事件之间的关联、影响或深层含义。

问题设计思路：
1. 参考W原则（Who、What、When、Where、Why、How）设计事件树多跳问题，例如："我在项目启动会议后，后续进行了哪些具体的技术评估？"
2. 直接基于事件树结构设计问题，分析主事件与子事件的关系，例如："2025年8月我参加的会议与后续的工作安排有什么关联？"
3. 问题表述应尽量减少帮助检索的信息（模糊化），但又要有足够确定相关事件的信息量，例如："我在9月初参加的培训与项目推进有什么关系？"
4. 时间问题的模糊化策略：
   - 考虑事件可能的发生频率，如果可能会在其他时间发生，先考虑模糊为月份（如"2月"）
   - 如果同月份内有相同事件可能发生，则模糊为日期范围（如"2月5日至10日"）
   - 可观察输入数据的日期范围，如果该范围内没有可能导致定位错误的相似事件，则可以直接使用输入数据的起始日期和结束日期
   - 若以上方法仍无法准确定位事件，则明确具体日期（如"2025年2月15日"）
5. 可合理重写事件描述，只保留足够定位相关事件的信息，例如："2025年8月31日我在小区花园透气并偶遇邻居"可简化为"我在花园闲逛并偶遇邻居"
6. 可进行描述的等价替换，例如用名字替换亲属称谓（如"女儿"替换成"小美"）

示例问题：
- 问答题：张三在完成项目启动会议后，后续可能会进行哪些具体的技术评估？
- 选择题：如果李四的市场调研结果不理想，以下哪个事件最可能受到影响？
  A. 技术方案设计  B. 项目预算调整  C. 团队组建  D. 客户需求确认

要求：
1. 每个问题都需要整合多个事件信息才能解答
2. 问题应多样化，涵盖不同的推理角度
3. 问题应体现主事件与子事件之间的关系
4. 问题表述应遵循最小信息原则，在保障可解答的前提下包含最小信息量，不要包含过多帮助检索的信息
5. 问题必须使用信息模糊化处理，可参考时间模糊化策略、事件描述简化、等价替换等方法
6. 问题应具有一定的深度和复杂度
7. 答案必须具体、明确，避免开放性问题或难以明确判断正确性的问题
8. 选择题需提供4个选项，其中只有一个正确答案
9. 选择题的选项内容必须遵循最小信息原则，仅包含必要的核心信息，不要额外叙述任何信息与推断，不要增加帮助解答的信息

请为每个问题提供：
- 具体的问题内容
- 具体、明确的答案
- 得分点设计（满分10分），每个得分点对应一个明确的事实信息
- 得出答案需要的具体事件

输出格式：
请严格按照以下JSON格式输出，不要包含任何其他内容：
{{
  "questions": [
    {{
      "question": "事件树多跳问题1",
      "answer": "具体、明确的答案1",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 5
        }},
        {{
          "description": "得分点描述2",
          "score": 5
        }}
      ],
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "type": "short_answer"
    }},
    {{    
      "question": "选择题内容",
      "options": [
        {{    
          "option": "A",
          "content": "选项内容A"
        }},    
        {{    
          "option": "B",
          "content": "选项内容B"
        }},    
        {{    
          "option": "C",
          "content": "选项内容C"
        }},    
        {{    
          "option": "D",
          "content": "选项内容D"
        }}    
      ],
      "answer": "正确选项（如A、B、C、D）",
      "required_events": [
        "事件名称1",
        "事件名称2"
      ],
      "type": "multiple_choice"
    }},
    {{
      "question": "事件树多跳问题2",
      "answer": "具体、明确的答案2",
      "score_points": [
        {{
          "description": "得分点描述1",
          "score": 4
        }},
        {{
          "description": "得分点描述2",
          "score": 3
        }},
        {{
          "description": "得分点描述3",
          "score": 3
        }}
      ],
      "required_events": [
        "事件名称3",
        "事件名称4",
        "事件名称5"
      ],
      "type": "short_answer"
    }},
    ...
  ]
}}
"""