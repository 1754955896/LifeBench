context = '''
你是一位人类学家，作家，数据分析师。
'''

context2 = '''
你是一位人类学家，数据分析师，规划师。
'''

context3 = '''
你是一位人类学家，心理学家，作家。
'''

#事件推理第一轮：追求全面多样
template1_1 = '''
请根据以下人物画像，为其构建2025年**完整365天周期内**最符合其身份、性格、职业与生活习惯的**综合生活主题事件**。此类事件需区别于“超长期项目（超过一个月）”和“高频周期性习惯”，聚焦非日常性、多维度的生活场景，所有内容必须真实可感、符合现实逻辑。

---
主题事件核心定位与要求
本类事件需与“超长期项目（超过1个月）”和“高频周期性习惯”生成内容形成互补框架，重点覆盖：非高频周期性的单次/多次事件、有明确起止的中短期事件（持续时间一个月以内）、重要转折/意外/纪念性事件，需满足以下具体要求：
1. 数量与维度覆盖：主题事件数量不少于80个，需全面覆盖9大生活维度：① 工作学习（如项目任务、会议、培训、考虑该职业涉及的各种事务）；② 个人发展（如晋升、调岗、考证、求职、升学等）；③ 家庭亲密关系（如家人重要事项、团聚活动、矛盾处理等）；④ 休闲娱乐（如旅行、观影、演唱会、兴趣体验等）；⑤ 自我提升（如短期课程、技能集训等）；⑥ 社交参与（如朋友聚会、社区活动、行业交流等）；⑦ 特殊节点（如节日庆祝、生日纪念、纪念日等）；⑧ 意外/突发/重大事件（如生病就医、设备维修、紧急事务等）；⑨生活重要事件（如跨地域出游、人生里程碑筹备、重要物品购置/处置、特殊体验活动等）；
2. 时间特性规范：① 事件可横跨多日（1天至3个月内），允许与其他事件时间重叠（例：“海南度假（2025-02-10至2025-02-17）”与“远程处理工作邮件（2025-02-12至2025-02-12）”）；② 周期性事件仅保留“月及以上跨度”（如每2个月部门团建、每季度财务复盘），需在“起止时间”数组中列出每次具体日期，不重复拆分事件；③ 排除“每周/每天频率”的日常性事件（如每日通勤、每周健身），避免与高频周期习惯内容重复。
3. 画像契合度与真实性：事件必须紧密匹配人物的职业（如教师的“期中监考”“家长会”）、年龄（如中年人的“父母体检”）、性格（如外向者的“朋友生日派对”）、经济能力（如职场新人的“平价游”）、家庭状况（如育儿家庭的“孩子入园准备”）、健康状况（如过敏体质的“换季就医”）等属性；可加入合理逻辑关联事件（如“获得年度优秀员工”后衔接“晋升答辩”“岗位调岗”），避免脱离现实的虚构内容。
4. 事件分布与冲突检查：① 按生活重心合理分配事件数量（如职场人士工作相关事件占比40%-50%）；② 输出前需核查：无时空冲突事件（如同一人不可同时出现在“北京出差”与“上海同学聚会”）、无重复重大事件（如“结婚”仅出现一次）、无违和事件（如学生出现“商务谈判”），确保事件逻辑自洽。
5. 我给出的例子只是参考，请你推断更多相似方面，增强生成的多样性。
---
输出格式严格要求
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。其中“主题事件”为字符串，“起止时间”为数组（单个事件填1个时间区间，多次/周期事件填多个时间区间，单日事件格式为“2025-04-05至2025-04-05”）。格式示例如下：

[
  {{"主题事件":"年度工作规划会议","起止时间":["2025-01-08至2025-01-09"]}},
  {{"主题事件":"每季度部门团建","起止时间":["2025-03-15至2025-03-16","2025-06-20至2025-06-21","2025-09-18至2025-09-19","2025-12-25至2025-12-26"]}},
  {{"主题事件":"孩子小学入学报名","起止时间":["2025-05-10至2025-05-10"]}},
  {{"主题事件":"云南七日游","起止时间":["2025-07-15至2025-07-21"]}},
  {{"主题事件":"突发感冒就医","起止时间":["2025-11-03至2025-11-03"]}}
]
      

---
人物画像如下
{persona}
'''
#事件推理第二轮：追求补充和多样
template1_2 = '''
请根据人物画像及第一轮生成的事件，为其额外补充2025年**完整365天周期内**符合身份、性格、职业与生活习惯的**生活主题事件（第二轮）**。核心用于填补时间空白与主题盲区，与第一轮事件形成互补。同时对第一轮事件进行拓展丰富。

---
主题构建要求
1. 延续与补全原则：严格遵循第一轮事件的主题构建要求，覆盖工作、生活、社交、娱乐等全维度，重点补充第一轮未充分涉及的场景主题。同时分析第一轮事件涉及的主题是否仍可以进行扩展丰富。事件不要过于日常，非周期性事件占比不少于60%。
2. 时间与多样性优化：① 填补时间空白——确保全年无连续7天以上无事件，重点补充第一轮事件稀疏的月份；② 丰富事件类型——工作场景可增加更多细分事件，娱乐场景可补充更多元体验，社交场景考虑更多关系和可做事件等。使主题事件多元化。
3. **排他性要求：输出事件需与第一轮完全不同，不得重复事件。**
4. 数量与分布：主题事件数量不少于60个，优先补充工作（40%）、社交（20%-25%）、生活（20%-25%）类事件，平衡长期事件与短期事件占比。

---
输出格式严格要求
与第一轮一致：仅输出JSON格式内容，直接以[]开头结尾，“主题事件”为字符串，“起止时间”为数组（单日格式“2025-04-05至2025-04-05”，多次事件列全具体区间），不添加任何额外文本。
'''
#事件推理第3轮：细节丰富
template1_3 = '''
请根据人物画像及前两轮生成的事件，为其额外补充2025年**完整365天周期内**符合身份、性格、职业与生活习惯的**生活主题事件（第三轮）**。核心用于强化人群共性与画像深挖，提升事件密度与真实感。

---
主题构建要求
1. 多维融合原则：① 人群共性事件——结合人物的性别/年龄/地域/人生阶段的标签进行推理生成常见事件（如年轻女性可推理出注重皮肤保养）；请你推理出至少3个人群标签。② 通用生活事件——加入如“换季衣物收纳整理”“人情往来送礼”“家居小改造”等人类通用场景；③ 画像深挖事件——基于画像未充分利用的信息（如隐藏技能、亲友职业）生成关联事件（如“陪医生家人值夜班送饭” “带摄影爱好者同事外拍采风”）。请分析画像中有哪些未利用信息。④可生成一些具体短期事件/日常事件（如个人工作过程的某个具体事务，生活的某个情节）和第一轮生成的事件互为补充。⑤根据画像补充工作、生活、社交、娱乐等全维度主题事件。
2. 补全与逻辑化原则： ①主题多样化——针对工作/生活/社交/娱乐四大核心维度，补充更多具体事件，避免内容同质化，单一化。② 事件连贯性——复盘前两轮事件，补充关联性后续场景（如前两轮有“陪朋友挑选婚纱”，需新增“参加朋友婚礼”；有“新房装修”，需新增“装修后通风散味”），杜绝逻辑断裂的孤立事件。
2. 事件类型拓展：新增“日常事件”（如“修电脑”“买换季衣服”"加班做项目"）、“轻微意外事件”（如“钥匙丢失配锁”“快递损坏维权”），与前两轮的重要事件形成梯度；确保覆盖至少10个不同主题。
3. 排他性与协调性：输出事件与前两轮完全不同，无时空冲突；事件数量不少于60个，工作/生活/家庭类事件占比不低于50%，工作和非工作事件数量分布要合理，事件时间分布上要合理。休闲娱乐等活动要多样。
4. 最终核查：输出前需检查：① 无重复/违和事件；② 与前两轮事件无时空冲突；③ 全年事件密度合理，有忙的时间和清闲的时间，每天事件平均两个左右，符合真实生活节奏。

---
输出格式严格要求
与前两轮一致：仅输出JSON格式内容，直接以[]开头结尾，“主题事件”为字符串，“起止时间”为数组（严格遵循“2025-04-05至2025-04-07”格式），不添加任何额外文本。
'''


#周期性事件生成
template2 = '''
请根据以下人物画像，描述符合其身份、性格、职业与生活习惯的2025年一年生活特征。核心通过生成**周期性生活主题事件**，具象化呈现个人生活规律与特质，所有内容需满足真实可感、逻辑自洽、高度贴合画像的要求。

---
主题事件构建核心维度与要求
1. 周期类型限定：仅聚焦以“周/月”为频率的周期性事件，需覆盖四大核心维度：① 基础生活轨迹（如职业相关固定日程）；② 长期习惯养成（如健身、阅读）；③ 周期性任务/目标（如工作汇报、技能学习进度）；④ 社交与兴趣安排（如聚会、爱好实践）。
2. 频率描述规范：可明确具体时间的事件，需在“频率”字段精准标注（例：每周一/周三/周五、每月5号/20号）；无法固定具体日期的，标注通用频率（例：每周两次、每月一次）。
3. 画像契合度要求：事件必须紧密关联人物的职业（如程序员的“每周代码复盘”）、年龄（如大学生的“每周课程学习”）、性格（如内向者的“每周独处阅读”）、经济能力（如中等收入者的“每月一次轻奢聚餐”）、家庭状况（如已婚者的“每周家庭采购”）及兴趣爱好（如摄影爱好者的“每月户外采风”），可基于画像进行合理现实推断，避免脱离人设的行为设计。
4. 数量与合理性平衡：需生成至少5个主题事件，确保覆盖生活各维度且不过于密集（例：每周事件不超过4个，避免时间冲突）；事件间需符合现实时间分配逻辑（如“每天加班到深夜”与“每天晨跑”不建议同时出现）。

---
输出格式严格要求
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。格式示例如下：

      [
        {{
          "主题事件": "职场通勤",
          "频率": "每周一至周五7:30-8:30"
        }},
        {{
          "主题事件": "健身撸铁",
          "频率": "每周二/周四/周六19:00-20:30"
        }},
        {{
          "主题事件": "月度工作汇报",
          "频率": "每月最后一个周五15:00-16:00"
        }},
        {{
          "主题事件": "家庭聚餐",
          "频率": "每月第一个周日"
        }}
      ]
    

---
人物画像如下
{persona}
'''
#长期事件生成第一轮：推理可能事件
template3_1 = '''
请根据以下人物画像，为其生成2025年**完整365天周期内**可能发生的长期事件，需满足真实感、逻辑性与细节丰富度要求。
示例：备考PMP
- 步骤1：报名与资料准备（2025年2月10日-2月28日）→ 目标：完成PMP考试报名，购买《PMBOK指南》及线上课程，制定每日2小时学习计划；
- 步骤2：第一阶段理论学习（3月1日-4月30日）→ 目标：学完“范围管理/时间管理”等6大知识领域，每周完成1套章节练习题（因4月15日-4月20日加班，暂停学习5天）；
- 步骤3：模拟题冲刺训练（5月1日-5月20日）→ 目标：完成10套历年真题，整理错题本，重点攻克“风险管理”薄弱模块；
- 步骤4：参加考试（5月25日）→ 目标：按时赴考，合理分配答题时间；
- 步骤5：成绩查询与证书申领（7月10日-7月15日）→ 目标：查询考试结果，通过后提交证书申领资料（若未通过，计划2026年3月重考）。

---
核心要求
1. 长期事件定义：指持续时间≥7天、需分阶段推进的目标/项目/任务（如工作项目、备考计划、技能学习、人生大事筹备等），需体现“断断续续执行”或“阶段性攻坚”的真实状态，避免流程化线性推进。
2. 拆解与时间分配：每个长期事件需拆解为3个以上的具体原子事件，每个原子事件需明确：① 具体行动内容（含可落地细节）；② 起止时间（精确到“月-日至月-日”，时间间隔需合理，允许存在空窗期）；③ 该步骤的核心目标（如“完成竞品调研→明确项目差异化方向”）。
3. 事件数量与多样性：需生成5-12个最合理，最可能发生的长期事件，考虑人物画像中的核心维度（如职业/生活/学习/社交等）；事件起始时间随机分布在2025年1-12月，允许事件跨年未完成（需标注“2025年未完成，持续至2026年X月”）。持续时间大于1个月的事件至少有3个。
4. 真实场景约束：需结合人物画像中的基础属性（如年龄/职业/城市/标签）设计事件，避免脱离现实（例：学生不设计“年度商务谈判项目”，无骑行爱好不设计“环青海湖骑行筹备”）；可加入轻微意外干扰（如“因加班推迟资料整理”“生病暂停学习1周”）增强真实感。长期事件的执行可能遇到一些意外和紧急事件或波折，避免流程化的线性推进。
5. 多样性增强：需覆盖多时间维度的长期事件，形成梯度化分布。具体包括：短期长期事件（持续1-2周，如线下活动筹备、周末集训营）、中期长期事件（持续1-3个月，如论文投稿筹备、职业资格证冲刺复习）、长期长期事件（持续3个月以上，如备战高考、新房装修全程），确保不同时长的事件类型均有涉及，丰富全年事件的时间跨度层次。


---
长期事件参考方向
- 职业类：公司重点项目落地（如“Q2新品营销 campaign 筹备 新产品研发项目”）、职业资格备考（如“CPA考试复习计划”）、跨部门协作任务（如“企业数字化转型调研”）；
- 生活类：人生大事筹备（如“婚礼策划与执行”“新房装修”）、技能学习（如“从零学吉他→完成首支弹唱”）、深度兴趣实践（如“马拉松备赛训练”“年度骑行挑战路线规划”）；
- 成长类：学历提升（如“在职研究生申请与备考”）、个人品牌打造（如“小红书账号从0到1万粉运营”）、重要关系维护（如“筹备父母金婚纪念活动”）。
**人物画像如下：** 
{persona}
'''
##长期事件生成第二轮：事件筛选与融合
template3_2 = '''
请结合以下已生成的个人2025年非长期事件，对首轮产出的长期事件进行系统性筛选、有机整合与细节优化，最终输出时间排布紧凑合理、精力分配科学均衡、内容无逻辑冲突的长期事件列表。
--- 核心要求 ---
1. 数量与精力匹配：需结合个人全年工作生活密度，综合评估时间与精力上限，最终保留2-5个核心长期事件。避免因事件数量过多导致执行矛盾，例如同一时间段内并行推进3个以上高强度项目（如备考、重大工作项目、大型活动筹备），确保各事件在时间周期上有合理缓冲。优先筛选最有可能发生的长期事件。
2. 冲突与重复处理：重点分析已生成非长期事件与首轮长期事件的关联性，仅针对内容相关或主题重复事件进行整合（避免不整合导致的内容违和）：若存在相似事件（如“非长期事件‘参加插花体验课’”与“长期事件‘系统学习插花’”），需修改长期事件步骤，将非长期事件作为原子步骤自然融入（例如将体验课设定为“入门认知阶段”的核心行动）；若无非相关非长期事件，则直接保留首轮长期事件原步骤。整合过程中不得删除首轮原步骤，可通过微调时间节点（如提前/延后1-2周）实现流程连贯，避免生硬拼接。不要为了整合其他事件过度修改原事件。
3. 细节优化与逻辑自洽：筛选后的长期事件需逐一审验时间线连贯性（如阶段间隔是否合理、是否存在时间断层）与步骤合理性（如行动难度与个人能力是否匹配）。针对整合调整部分补充具体细节，例如因融入非长期事件导致的学习计划调整、阶段目标量化更新等，确保每个原子事件的行动内容、时间节点、核心目标与非长期事件形成互补而非冲突，整体贴合个人真实生活节奏。
4. 事件分解明确：长期事件的分解事件既可为按时间推进的连贯顺序事件（如“资料准备→理论学习→冲刺训练”），也可为围绕核心目标的相关联事件（如“健身计划中的‘力量训练’‘有氧训练’‘饮食管理’”），但需保证各分解事件均服务于长期事件的最终目标，且行动逻辑清晰可追溯。
5. 新增事件：若首轮长期事件存在人物画像核心维度（如职业发展、生活规划、技能提升等）覆盖不足的情况，或已生成长期事件质量不足，可结合已生成非长期事件的风格内容与个人属性，自行新增1-2个合理的长期事件。新增事件需符合“持续时间≥7天、分阶段推进”要求，且与现有事件无时间冲突、精力分配无矛盾，行动细节贴合个人真实场景。
6. 输出时请明确该长期事件包含和整合了哪些已生成非长期事件及其起止时间。主题要具体，分解事件不是并列关系，是逻辑连贯的关系。
已生成事件如下： {content}
'''
##长期事件生成第3轮：事件分解，粒度对齐到周。
template3_3 = '''
请根据你已筛选优化后的长期事件列表，对每个长期事件进行更具体化的步骤分解，需严格遵循真实场景逻辑与时间合理性要求，最终按指定格式输出分解结果。
--- 核心分解要求 ---
1. 步骤时长限制：每个分解的主题事件持续时长不得超过7天（≤一周），支持“单日完成”或“多日连续完成”两种设计形式，起止时间需精确到“年-月-日至年-月-日”，格式统一且无歧义。
2. 分解数目与合理性：结合长期事件的总时长与实际执行流程确定分解步骤数，例如：持续1个月的事件可分解为4-5个步骤，持续3个月以上的事件可分解为10-15个步骤。需避免分解过粗（如合并多个独立行动）或过细（如拆分单一简单任务），确保每个步骤均为独立、必要的行动单元。
3. 时间连贯性与灵活性：分解步骤的起止时间需完全落在对应上层长期事件的总时间周期内，步骤间可保留合理间隔（如周末休息、临时事务处理），整体形成连贯时间线。允许对步骤时间进行微调优化，长期事件无需在周期内不间断推进，可在分解事件间合理设置真空期，但也可连续执行，单个分解事件也可根据实际场景小幅延长或短暂中断（需符合真实执行节奏）。
4. 内容真实性与关联性：主题事件需贴合现实场景，行动内容具体可落地（示例：“收集3家核心竞品近3个月价格数据”而非“开展竞品调研”），避免空泛表述。同时，主题事件描述需隐含与上层事件的关联，让人直观理解其归属（如“新店选址备选区域实地考察”可明确关联“新店筹备”），确保每个步骤符合人物身份与事件推进逻辑。
--- 输出格式要求 ---
严格按照以下JSON数组格式输出，其中“上层事件”需与所给长期事件的主题完全一致，主题事件描述需体现与上层事件的关联性，仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。格式示例如下：：
[
  {
    "主题事件": "新店年度工作规划会议",
    "起止时间": ["2025-01-08至2025-01-09"],
    "上层事件": "新店筹备"
  },
  {
    "主题事件": "孩子小学入学报名",
    "起止时间": ["2025-05-10至2025-05-10"],
    "上层事件": "孩子入学"
  }
]

'''
#逐月对上述生成三类事件进行融合调整，通过具体化时空属性判断时空逻辑。
template_gen = '''
请参考用户画像、生活特征习惯数据、上月事件数据，对本月日程事件数据进行逐天分析，通过具体化、调整、增删等操作，消解不合理之处，生成合理真实丰富的日程事件数据。
--- 输出格式要求 ---
严格遵循以下JSON对象格式输出，直接以大括号开头结尾，不得添加```json```标记或额外说明文字：
{{
  "2025-10-01": {{
    "事件": ["每月闺蜜聚会", "季度家庭大扫除"],
    "描述": "当天日程描述"
  }},
  "2025-10-02": {{
    "事件": ["高中同学聚会"],
    "描述": "当天日程描述"
  }}
}}
--- 核心说明 ---
1. 请先明确本月每日“日期-周几-工作日/休息日/法定假期”属性
2. 日程具体化与描述要求：需明确每日事件的发生地点（合理多样，如“公司会议室”“家附近超市”）、占用时间，描述需覆盖全天，补充事件衔接内容（如“早上9点从家出发去公司，18点下班后赴闺蜜聚会”），确保日程符合真实生活节奏，描述详细且逻辑连贯。
3. 操作权限与优先级：支持“调整日程事件时间”“新增事件”“删除事件”三类操作：① 优先通过调整事件起止时间、暂时中断后继续、缩短/延长时长、提前/延迟发生等方式，处理时空冲突与密度不合理问题；② 仅对内容逻辑严重不合理且难以调整的事件采取删除操作，删除后可新增事件补充多样性；③ 新增事件用于填补生活场景空白，使日程更完整。
4. 逐天校验维度：① 空间冲突：同一日事件的地点是否存在往返矛盾（如上午在上海开会、下午突然出现在北京逛街）；② 时间冲突：事件占用时间是否重叠且无法兼容（如同一时段既在办公室工作又参加线下活动）；③ 逻辑合理性：事件内容是否符合用户身份、能力与习惯（如不会游泳者不安排深潜活动，低收入者不频繁入住五星级酒店）。
5. 跨日时空衔接：分析用户跨日期的地点变化是否合理，包括交通方式与耗时匹配（如杭州到南京可当日往返，新疆到南京需预留交通时间），确保上一日与下一日的时空过渡自然，事件间体现合理的时间顺序或因果关系（如“前日提交项目方案”→“今日参加方案评审会”），避免孤立、跳跃。
6. 重复事件管控：针对重复/相似事件，校验间隔频率是否合理（如上月已有理发事件，本月需间隔20天以上）；结合历史事件，避免当前事件与其重复或矛盾，必要时进行删除或延期。
7. 工作日与休息日适配：描述中需明确周几，工作相关事件优先安排在工作日，休闲、社交等事件合理分配至休息日或工作日非工作时段，避免单日日程过于密集。
8. 跨月事件衔接：确保本月开始的事件与上月未完成事件连贯（如上月“新房装修设计”→本月“装修材料选购”）；本月末尾未完成事件需预留衔接空间，为下月继续推进做准备。
9. 事件与描述一致性：“事件”字段需与“描述”内容完全对应，描述中新增的具体事件需同步提取至“事件”数组中。
用户画像如下： {persona}
本月事件日程数据如下： {content}
用户生活特征习惯如下： {habit}
上月事件日程数据如下： {history}
下月事件日程数据如下： {future}
'''

#基于调整后的日程事件，分析事件密度，充实每日事件。
template_enrich = '''
请依据本月事件数据，为用户新增**本月内（{month}月）** 符合其身份、性格、职业与生活习惯的事件。新增目标为：1）衔接现有事件，填补逻辑断层，使日程更流畅；2）解决现有事件同质化问题（如工作类事件单一），提升事件多样性。3）从本月视角出发，更全面充实地描绘个人生活全貌。4)解决日程事件不丰富、密度不合理等问题。所有内容需真实可感、符合现实逻辑。
--- 输出格式要求 ---
严格遵循以下JSON对象格式输出，直接以大括号开头结尾，不得添加```json```标记或额外说明文字：
{{
  "2025-10-01": {{
    "事件": ["每月闺蜜聚会", "季度家庭大扫除"],
    "描述": "当天日程描述"
  }},
  "2025-10-02": {{
    "事件": ["高中同学聚会"],
    "描述": "当天日程描述"
  }}
}}
--- 说明 ---
1. 事件唯一性与逻辑性：新增事件不得与当月已有事件重复，且需避免与已有事件产生冲突（包括发生频率、间隔合理性及顺序逻辑冲突）。
2. 时间灵活性：事件可横跨多日，允许与其他事件时间重叠（例如“海南度假”期间同步“远程处理紧急工作邮件”），但重叠内容需符合现实场景（如高强度工作与休闲度假不可同时进行）。
3. 内容真实丰富：围绕用户本月工作、学习、生活、社交等维度生成具体事件，避免重复单调或过度理想化内容（如普通职员频繁参加高端酒会），增强生活真实感。同时请考虑本月的节假日期是否缺乏相关事件，本月有什么季节特点。
4. 频率与间隔管控：生成后需校验与已有事件的重复/相似性，协调发生频率与间隔。
5. 时间范围限定：仅生成起止时间完全在本月（{month}月）内的事件；同一天事件的起止时间需表述为“2025-04-05至2025-04-05”；多次发生的事件，在“起止时间”数组中依次列明每次的时间范围（如["2025-04-05至2025-04-07","2025-04-15至2025-04-17"]）。
6. 本月事件数据的已有事件都要保留，你只可以新增事件并优化描述。
7. 请体现忙碌日期（事件多）和清闲日期（事件不多），工作日（工作事件多）和休息日（多元化休闲，社交）。
8. 生成的事件不要与个人画像冲突，要合理真实。
**本月事件数据如下：**{content}
**个人画像：**{persona}
、
'''

template_decomposer = '''
请依据历史记忆，个人画像，本周事件日程，将本周事件详细具体地分解为原子事件。原子事件是指详细具体的事件。

--- 说明 ---
1. 原子事件是指粒度细，比较具体的事件。它可能是原事件的步骤流程，也可能是原事件的前置（准备/规划/起因/预定）/后续（产生了什么影响/收尾）事件，也可能是相关的事件。**原子事件的发生时间不一定发生在原事件起止时间内，起止事件只代表事件主体发生的时间。在添加前置/后续事件时日期可以放在起止时间之前/之后。**
2. 你需要分析每个事件，不同的事件重要性/复杂度/特殊性不同，涉及的流程长短，步骤难易，分解后事件数目也不同。
3. 请分析出不重要事件/日常工作生活等事件/会频繁发生/流程简单的事件，过滤掉这些事件，不进行分解。
4. 分解事件也要多样化，如不是所有事件都会经过准备/规划，也不是所有流程都一定会走完。同一类事件在不同时间不同地点执行时的流程和情景也不同。由于原事件的起止日期是个数组，即表示该事件可能在不同时间发生多次，所以每次的分解都要不同（既有共同的流程也有不同的情景）。
5. 历史记忆包括了历史相关事件的分解原子事件，可供参考，但一定要有不同。由于画像中社交关系字数过多，你可以先提取出有关人物然后生成。
6. 在分解生成时加入一些情景。描述时尽量详细具体，明确时间，场景。
7. 有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，要按照真实情况和常理合理分布时间。
7. 若事件日程为空则输出空数组[]。

本周事件日程如下：{content}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_decomposer_1 = '''
请依据历史记忆、个人画像及本周事件日程，将本周事件详细具体地分解为原子事件。原子事件需满足粒度细、场景清、动作实的核心要求。
一、原子事件定义与范围
原子事件指详细具体的细粒度事件，既可以是原事件的核心步骤流程，也可以是前置事件（如准备、规划、起因、预定等）或后续事件（如影响、收尾、复盘等）。原子事件的发生时间不限于原事件起止时间内，前置事件可安排在原事件起止时间之前，后续事件可延伸至之后，当然也可以安排在起止时间内。起止事件只代表事件主体发生的时间。
二、分解核心原则
1. 差异化分解：根据事件的重要性、复杂度、特殊性调整分解深度——重要/复杂/特殊事件可细化更多步骤，流程简单、高频发生的日常工作生活类不重要事件无需分解，直接过滤。
2. 场景多样性：避免同质化分解，并非所有事件都需包含“准备-执行-收尾”全流程；同一类事件有可能在不同时间/地点多次发生，分解需兼顾共同基础流程与差异化情景（如不同天气、不同协作人员、不同地点带来的细节变化）。
3. 参考与创新结合：历史记忆中相关事件的原子化案例可作为流程参考，但需在场景、动作细节上体现新变化，禁止完全复刻。个人画像中社交关系信息可先提取关键人物，再结合人物特征生成互动情景。
4. 时间合理分布：有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，要按照真实情况和常理合理分布时间。不要为了给每日都安排事件把事件拆分的不符合人类习惯和逻辑。
5. 分解生成时需融入具体情景描述，每个原子事件的描述需明确发生时间（精确到日/时段）、具体场景细节，分解要兼顾详细多样。若本周事件日程为空，则直接输出没有事件。

本周事件日程如下：{content}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_decomposer_json = '''
请你将你之前的输出的所有分解事件，规整为下面的json格式发给我。注意直接以括号开头，不要输出···json等无关字段。发生日期格式为"2025-01-01"。若事件为空则你继续输出空数组[]，不要有任何其他解释。
---输出格式---
[
{
"原子事件":"",
"发生日期":"",
"详细描述":"",
"原事件":""
}
]
'''

template_genatomic = '''
请依据历史记忆，个人画像，本天的日程事件,对未来一周的安排，详细具体地推理撰写该个人一天的生活原子事件。原子事件是指详细具体的事件。

--- 说明 ---
1. 原子事件是指粒度细，比较具体的事件。
2. 历史记忆包含了最近的详细生活，历史发生的事件，自己的反思与想法。请根据历史记忆合理调整当日日程，如分析某事件已经做到什么进度，当前应该怎么继续。某事件是否已经完成，不必重复。之前自己的想法/未完成事件，是否需安排时间进行。
3. 未来规划包含了未来七天的大概事件主题。请分析某事件当前应该怎么做，和未来安排相协调。
2. 你需要首先分析思考作为该个人自己最近做了什么，未来要做什么，最近和未来的安排是否足够，自己想做什么，今天要做什么，今天的日期是周几，今天会发生什么情景。然后基于此推理生成该个人一天可能的详细的生活。
3. 本日日程事件可能持续多天，本日只是其中一部分。本日日程事件只是一个预先规划，不代表一定发生也不代表合理。请你首先思考历史事件分析日程是否合理，是否需要新增删除事件，然后根据该日详细生活灵活调整日程事件地点甚至内容。生成事件后要分解事件，使事件详细具体，明确发生的时间和场景。
4. 本日详细事件表示本日事件在本日执行的详细步骤其他日事件在本日执行的前置/后续步骤。应尽量执行。但如果和本日安排有时空冲突，可以选择延后执行，请明确输出哪些事件安排到之后哪一天进行。
4. 基于画像合理插入各种可能的事件。一天的生活不止有日程规划的事件，每天会有不同的独特事件场景（日常事件/突发事件/需同时进行的事件等等可能性），不要每天都同质化。考虑事件密度，一天可能会做很多事。
5. 在详细化日程事件和其他事件时注意详细性和多样性。1）对比之前历史中可能作的类似事件，一些共同流程可以参考（如爱做的事），但情景要多样且不同（如上次去了某地，这次考虑不同地点）。2）事件要丰富多样，明确事件可能的发生地点和过程，事件细节过程都要描述清楚。3）考虑到生活真实感，插入各种可能的事件。

今天事件日程如下：{content}
未来一周安排如下：{plan}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_genatomic_1 = '''
请基于历史记忆，个人画像，本天的日程事件,对未来一周的安排数据，以第一视角"我"的思考逻辑为起点，详细且具体地推理撰写某个人完整一天的生活原子事件。原子事件需满足粒度细、场景清、动作实的要求，需体现生活的真实感与独特性，避免同质化。
一、数据说明及前置分析要求（需先完成思考再生成事件）
1. 数据说明：历史记忆包含了最近的详细生活，历史发生的事件，自己的反思与想法。未来规划包含了未来七天的事件主题。详细事件指今天事件的详细步骤或其他日事件安排在今天完成的前置/后续步骤，在具体化详细事件时要参考详细事件的描述，你主要参考详细事件字段进行生成而非事件字段。
2. 时间锚点确认：明确当日日期及星期几，结合季节、天气等基础环境信息，为事件场景铺垫合理性（如雨天带伞、夏季晨跑更早等）。注意工作日有可能请假去做重要事件，休息日也可处理一些简单工作事件，可以考虑到一些生活的复杂性和多样性，对于事件多比较忙时完全可以在假期远程工作或加班。
3. 历史记忆关联：梳理记忆里"我"最近3-5天的详细生活事件、未完成事项及反思想法。需判断：①未完成事件的当前进度，今日是否需推进及推进步骤；②重复发生的事件是否需更换场景或细节；③反思中提及的调整需求是否需在今日日程中体现。④今日事件是否和历史数据冲突或违和。⑤是否有没做的事件。
4. 事件规划协调：结合未来事件和历史事件，思考日程安排是否合理，调整今日日程以避免与未来安排冲突。思考未来安排，是否有些事没做但也没安排在日程里（如提前预约等），进行提前处理，也可提前做一些未来规划事件。
5. 日程合理性调整：本日日程事件可能为多日持续事件的一部分，且预设日程仅为初步规划，不代表必然发生或完全合理。针对"本日预设日程事件"，需先判断其与历史记忆、未来规划的兼容性：①是否存在重复的已完成事件；②时间/地点是否与其他事件冲突；③**优先根据当日详细生活场景灵活调整日程事件的时间、地点甚至内容（**方法包括简化流程、并行处理、线上处理、事件合并、更改事件执行的地点，时间使其可以融入等**），将本日事件和详细事件尽可能多的合理的纳入当日安排；**④若因时空冲突问题事件无法当日执行，在输出完一天详细活动后，输出一段明确说明需延后至未来某天执行的事件及具体日期。选择延期时间时，要思考未来规划，有些事件是否紧急，必须执行，不能延期，则需作为紧急事件强行执行（加班，熬夜，放弃休闲等）。**针对需延迟处理的事件，应建立明确的优先级筛选机制：首先确保重要事件及作为其他事件执行基础的前置条件类事件优先连贯推进，避免整体流程受阻；而休闲娱乐、约会等对后续关键事务无直接影响的事件，则可灵活延迟至空闲时段再行安排。**
6. 事件灵活调整：可基于历史记忆、个人画像及当日实际场景合理生成符合逻辑的新增事件，同时删除与历史数据、未来规划或个人行为习惯存在明显矛盾的事件，确保全天生活事件的连贯性与合理性。针对删除的事件不需要延期。
7. 请优先根据本日事件和本日详细事件及其描述安排当日生活，再考虑多样性真实性等问题进行修改。对于详细事件请关注原子事件和详细描述。分析是否有些详细事件只占用短时间，并不消耗精力，完全可以在本日生活中完成，此外一些简单的详细事件可以合并在一起完成，无需延迟。

二、原子事件生成规范
- 时间颗粒度：事件需标注具体时间（精确到分钟，如"7:05-7:15"），连续事件需体现衔接逻辑。
- 场景与动作细节：每个事件描述需包含"地点+具体动作+感官/心理补充"，例如："8:20-8:35在公司楼下便利店买早餐，选了全麦三明治和热美式，付款时发现手机没电，用现金支付后匆匆走向电梯"，而非简单写"买早餐"。
- 多样性与真实性：除预设日程外，需插入非同质化的日常/突发/并行事件和其他各种可能发生的事件，如："10:10接到来电提醒家里水管漏水，联系物业约定下午3点上门维修"、"14:00-14:30午休时趴在桌上看了半集纪录片"、"19:40在小区门口遇到邻居，闲聊了5分钟关于宠物寄养的事"，或插入一些事件情景为之后的事件铺垫。当本日事件较多时优先安排本日事件，然后再考虑插入其他事件。不要因插入事件过多而减少本日事件的执行数目。
- 个人画像贴合度：结合人物的年龄、职业、爱好、性格等画像特征，设计符合其行为习惯的事件，避免出现与画像矛盾的场景（如不爱运动的人突然安排2小时高强度健身）。
三、输入数据与输出结构建议
### 输入数据描述
今天事件日程如下：{content}
未来一周安排如下：{plan}
历史记忆如下：{memory}
个人画像如下：{persona}
### 输出建议
无需遵循固定输出格式，可充分发挥想象力，以自然流畅的叙事方式展现当日生活。需先融入第一视角思考完成前置分析，再通过具体场景与细节串联全天原子事件，突出生活的真实感与独特性即可。对于与当日日程事件相关的事件请用括号标注清楚事件名和详细事件的原子事件名，便于后续识别没做的事件。事件描述要具体详细充实，不要遗漏给定事件里的任何信息，描述时可结合一些前后因果或情景细节。
'''

template_genatomic_json = '''
请你将你之前的输出的一天活动，规整为下面的json格式发给我。注意直接以括号开头，不要输出···json等无关字段。
---输出格式---
[
{"事件标题":"",
"发生时间段":"",
"详细描述":"",
"关键词":""
}
]
---说明---
事件标题简要说明做了什么事情，详细描述详细介绍事件发生的具体内容情景过程。关键词提取事件的主谓宾作为关键词，同时筛选出相关的重点的关键词。关键词一共有五个。关键词尽量简短，除主宾的名称外尽量限制在两个字。主谓宾一定要在关键词里。
'''

template_genatomic_delay = '''
根据你第一轮输出的延期情况,提取出哪些事件被延期了，延期到何日执行,无延期事件则输出空数组[]。然后以json格式输出延期事件。注意直接以括号开头，不要输出···json等无关字段。
**注意无延期事件则输出空数组[]**
输出格式如下：
[{"原子事件": "新年清晨家庭布置", "发生时间": "2025-01-01", "详细描述": "在家中餐厅更换绣有'福'字的桌布时，发现去年聚餐的葡萄酒渍痕迹，回忆起姑妈去年喝醉的场景，精心布置用餐环境", "原事件": "元旦家庭聚餐","延迟日期":"2025-01-02"}]
里面的所有字段严格保留原本日日程事件的描述。
'''

template_genatomic_reflect = '''
下面是过去七天你的生活事件和上一次总结反思内容，请你更新并重新总结你的每周总结反思。包括1）总结这一周的生活事件经历（这是主要部分，其他内容可以少一些）和以前经历的重要事件。2）提出一些反思、想法等。输出一段不超过200字的文字。
过去生活：{content}
上一次反思：{ref}
'''